{"paragraphs":[{"title":"Send Chaps Payment","text":"%angular\n<div  id=\"submit-sendChapsPayment-container\">\n    <div ng-show=\"show\" ng-class=\"{'sendChapsPayment-submit-status-container-failed': !result.success, 'sendChapsPayment-submit-status-container': result.success}\">\n        <div class=\"result-header\">{{result.text}}</div>\n        <div class=\"result-details row\" ng-show=\"show\">\n            <div class=\"col-xs-3\">\n                <label>Chaps Payment: </label>\n                <div>{{result.payment}}</div>\n             </div>\n        </div>\n    </div>\n\n    <form name=\"sendChapsPaymentForm\" id=\"post-sendChapsPayment-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- UserName -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"username\">Username: </label>\n                    <input type=\"text\" name=\"username\" class=\"form-control\" id=\"username\" ng-model=\"data.username\">\n                </div>\n\n                <!-- Password -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"password\">Password: </label>\n                    <input type=\"password\" name=\"password\" class=\"form-control\" id=\"password\" ng-model=\"data.password\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Payment Type -->\n                <div class=\"col-xs-3 form-group\">\n                     <label for=\"paymentType\" id=\"paymentTypeLabel\">Payment Type: </label>\n                        <select class=\"form-control\" id=\"paymentType\" ng-model=\"data.paymentType\">\n                            <option value=\"MT103\">MT103</option>\n                            <option value=\"MT202\">MT202</option>\n                        </select>\n                </div>\n\n                <!-- Priority -->\n                <div class=\"col-xs-3 form-group\">\n                     <label for=\"priority\" id=\"priorityLabel\">Priority: </label>\n                        <select class=\"form-control\" id=\"priority\" ng-model=\"data.priority\">\n                            <option value=\"U\">Urgent</option>\n                            <option value=\"N\">Not Urgent</option>\n                        </select>\n                </div>\n\n                <!-- Value Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"valueDate\">Value Date: </label>\n                    <input type=\"text\" name=\"valueDate\" class=\"form-control\" id=\"valueDate\" ng-model=\"data.valueDate\" ng-disabled=true>\n                </div>\n\n                                <!-- Chaps Related Reference -->\n                <div class=\"col-xs-3 form-group\" ng-show = \"data.paymentType == 'MT202'\">\n                    <label for=\"relatedReference\">Chaps Related Reference: </label>\n                    <input type=\"text\" name=\"relatedReference\" class=\"form-control\" id=\"relatedReference\" ng-model=\"data.relatedReference\">\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Currency -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"currency\">Currency: </label>\n                    <input type=\"text\" name=\"currency\" class=\"form-control\" id=\"currency\" ng-model=\"data.currency\" ng-disabled=true>\n                </div>\n\n                <!-- Settlement Amount / Instructed Amount -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"settlementAmt\">Settlement Amount: </label>\n                    <input type=\"text\" name=\"settlementAmt\" class=\"form-control\" id=\"settlementAmt\" ng-model=\"data.settlementAmt\">\n                    <span class=\"invalid-feedback\" ng-show=\"settlementAmt.$touched && data.settlementAmt == null || data.settlementAmt == ''\">This field is required</span>\n                    <span class=\"invalid-feedback\" ng-show=\"checkNumber(data.settlementAmt)\">This field must be numeric</span>\n                </div>\n            </div>\n\n\n            <!-- Debtor -->\n            <div class=\"row\"><div class=\"col-xs-12 form-group\" ><h3>Debtor Data</h3><div></div>\n\n            <div class=\"row\">\n                <!-- Debtor Account Number -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"dbtrAcctNumber\">Debtor Account Number: </label>\n                    <input type=\"text\" name=\"dbtrAcctNumber\" class=\"form-control\" id=\"dbtrAcctNumber\" ng-model=\"data.dbtrAcctNumber\">\n                    <span class=\"invalid-feedback\" ng-show=\"dbtrAcctNumber.$touched && data.dbtrAcctNumber == null || data.dbtrAcctNumber == ''\">This field is required</span>\n                </div>\n\n                <!-- Debtor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"dbtrNm\">Debtor Name: </label>\n                    <input type=\"text\" name=\"dbtrNm\" class=\"form-control\" id=\"dbtrNm\" ng-model=\"data.dbtrNm\">\n                    <span class=\"invalid-feedback\" ng-show=\"dbtrNm.$touched && data.dbtrNm == null || data.dbtrNm == ''\">This field is required</span>\n                </div>\n\n                <!-- Debtor Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"dbtrAddr\">Debtor Address: </label>\n                    <input type=\"text\" name=\"dbtrAddr\" class=\"form-control\" id=\"dbtrAddr\" ng-model=\"data.dbtrAddr\">\n                </div>\n\n                <!-- Debtor BIC -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"dbtrBIC\">Debtor BIC: </label>\n                    <input type=\"text\" name=\"dbtrBIC\" class=\"form-control\" id=\"dbtrBIC\" ng-model=\"data.dbtrBIC\">\n                    <span class=\"invalid-feedback\" ng-show=\"dbtrBIC.$touched && data.dbtrBIC == null || data.dbtrBIC == ''\">This field is required</span>\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Intermediary BIC -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"intermediaryBIC\">Intermediary BIC: </label>\n                    <input type=\"text\" name=\"intermediaryBIC\" class=\"form-control\" id=\"intermediaryBIC\" ng-model=\"data.intermediaryBIC\">\n                </div>\n            </div>\n\n\n            <!-- Creditor -->\n            <div class=\"row\"><div class=\"col-xs-12 form-group\" ><h3>Creditor Data</h3><div></div>\n\n            <div class=\"row\">\n                <!-- Creditor BIC -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrBIC\">Creditor BIC: </label>\n                    <input type=\"text\" name=\"cdtrBIC\" class=\"form-control\" id=\"cdtrBIC\" ng-model=\"data.cdtrBIC\">\n                    <span class=\"invalid-feedback\" ng-show=\"checkMultipleChoice()\">Creditor BIC and Sortcode should not be both filled</span>\n                </div>\n\n                <!-- Creditor Sortcode -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrSortcode\">Creditor Sortcode: </label>\n                    <input type=\"text\" name=\"cdtrSortcode\" class=\"form-control\" id=\"cdtrSortcode\" ng-model=\"data.cdtrSortcode\">\n                    <span class=\"invalid-feedback\" ng-show=\"checkMultipleChoice()\">Creditor BIC or Sortcode should not be both filled</span>\n                </div>\n\n                <!-- Creditor Account Number -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrAcctNumber\">Creditor Account Number: </label>\n                    <input type=\"text\" name=\"cdtrAcctNumber\" class=\"form-control\" id=\"cdtrAcctNumber\" ng-model=\"data.cdtrAcctNumber\">\n                    <!-- <span class=\"invalid-feedback\" ng-show=\"cdtrAcctNumber.$touched && data.cdtrAcctNumber == null || data.cdtrAcctNumber == ''\">This field is required</span> -->\n                    <span class=\"invalid-feedback\" ng-show=\"checkMandatoryCdtrAccountNumber()\">This field is required</span>\n                    <span class=\"invalid-feedback\" ng-show=\"checkChoiceCdtrAccountNameNumber()\">Creditor Account Number or Creditor Name should not be both filled</span>\n                </div>\n\n                <!-- Creditor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrNm\">Creditor Name: </label>\n                    <input type=\"text\" name=\"cdtrNm\" class=\"form-control\" id=\"cdtrNm\" ng-model=\"data.cdtrNm\">\n                    <!--  <span class=\"invalid-feedback\" ng-show=\"cdtrNm.$touched && data.cdtrNm == null || data.cdtrNm == ''\">This field is required</span> -->\n                    <span class=\"invalid-feedback\" ng-show=\"checkMandatoryCdtrAccountName()\">This field is required</span>\n                    <span class=\"invalid-feedback\" ng-show=\"checkChoiceCdtrAccountNameNumber()\">Creditor Account Number or Creditor Name should not be both filled</span>\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Creditor Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrAddr\">Creditor Address: </label>\n                    <input type=\"text\" name=\"cdtrAddr\" class=\"form-control\" id=\"cdtrAddr\" ng-model=\"data.cdtrAddr\">\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Remittance Information -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"remitanceInfo\">Remittance Information: </label>\n                    <input type=\"text\" name=\"remitanceInfo\" class=\"form-control\" id=\"remitanceInfo\" ng-model=\"data.remitanceInfo\">\n                </div>\n\n                <!-- Details of charges -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"detailsOfCharges\">Details of charges: </label>\n                    <input type=\"text\" name=\"detailsOfCharges\" class=\"form-control\" id=\"detailsOfCharges\" ng-model=\"data.detailsOfCharges\" ng-disabled=true>\n                </div>\n\n                <!-- Sender to Receiver Information -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"senderReceiverInfo\">Sender to Receiver Information: </label>\n                    <input type=\"text\" name=\"senderReceiverInfo\" class=\"form-control\" id=\"senderReceiverInfo\" ng-model=\"data.senderReceiverInfo\">\n                </div>\n            </div>\n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_send_chaps()\" ng-disabled=\"disableSendButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.sendChapsPayment-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.sendChapsPayment-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-sendChapsPayment-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init send chaps payment');\n        init_sendChapsPayment();\n    });\n\n    function init_sendChapsPayment() {\n        var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Send Chaps Payment'\n            };\n\n            scope.data = {};\n\n            scope.getActualDate = function() {\n                //yyyy-MM-dd\n                var today = new Date();\n                var dd = today.getDate();\n                var mm = today.getMonth()+1; //January is 0!\n                var yyyy = \"\" + today.getFullYear();\n\n                if(dd<10) {\n                    dd = '0'+dd\n                } \n\n                if(mm<10) {\n                    mm = '0'+mm\n                } \n\n                today = yyyy + \"-\" + mm + \"-\" + dd;\n\n                console.log('Initializing Value date with actual date: ' + today);\n                return today;\n            };\n\n            scope.generateInputValues = function() {\n                console.log('Initializing input values');\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                scope.data.paymentType = \"MT103\";\n                scope.data.priority = \"U\";\n                scope.data.valueDate = scope.getActualDate();\n                scope.data.currency = \"GBP\";\n                scope.data.dbtrBIC = \"ORUNGB3L\";\n                scope.data.detailsOfCharges = \"SHA\";\n                var d = new Date();\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                scope.data = {};\n                scope.generateInputValues(scope);\n            }; \n\n            scope.disableSendButton = function () {\n                if (scope.submit.inprogress) {\n                    return true;\n                }\n\n                if (scope.data.username == null || scope.data.username == undefined || scope.data.username == '') {\n                    return true;\n                }\n\n                if (scope.data.password == null || scope.data.password == undefined || scope.data.password == '') {\n                    return true;\n                }\n\n                if (scope.data.paymentType == null || scope.data.paymentType == undefined || scope.data.paymentType == '0') {\n                    return true;\n                }\n\n                if (scope.data.paymentType == 'MT202') {\n                     if (scope.data.relatedReference == null || scope.data.relatedReference == undefined || scope.data.relatedReference == '0') {\n                        return true;\n                    }\n                }\n\n                if (scope.data.settlementAmt == null || scope.data.settlementAmt == undefined ||scope.data.settlementAmt == '') {\n                    return true;\n                }\n\n                if (scope.data.paymentType == 'MT103') {\n                    if (scope.data.dbtrAcctNumber == null || scope.data.dbtrAcctNumber == undefined ||scope.data.dbtrAcctNumber == '') {\n                        return true;\n                     }\n                }\n\n                if (scope.data.paymentType == 'MT103' && (scope.data.dbtrNm == null || scope.data.dbtrNm == undefined ||scope.data.dbtrNm == '')) {\n                    return true;\n                }\n\n                if (scope.data.dbtrBIC == null || scope.data.dbtrBIC == undefined ||scope.data.dbtrBIC == '') {\n                    return true;\n                }\n\n                if (scope.data.paymentType == 'MT202') {\n                    var choice = 0;\n\n                    if (scope.data.cdtrAcctNumber == null || scope.data.cdtrAcctNumber == undefined || scope.data.cdtrAcctNumber == '') {\n                        choice++;\n                    }\n\n                    if (scope.data.cdtrNm == null || scope.data.cdtrNm == undefined || scope.data.cdtrNm == '') {\n                        choice++;\n                    }\n\n                    if (choice != 1) {\n                       return true;\n                    }\n                } else {\n                    if (scope.data.cdtrAcctNumber == null || scope.data.cdtrAcctNumber == undefined ||scope.data.cdtrAcctNumber == '') {\n                        return true;\n                    }\n\n                    if (scope.data.cdtrNm == null || scope.data.cdtrNm == undefined ||scope.data.cdtrNm == '') {\n                        return true;\n                    }\n                }\n\n                choice = 0;\n                if (scope.data.cdtrBIC == null || scope.data.cdtrBIC == undefined || scope.data.cdtrBIC == '') {\n                    choice++;\n                }\n\n                if (scope.data.cdtrSortcode == null || scope.data.cdtrSortcode == undefined || scope.data.cdtrSortcode == '') {\n                    choice++;\n                }\n\n                if (choice != 1) {\n                    return true;\n                }\n\n                return false;\n            };\n\n            scope.checkNumber = function(data){\n                var result = false;\n                if (data != null && data != undefined && data != '') {\n                    if (isNaN(data)) {\n                        result = true;\n                    }\n                }\n                return result;\n            };\n\n            scope.checkMultipleChoice = function(){\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                var cdtrBicValue = scope.data.cdtrBIC;\n                var cdtrSortcodeValue = scope.data.cdtrSortcode;\n                var result = false;\n\n                if (cdtrBicValue != null && cdtrBicValue != undefined && cdtrBicValue != '' &&\n                    cdtrSortcodeValue != null && cdtrSortcodeValue != undefined && cdtrSortcodeValue != '') {\n                    result = true;\n                }\n\n                return result;\n            };\n\n            scope.checkChoiceCdtrAccountNameNumber = function(){\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                var cdtrAccountNumber = scope.data.cdtrAcctNumber;\n                var cdtrName = scope.data.cdtrNm;\n                var paymentType = scope.data.paymentType;\n                var result = false;\n\n                if (paymentType != null && paymentType != undefined && paymentType == 'MT202') {\n                    if (cdtrAccountNumber != null && cdtrAccountNumber != undefined && cdtrAccountNumber != '' &&\n                        cdtrName != null && cdtrName != undefined && cdtrName != '') {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n\n            scope.checkMandatoryCdtrAccountName = function(){\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                var cdtrAccountName = scope.data.cdtrNm;\n                var paymentType = scope.data.paymentType;\n                var result = false;\n\n                if (cdtrAccountName != undefined && paymentType != null && paymentType != undefined && paymentType == 'MT103') {\n                    if (cdtrAccountName == null || cdtrAccountName == undefined || cdtrAccountName == '') {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n\n            scope.checkMandatoryCdtrAccountNumber = function(){\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                var cdtrAccountNumber = scope.data.cdtrAcctNumber;\n                var paymentType = scope.data.paymentType;\n                var result = false;\n\n                if (cdtrAccountNumber != undefined && paymentType != null && paymentType != undefined && paymentType == 'MT103') {\n                    if (cdtrAccountNumber == null || cdtrAccountNumber == undefined || cdtrAccountNumber == '') {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n\n        }\n    }\n\n    function do_ajax_query_send_chaps(scope, data, token) {\n        scope.show = false;\n        scope.submit.inprogress = true;\n        scope.submit.text = \"Submitting...\";\n\n        console.log('Token: Bearer ', token);\n\n        var xhrTokenChaps = new XMLHttpRequest();\n        var url = \"https://api-0.node.consul:8183/bifrost/chaps/payment\";\n        console.log('Send chaps payment URL obtained: ' + url);\n        xhrTokenChaps.timeout = 25000; //25 seconds\n        xhrTokenChaps.open(\"POST\", url, true);\n        xhrTokenChaps.setRequestHeader('Authorization', 'Bearer ' + token);\n        xhrTokenChaps.setRequestHeader('Content-type', 'application/json');\n        xhrTokenChaps.onreadystatechange = function () {\n            if (xhrTokenChaps.readyState === 4) {\n                if (xhrTokenChaps.status === 200) {\n                    console.log('Chaps payment response: ' + xhrTokenChaps.responseText);\n                    var result = JSON.parse(xhrTokenChaps.responseText);\n                    scope.result.text = \"Chaps Payment sent Successfully\";\n                    scope.result.payment = xhrTokenChaps.responseText;\n                    scope.result.success = true;\n                    scope.show = true;\n                    scope.$apply(); \n                } else {\n                    scope.result.text = \"Error sending chaps payment\";\n                    scope.result.payment = xhrTokenChaps.responseText;\n                    scope.result.success = false;\n                    scope.show = true;\n                    scope.$apply(); \n                }\n            }\n\n            scope.submit.inprogress = false;\n            scope.submit.text = \"Send Chaps Payment\"\n        };\n\n        console.log('sending data: ' + data);\n        xhrTokenChaps.send(data);\n        \n    }\n\n    function send_chaps_with_token(token, scope) {\n        if (token != undefined && token != null && token != '') {\n            console.log('Payment Type: ' + scope.data.paymentType);\n            console.log('Priority: ' + scope.data.priority);\n            \n            var dbtrAddrValue = [];\n            if (scope.data.dbtrAddr != null && scope.data.dbtrAddr != undefined && scope.data.dbtrAddr != '') {\n              dbtrAddrValue = [scope.data.dbtrAddr];\n            }\n            \n            var cdtrAddrValue = [];\n            if (scope.data.cdtrAddr != null && scope.data.cdtrAddr != undefined && scope.data.cdtrAddr != '') {\n              cdtrAddrValue = [scope.data.cdtrAddr];\n            }\n\n            var relatedRefStr;\n            if (scope.data.paymentType == 'MT202') {\n                relatedRefStr = scope.data.relatedReference;\n            }\n\n            var data = JSON.stringify(\n            {\n                'paymentType': scope.data.paymentType,\n                'priority' : scope.data.priority,\n                'settlementAmt' : scope.data.settlementAmt,\n                'dbtrAcctNumber' : scope.data.dbtrAcctNumber,\n                'dbtrNm' : scope.data.dbtrNm,\n                'dbtrAddr' : dbtrAddrValue,\n                'dbtrBIC' : scope.data.dbtrBIC,\n                'intermediaryBIC' : scope.data.intermediaryBIC,\n                'cdtrBIC' : scope.data.cdtrBIC,\n                'cdtrSortcode' : scope.data.cdtrSortcode,\n                'cdtrAcctNumber' : scope.data.cdtrAcctNumber,\n                'cdtrNm' : scope.data.cdtrNm,\n                'cdtrAddr' : cdtrAddrValue,\n                'remitanceInfo' : scope.data.remitanceInfo,\n                'senderReceiverInfo' : scope.data.senderReceiverInfo,\n                'relatedReference' : relatedRefStr\n            });\n\n            console.log('Data: ' + JSON.stringify(data));\n\n            do_ajax_query_send_chaps(scope, data, token.trim());\n        }\n    }\n\n    function do_ajax_query_send_token(scope, data) {\n        scope.show = false;\n        scope.submit.inprogress = true;\n        scope.submit.text = \"Submitting...\";\n        var token = '';\n\n        var xhr = new XMLHttpRequest();\n        var url = \"https://api-0.node.consul:8285/bifrost/login/\";\n        console.log('Get user token URL obtained: ' + url);\n        xhr.timeout = 25000; //25 seconds\n        xhr.open(\"POST\", url, true);\n        xhr.setRequestHeader(\"Content-type\", \"application/json\");\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    console.log('Chaps payment response: ' + xhr.responseText);\n                    var result = JSON.parse(xhr.responseText);\n                    token = result.access_token;\n                    console.log('Token retrieved: ' + token);\n                    send_chaps_with_token(token, scope);\n                } else {\n                    scope.result.text = \"Error getting token\";\n                    scope.result.payment = xhr.responseText;\n                    scope.result.success = false;\n                    scope.submit.inprogress = false;\n                    scope.submit.text = \"Send Chaps Payment\";\n                    scope.show = true;\n                    scope.$apply(); \n                }\n            }\n        };\n\n        console.log('sending data: ' + data);\n        xhr.send(data);\n    }\n\n    function submit_send_chaps(token) {\n        var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n\n        var tokenData = JSON.stringify(\n        {\n            'usr': scope.data.username,\n            'pwd' : scope.data.password\n        });\n\n        var token = '';\n        do_ajax_query_send_token(scope, tokenData);\n    }\n    \n</script>\n","user":"jjimenez","dateUpdated":"2018-11-09T23:45:01+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/undefined","editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"ANGULAR","data":"<div  id=\"submit-sendChapsPayment-container\">\n    <div ng-show=\"show\" ng-class=\"{'sendChapsPayment-submit-status-container-failed': !result.success, 'sendChapsPayment-submit-status-container': result.success}\">\n        <div class=\"result-header\">{{result.text}}</div>\n        <div class=\"result-details row\" ng-show=\"show\">\n            <div class=\"col-xs-3\">\n                <label>Chaps Payment: </label>\n                <div>{{result.payment}}</div>\n             </div>\n        </div>\n    </div>\n\n    <form name=\"sendChapsPaymentForm\" id=\"post-sendChapsPayment-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- UserName -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"username\">Username: </label>\n                    <input type=\"text\" name=\"username\" class=\"form-control\" id=\"username\" ng-model=\"data.username\">\n                </div>\n\n                <!-- Password -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"password\">Password: </label>\n                    <input type=\"password\" name=\"password\" class=\"form-control\" id=\"password\" ng-model=\"data.password\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Payment Type -->\n                <div class=\"col-xs-3 form-group\">\n                     <label for=\"paymentType\" id=\"paymentTypeLabel\">Payment Type: </label>\n                        <select class=\"form-control\" id=\"paymentType\" ng-model=\"data.paymentType\">\n                            <option value=\"MT103\">MT103</option>\n                            <option value=\"MT202\">MT202</option>\n                        </select>\n                </div>\n\n                <!-- Priority -->\n                <div class=\"col-xs-3 form-group\">\n                     <label for=\"priority\" id=\"priorityLabel\">Priority: </label>\n                        <select class=\"form-control\" id=\"priority\" ng-model=\"data.priority\">\n                            <option value=\"U\">Urgent</option>\n                            <option value=\"N\">Not Urgent</option>\n                        </select>\n                </div>\n\n                <!-- Value Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"valueDate\">Value Date: </label>\n                    <input type=\"text\" name=\"valueDate\" class=\"form-control\" id=\"valueDate\" ng-model=\"data.valueDate\" ng-disabled=true>\n                </div>\n\n                                <!-- Chaps Related Reference -->\n                <div class=\"col-xs-3 form-group\" ng-show = \"data.paymentType == 'MT202'\">\n                    <label for=\"relatedReference\">Chaps Related Reference: </label>\n                    <input type=\"text\" name=\"relatedReference\" class=\"form-control\" id=\"relatedReference\" ng-model=\"data.relatedReference\">\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Currency -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"currency\">Currency: </label>\n                    <input type=\"text\" name=\"currency\" class=\"form-control\" id=\"currency\" ng-model=\"data.currency\" ng-disabled=true>\n                </div>\n\n                <!-- Settlement Amount / Instructed Amount -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"settlementAmt\">Settlement Amount: </label>\n                    <input type=\"text\" name=\"settlementAmt\" class=\"form-control\" id=\"settlementAmt\" ng-model=\"data.settlementAmt\">\n                    <span class=\"invalid-feedback\" ng-show=\"settlementAmt.$touched && data.settlementAmt == null || data.settlementAmt == ''\">This field is required</span>\n                    <span class=\"invalid-feedback\" ng-show=\"checkNumber(data.settlementAmt)\">This field must be numeric</span>\n                </div>\n            </div>\n\n\n            <!-- Debtor -->\n            <div class=\"row\"><div class=\"col-xs-12 form-group\" ><h3>Debtor Data</h3><div></div>\n\n            <div class=\"row\">\n                <!-- Debtor Account Number -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"dbtrAcctNumber\">Debtor Account Number: </label>\n                    <input type=\"text\" name=\"dbtrAcctNumber\" class=\"form-control\" id=\"dbtrAcctNumber\" ng-model=\"data.dbtrAcctNumber\">\n                    <span class=\"invalid-feedback\" ng-show=\"dbtrAcctNumber.$touched && data.dbtrAcctNumber == null || data.dbtrAcctNumber == ''\">This field is required</span>\n                </div>\n\n                <!-- Debtor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"dbtrNm\">Debtor Name: </label>\n                    <input type=\"text\" name=\"dbtrNm\" class=\"form-control\" id=\"dbtrNm\" ng-model=\"data.dbtrNm\">\n                    <span class=\"invalid-feedback\" ng-show=\"dbtrNm.$touched && data.dbtrNm == null || data.dbtrNm == ''\">This field is required</span>\n                </div>\n\n                <!-- Debtor Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"dbtrAddr\">Debtor Address: </label>\n                    <input type=\"text\" name=\"dbtrAddr\" class=\"form-control\" id=\"dbtrAddr\" ng-model=\"data.dbtrAddr\">\n                </div>\n\n                <!-- Debtor BIC -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"dbtrBIC\">Debtor BIC: </label>\n                    <input type=\"text\" name=\"dbtrBIC\" class=\"form-control\" id=\"dbtrBIC\" ng-model=\"data.dbtrBIC\">\n                    <span class=\"invalid-feedback\" ng-show=\"dbtrBIC.$touched && data.dbtrBIC == null || data.dbtrBIC == ''\">This field is required</span>\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Intermediary BIC -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"intermediaryBIC\">Intermediary BIC: </label>\n                    <input type=\"text\" name=\"intermediaryBIC\" class=\"form-control\" id=\"intermediaryBIC\" ng-model=\"data.intermediaryBIC\">\n                </div>\n            </div>\n\n\n            <!-- Creditor -->\n            <div class=\"row\"><div class=\"col-xs-12 form-group\" ><h3>Creditor Data</h3><div></div>\n\n            <div class=\"row\">\n                <!-- Creditor BIC -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrBIC\">Creditor BIC: </label>\n                    <input type=\"text\" name=\"cdtrBIC\" class=\"form-control\" id=\"cdtrBIC\" ng-model=\"data.cdtrBIC\">\n                    <span class=\"invalid-feedback\" ng-show=\"checkMultipleChoice()\">Creditor BIC and Sortcode should not be both filled</span>\n                </div>\n\n                <!-- Creditor Sortcode -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrSortcode\">Creditor Sortcode: </label>\n                    <input type=\"text\" name=\"cdtrSortcode\" class=\"form-control\" id=\"cdtrSortcode\" ng-model=\"data.cdtrSortcode\">\n                    <span class=\"invalid-feedback\" ng-show=\"checkMultipleChoice()\">Creditor BIC or Sortcode should not be both filled</span>\n                </div>\n\n                <!-- Creditor Account Number -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrAcctNumber\">Creditor Account Number: </label>\n                    <input type=\"text\" name=\"cdtrAcctNumber\" class=\"form-control\" id=\"cdtrAcctNumber\" ng-model=\"data.cdtrAcctNumber\">\n                    <!-- <span class=\"invalid-feedback\" ng-show=\"cdtrAcctNumber.$touched && data.cdtrAcctNumber == null || data.cdtrAcctNumber == ''\">This field is required</span> -->\n                    <span class=\"invalid-feedback\" ng-show=\"checkMandatoryCdtrAccountNumber()\">This field is required</span>\n                    <span class=\"invalid-feedback\" ng-show=\"checkChoiceCdtrAccountNameNumber()\">Creditor Account Number or Creditor Name should not be both filled</span>\n                </div>\n\n                <!-- Creditor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrNm\">Creditor Name: </label>\n                    <input type=\"text\" name=\"cdtrNm\" class=\"form-control\" id=\"cdtrNm\" ng-model=\"data.cdtrNm\">\n                    <!--  <span class=\"invalid-feedback\" ng-show=\"cdtrNm.$touched && data.cdtrNm == null || data.cdtrNm == ''\">This field is required</span> -->\n                    <span class=\"invalid-feedback\" ng-show=\"checkMandatoryCdtrAccountName()\">This field is required</span>\n                    <span class=\"invalid-feedback\" ng-show=\"checkChoiceCdtrAccountNameNumber()\">Creditor Account Number or Creditor Name should not be both filled</span>\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Creditor Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrAddr\">Creditor Address: </label>\n                    <input type=\"text\" name=\"cdtrAddr\" class=\"form-control\" id=\"cdtrAddr\" ng-model=\"data.cdtrAddr\">\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Remittance Information -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"remitanceInfo\">Remittance Information: </label>\n                    <input type=\"text\" name=\"remitanceInfo\" class=\"form-control\" id=\"remitanceInfo\" ng-model=\"data.remitanceInfo\">\n                </div>\n\n                <!-- Details of charges -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"detailsOfCharges\">Details of charges: </label>\n                    <input type=\"text\" name=\"detailsOfCharges\" class=\"form-control\" id=\"detailsOfCharges\" ng-model=\"data.detailsOfCharges\" ng-disabled=true>\n                </div>\n\n                <!-- Sender to Receiver Information -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"senderReceiverInfo\">Sender to Receiver Information: </label>\n                    <input type=\"text\" name=\"senderReceiverInfo\" class=\"form-control\" id=\"senderReceiverInfo\" ng-model=\"data.senderReceiverInfo\">\n                </div>\n            </div>\n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_send_chaps()\" ng-disabled=\"disableSendButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.sendChapsPayment-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.sendChapsPayment-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-sendChapsPayment-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init send chaps payment');\n        init_sendChapsPayment();\n    });\n\n    function init_sendChapsPayment() {\n        var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Send Chaps Payment'\n            };\n\n            scope.data = {};\n\n            scope.getActualDate = function() {\n                //yyyy-MM-dd\n                var today = new Date();\n                var dd = today.getDate();\n                var mm = today.getMonth()+1; //January is 0!\n                var yyyy = \"\" + today.getFullYear();\n\n                if(dd<10) {\n                    dd = '0'+dd\n                } \n\n                if(mm<10) {\n                    mm = '0'+mm\n                } \n\n                today = yyyy + \"-\" + mm + \"-\" + dd;\n\n                console.log('Initializing Value date with actual date: ' + today);\n                return today;\n            };\n\n            scope.generateInputValues = function() {\n                console.log('Initializing input values');\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                scope.data.paymentType = \"MT103\";\n                scope.data.priority = \"U\";\n                scope.data.valueDate = scope.getActualDate();\n                scope.data.currency = \"GBP\";\n                scope.data.dbtrBIC = \"ORUNGB3L\";\n                scope.data.detailsOfCharges = \"SHA\";\n                var d = new Date();\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                scope.data = {};\n                scope.generateInputValues(scope);\n            }; \n\n            scope.disableSendButton = function () {\n                if (scope.submit.inprogress) {\n                    return true;\n                }\n\n                if (scope.data.username == null || scope.data.username == undefined || scope.data.username == '') {\n                    return true;\n                }\n\n                if (scope.data.password == null || scope.data.password == undefined || scope.data.password == '') {\n                    return true;\n                }\n\n                if (scope.data.paymentType == null || scope.data.paymentType == undefined || scope.data.paymentType == '0') {\n                    return true;\n                }\n\n                if (scope.data.paymentType == 'MT202') {\n                     if (scope.data.relatedReference == null || scope.data.relatedReference == undefined || scope.data.relatedReference == '0') {\n                        return true;\n                    }\n                }\n\n                if (scope.data.settlementAmt == null || scope.data.settlementAmt == undefined ||scope.data.settlementAmt == '') {\n                    return true;\n                }\n\n                if (scope.data.paymentType == 'MT103') {\n                    if (scope.data.dbtrAcctNumber == null || scope.data.dbtrAcctNumber == undefined ||scope.data.dbtrAcctNumber == '') {\n                        return true;\n                     }\n                }\n\n                if (scope.data.paymentType == 'MT103' && (scope.data.dbtrNm == null || scope.data.dbtrNm == undefined ||scope.data.dbtrNm == '')) {\n                    return true;\n                }\n\n                if (scope.data.dbtrBIC == null || scope.data.dbtrBIC == undefined ||scope.data.dbtrBIC == '') {\n                    return true;\n                }\n\n                if (scope.data.paymentType == 'MT202') {\n                    var choice = 0;\n\n                    if (scope.data.cdtrAcctNumber == null || scope.data.cdtrAcctNumber == undefined || scope.data.cdtrAcctNumber == '') {\n                        choice++;\n                    }\n\n                    if (scope.data.cdtrNm == null || scope.data.cdtrNm == undefined || scope.data.cdtrNm == '') {\n                        choice++;\n                    }\n\n                    if (choice != 1) {\n                       return true;\n                    }\n                } else {\n                    if (scope.data.cdtrAcctNumber == null || scope.data.cdtrAcctNumber == undefined ||scope.data.cdtrAcctNumber == '') {\n                        return true;\n                    }\n\n                    if (scope.data.cdtrNm == null || scope.data.cdtrNm == undefined ||scope.data.cdtrNm == '') {\n                        return true;\n                    }\n                }\n\n                choice = 0;\n                if (scope.data.cdtrBIC == null || scope.data.cdtrBIC == undefined || scope.data.cdtrBIC == '') {\n                    choice++;\n                }\n\n                if (scope.data.cdtrSortcode == null || scope.data.cdtrSortcode == undefined || scope.data.cdtrSortcode == '') {\n                    choice++;\n                }\n\n                if (choice != 1) {\n                    return true;\n                }\n\n                return false;\n            };\n\n            scope.checkNumber = function(data){\n                var result = false;\n                if (data != null && data != undefined && data != '') {\n                    if (isNaN(data)) {\n                        result = true;\n                    }\n                }\n                return result;\n            };\n\n            scope.checkMultipleChoice = function(){\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                var cdtrBicValue = scope.data.cdtrBIC;\n                var cdtrSortcodeValue = scope.data.cdtrSortcode;\n                var result = false;\n\n                if (cdtrBicValue != null && cdtrBicValue != undefined && cdtrBicValue != '' &&\n                    cdtrSortcodeValue != null && cdtrSortcodeValue != undefined && cdtrSortcodeValue != '') {\n                    result = true;\n                }\n\n                return result;\n            };\n\n            scope.checkChoiceCdtrAccountNameNumber = function(){\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                var cdtrAccountNumber = scope.data.cdtrAcctNumber;\n                var cdtrName = scope.data.cdtrNm;\n                var paymentType = scope.data.paymentType;\n                var result = false;\n\n                if (paymentType != null && paymentType != undefined && paymentType == 'MT202') {\n                    if (cdtrAccountNumber != null && cdtrAccountNumber != undefined && cdtrAccountNumber != '' &&\n                        cdtrName != null && cdtrName != undefined && cdtrName != '') {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n\n            scope.checkMandatoryCdtrAccountName = function(){\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                var cdtrAccountName = scope.data.cdtrNm;\n                var paymentType = scope.data.paymentType;\n                var result = false;\n\n                if (cdtrAccountName != undefined && paymentType != null && paymentType != undefined && paymentType == 'MT103') {\n                    if (cdtrAccountName == null || cdtrAccountName == undefined || cdtrAccountName == '') {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n\n            scope.checkMandatoryCdtrAccountNumber = function(){\n                //var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n                var cdtrAccountNumber = scope.data.cdtrAcctNumber;\n                var paymentType = scope.data.paymentType;\n                var result = false;\n\n                if (cdtrAccountNumber != undefined && paymentType != null && paymentType != undefined && paymentType == 'MT103') {\n                    if (cdtrAccountNumber == null || cdtrAccountNumber == undefined || cdtrAccountNumber == '') {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n\n        }\n    }\n\n    function do_ajax_query_send_chaps(scope, data, token) {\n        scope.show = false;\n        scope.submit.inprogress = true;\n        scope.submit.text = \"Submitting...\";\n\n        console.log('Token: Bearer ', token);\n\n        var xhrTokenChaps = new XMLHttpRequest();\n        var url = \"https://api-0.node.consul:8183/bifrost/chaps/payment\";\n        console.log('Send chaps payment URL obtained: ' + url);\n        xhrTokenChaps.timeout = 25000; //25 seconds\n        xhrTokenChaps.open(\"POST\", url, true);\n        xhrTokenChaps.setRequestHeader('Authorization', 'Bearer ' + token);\n        xhrTokenChaps.setRequestHeader('Content-type', 'application/json');\n        xhrTokenChaps.onreadystatechange = function () {\n            if (xhrTokenChaps.readyState === 4) {\n                if (xhrTokenChaps.status === 200) {\n                    console.log('Chaps payment response: ' + xhrTokenChaps.responseText);\n                    var result = JSON.parse(xhrTokenChaps.responseText);\n                    scope.result.text = \"Chaps Payment sent Successfully\";\n                    scope.result.payment = xhrTokenChaps.responseText;\n                    scope.result.success = true;\n                    scope.show = true;\n                    scope.$apply(); \n                } else {\n                    scope.result.text = \"Error sending chaps payment\";\n                    scope.result.payment = xhrTokenChaps.responseText;\n                    scope.result.success = false;\n                    scope.show = true;\n                    scope.$apply(); \n                }\n            }\n\n            scope.submit.inprogress = false;\n            scope.submit.text = \"Send Chaps Payment\"\n        };\n\n        console.log('sending data: ' + data);\n        xhrTokenChaps.send(data);\n        \n    }\n\n    function send_chaps_with_token(token, scope) {\n        if (token != undefined && token != null && token != '') {\n            console.log('Payment Type: ' + scope.data.paymentType);\n            console.log('Priority: ' + scope.data.priority);\n            \n            var dbtrAddrValue = [];\n            if (scope.data.dbtrAddr != null && scope.data.dbtrAddr != undefined && scope.data.dbtrAddr != '') {\n              dbtrAddrValue = [scope.data.dbtrAddr];\n            }\n            \n            var cdtrAddrValue = [];\n            if (scope.data.cdtrAddr != null && scope.data.cdtrAddr != undefined && scope.data.cdtrAddr != '') {\n              cdtrAddrValue = [scope.data.cdtrAddr];\n            }\n\n            var relatedRefStr;\n            if (scope.data.paymentType == 'MT202') {\n                relatedRefStr = scope.data.relatedReference;\n            }\n\n            var data = JSON.stringify(\n            {\n                'paymentType': scope.data.paymentType,\n                'priority' : scope.data.priority,\n                'settlementAmt' : scope.data.settlementAmt,\n                'dbtrAcctNumber' : scope.data.dbtrAcctNumber,\n                'dbtrNm' : scope.data.dbtrNm,\n                'dbtrAddr' : dbtrAddrValue,\n                'dbtrBIC' : scope.data.dbtrBIC,\n                'intermediaryBIC' : scope.data.intermediaryBIC,\n                'cdtrBIC' : scope.data.cdtrBIC,\n                'cdtrSortcode' : scope.data.cdtrSortcode,\n                'cdtrAcctNumber' : scope.data.cdtrAcctNumber,\n                'cdtrNm' : scope.data.cdtrNm,\n                'cdtrAddr' : cdtrAddrValue,\n                'remitanceInfo' : scope.data.remitanceInfo,\n                'senderReceiverInfo' : scope.data.senderReceiverInfo,\n                'relatedReference' : relatedRefStr\n            });\n\n            console.log('Data: ' + JSON.stringify(data));\n\n            do_ajax_query_send_chaps(scope, data, token.trim());\n        }\n    }\n\n    function do_ajax_query_send_token(scope, data) {\n        scope.show = false;\n        scope.submit.inprogress = true;\n        scope.submit.text = \"Submitting...\";\n        var token = '';\n\n        var xhr = new XMLHttpRequest();\n        var url = \"https://api-0.node.consul:8285/bifrost/login/\";\n        console.log('Get user token URL obtained: ' + url);\n        xhr.timeout = 25000; //25 seconds\n        xhr.open(\"POST\", url, true);\n        xhr.setRequestHeader(\"Content-type\", \"application/json\");\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    console.log('Chaps payment response: ' + xhr.responseText);\n                    var result = JSON.parse(xhr.responseText);\n                    token = result.access_token;\n                    console.log('Token retrieved: ' + token);\n                    send_chaps_with_token(token, scope);\n                } else {\n                    scope.result.text = \"Error getting token\";\n                    scope.result.payment = xhr.responseText;\n                    scope.result.success = false;\n                    scope.submit.inprogress = false;\n                    scope.submit.text = \"Send Chaps Payment\";\n                    scope.show = true;\n                    scope.$apply(); \n                }\n            }\n        };\n\n        console.log('sending data: ' + data);\n        xhr.send(data);\n    }\n\n    function submit_send_chaps(token) {\n        var scope = angular.element($(\"#submit-sendChapsPayment-container\")).scope();\n\n        var tokenData = JSON.stringify(\n        {\n            'usr': scope.data.username,\n            'pwd' : scope.data.password\n        });\n\n        var token = '';\n        do_ajax_query_send_token(scope, tokenData);\n    }\n    \n</script>"}]},"apps":[],"jobName":"paragraph_1533800452164_207109104","id":"20180407-084832_933732803","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:21+0000","dateFinished":"2018-11-08T13:03:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3949"},{"title":"Return Chaps Payment","text":"%angular\n<div  id=\"submit-returnChapsPayment-container\">\n    <div ng-show=\"show\" ng-class=\"{'returnChapsPayment-submit-status-container-failed': !result.success, 'returnChapsPayment-submit-status-container': result.success}\">\n        <div class=\"result-header\">{{result.text}}</div>\n        <div class=\"result-details row\" ng-show=\"show\">\n            <div class=\"col-xs-3\">\n                <label>Chaps Payment: </label>\n                <div>{{result.payment}}</div>\n             </div>\n        </div>\n    </div>\n\n    <form name=\"returnChapsPaymentForm\" id=\"post-returnChapsPayment-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- UserName -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"username\">Username: </label>\n                    <input type=\"text\" name=\"username\" class=\"form-control\" id=\"username\" ng-model=\"data.username\">\n                </div>\n\n                <!-- Password -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"password\">Password: </label>\n                    <input type=\"password\" name=\"password\" class=\"form-control\" id=\"password\" ng-model=\"data.password\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Return Payment Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"returnPaymentId\">Return Payment Id: </label>\n                    <input type=\"text\" name=\"returnPaymentId\" class=\"form-control\" id=\"returnPaymentId\" ng-model=\"data.returnPaymentId\">\n                </div>\n\n                <!-- Debtor BIC -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"dbtorBIC\">Debtor BIC: </label>\n                    <input type=\"text\" name=\"dbtorBIC\" class=\"form-control\" id=\"dbtorBIC\" ng-model=\"data.dbtorBIC\">\n                </div>\n\n                <!-- Creditor BIC -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrBIC\">Creditor BIC: </label>\n                    <input type=\"text\" name=\"cdtrBIC\" class=\"form-control\" id=\"cdtrBIC\" ng-model=\"data.cdtrBIC\">\n                </div>\n\n                <!-- Creditor SortCode -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrSortcode\">Creditor SortCode: </label>\n                    <input type=\"text\" name=\"cdtrSortcode\" class=\"form-control\" id=\"cdtrSortcode\" ng-model=\"data.cdtrSortcode\">\n                </div>\n            </div>\n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_return_chaps()\" ng-disabled=\"disableReturnButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.returnChapsPayment-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.returnChapsPayment-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-returnChapsPayment-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init return chaps payment');\n        init_returnChapsPayment();\n    });\n\n    function init_returnChapsPayment() {\n        var scope = angular.element($(\"#submit-returnChapsPayment-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Return Chaps Payment'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function() {\n                console.log('Initializing input values');\n                scope.data.dbtorBIC = \"ORUNGB3L\";\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                scope.data = {};\n                scope.generateInputValues(scope);\n            }; \n\n            scope.disableReturnButton = function () {\n                if (scope.submit.inprogress) {\n                    return true;\n                }\n\n                if (scope.data.returnPaymentId == null || scope.data.returnPaymentId == undefined ||scope.data.returnPaymentId == '') {\n                    return true;\n                }\n\n                var choice = 0;\n\n                if (scope.data.cdtrBIC == null || scope.data.cdtrBIC == undefined ||scope.data.cdtrBIC == '') {\n                    choice++;\n                }\n\n                if (scope.data.cdtrSortcode == null || scope.data.cdtrSortcode == undefined ||scope.data.cdtrSortcode == '') {\n                    choice++;\n                }\n\n                if (choice != 1) {\n                    return true;\n                }\n\n                if (scope.data.username == null || scope.data.username == undefined || scope.data.username == '') {\n                    return true;\n                }\n\n                if (scope.data.password == null || scope.data.password == undefined || scope.data.password == '') {\n                    return true;\n                }\n\n                return false;\n            };\n\n        }\n    }\n\n\n\n\n    function getData(scope) {\n        console.log('Generating data ReturnPaymentId: ' + scope.data.returnPaymentId);\n        console.log('DbtorBic: ' + scope.data.dbtorBIC );\n        console.log('CdtrBic: ' + scope.data.cdtrBIC);\n        console.log('cdtrSortcode: ' + scope.data.cdtrSortcode);\n        \n        var data = JSON.stringify(\n        {\n            'returnPaymentId': scope.data.returnPaymentId,\n            'dbtrBIC' : scope.data.dbtorBIC,\n            'cdtrBIC' : scope.data.cdtrBIC,\n            'cdtrSortcode' : scope.data.cdtrSortcode\n        });\n\n        console.log('Data generated: ' + data);\n\n        return data;\n    }\n\n    function send_chaps_with_token(token, scope, returnPaymentId, dbtorBIC) {\n        scope.show = false;\n        scope.submit.inprogress = true;\n        scope.submit.text = \"Submitting...\";\n\n        var xhrTokenChaps = new XMLHttpRequest();\n        var url = \"https://api-0.node.consul:8183/bifrost/chaps/payment/return\";\n\n        var data  = getData(scope);\n\n        console.log('Return chaps payment URL obtained: ' + url);\n        xhrTokenChaps.timeout = 25000; //25 seconds\n        xhrTokenChaps.open(\"POST\", url, true);\n        xhrTokenChaps.setRequestHeader('Authorization', 'Bearer ' + token);\n        xhrTokenChaps.setRequestHeader(\"Content-type\", \"application/json\");\n        xhrTokenChaps.onreadystatechange = function () {\n            if (xhrTokenChaps.readyState === 4) {\n                if (xhrTokenChaps.status === 200) {\n                    console.log('Chaps payment response: ' + xhrTokenChaps.responseText);\n                    var result = JSON.parse(xhrTokenChaps.responseText);\n                    console.log('Result: ' + xhrTokenChaps.responseText);\n\n                    if (result.TxSts == 'SENT') {\n                        scope.result.text = \"Chaps Payment returned Successfully\";\n                        scope.result.success = true;\n                    } else {\n                        scope.result.text = \"Error returning chaps payment. Payment Rejected. Reason: \" + result.StsRsn;\n                        scope.result.success = false;\n                    }\n\n                    scope.result.payment = xhrTokenChaps.responseText;\n                    scope.show = true;\n                    scope.$apply(); \n                } else {\n                    scope.result.text = \"Error returning chaps payment\";\n                    scope.result.payment = xhrTokenChaps.responseText;\n                    scope.result.success = false;\n                    scope.show = true;\n                    scope.$apply(); \n                }\n            }\n\n            scope.submit.inprogress = false;\n            scope.submit.text = \"Return Chaps Payment\"\n        };\n\n        console.log('sending data: ' + data);\n        xhrTokenChaps.send(data);\n    }\n\n    function do_ajax_query_send_token(scope, returnPaymentId, dbtorBIC, data) {\n        scope.show = false;\n        scope.submit.inprogress = true;\n        scope.submit.text = \"Submitting...\";\n        var token = '';\n\n        var xhr = new XMLHttpRequest();\n        var url = \"https://api-0.node.consul:8285/bifrost/login\";\n        console.log('Get user token URL obtained: ' + url);\n        xhr.timeout = 25000; //25 seconds\n        xhr.open(\"POST\", url, true);\n        xhr.setRequestHeader(\"Content-type\", \"application/json\");\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    console.log('Chaps payment response: ' + xhr.responseText);\n                    var result = JSON.parse(xhr.responseText);\n                    token = result.access_token;\n                    console.log('Token retrieved: ' + token);\n                    send_chaps_with_token(token, scope, returnPaymentId, dbtorBIC);\n                } else {\n                    scope.result.text = \"Error getting token\";\n                    scope.result.payment = xhr.responseText;\n                    scope.result.success = false;\n                    scope.submit.inprogress = false;\n                    scope.submit.text = \"Send Chaps Payment\";\n                    scope.show = true;\n                    scope.$apply(); \n                }\n            }\n        };\n\n        console.log('sending token data: ' + data);\n        xhr.send(data);\n    }\n\n    function submit_return_chaps() {\n        var scope = angular.element($(\"#submit-returnChapsPayment-container\")).scope();\n\n        var returnPaymentId = scope.data.returnPaymentId;\n        var dbtorBIC = null;\n\n        if (scope.data.dbtorBIC != null && scope.data.dbtorBIC != undefined && scope.data.dbtorBIC != '') {\n            dbtorBIC = scope.data.dbtorBIC;\n        }\n\n        var tokenData = JSON.stringify(\n        {\n            'usr': scope.data.username,\n            'pwd' : scope.data.password\n        });\n\n        console.log('Return Payment Id: ' + returnPaymentId);\n\n        do_ajax_query_send_token(scope, returnPaymentId, dbtorBIC, tokenData);\n    }\n    \n</script>","user":"jjimenez","dateUpdated":"2018-11-08T13:03:21+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/undefined","editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"ANGULAR","data":"<div  id=\"submit-returnChapsPayment-container\">\n    <div ng-show=\"show\" ng-class=\"{'returnChapsPayment-submit-status-container-failed': !result.success, 'returnChapsPayment-submit-status-container': result.success}\">\n        <div class=\"result-header\">{{result.text}}</div>\n        <div class=\"result-details row\" ng-show=\"show\">\n            <div class=\"col-xs-3\">\n                <label>Chaps Payment: </label>\n                <div>{{result.payment}}</div>\n             </div>\n        </div>\n    </div>\n\n    <form name=\"returnChapsPaymentForm\" id=\"post-returnChapsPayment-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- UserName -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"username\">Username: </label>\n                    <input type=\"text\" name=\"username\" class=\"form-control\" id=\"username\" ng-model=\"data.username\">\n                </div>\n\n                <!-- Password -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"password\">Password: </label>\n                    <input type=\"password\" name=\"password\" class=\"form-control\" id=\"password\" ng-model=\"data.password\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Return Payment Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"returnPaymentId\">Return Payment Id: </label>\n                    <input type=\"text\" name=\"returnPaymentId\" class=\"form-control\" id=\"returnPaymentId\" ng-model=\"data.returnPaymentId\">\n                </div>\n\n                <!-- Debtor BIC -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"dbtorBIC\">Debtor BIC: </label>\n                    <input type=\"text\" name=\"dbtorBIC\" class=\"form-control\" id=\"dbtorBIC\" ng-model=\"data.dbtorBIC\">\n                </div>\n\n                <!-- Creditor BIC -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrBIC\">Creditor BIC: </label>\n                    <input type=\"text\" name=\"cdtrBIC\" class=\"form-control\" id=\"cdtrBIC\" ng-model=\"data.cdtrBIC\">\n                </div>\n\n                <!-- Creditor SortCode -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"cdtrSortcode\">Creditor SortCode: </label>\n                    <input type=\"text\" name=\"cdtrSortcode\" class=\"form-control\" id=\"cdtrSortcode\" ng-model=\"data.cdtrSortcode\">\n                </div>\n            </div>\n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_return_chaps()\" ng-disabled=\"disableReturnButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.returnChapsPayment-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.returnChapsPayment-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-returnChapsPayment-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init return chaps payment');\n        init_returnChapsPayment();\n    });\n\n    function init_returnChapsPayment() {\n        var scope = angular.element($(\"#submit-returnChapsPayment-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Return Chaps Payment'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function() {\n                console.log('Initializing input values');\n                scope.data.dbtorBIC = \"ORUNGB3L\";\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                scope.data = {};\n                scope.generateInputValues(scope);\n            }; \n\n            scope.disableReturnButton = function () {\n                if (scope.submit.inprogress) {\n                    return true;\n                }\n\n                if (scope.data.returnPaymentId == null || scope.data.returnPaymentId == undefined ||scope.data.returnPaymentId == '') {\n                    return true;\n                }\n\n                var choice = 0;\n\n                if (scope.data.cdtrBIC == null || scope.data.cdtrBIC == undefined ||scope.data.cdtrBIC == '') {\n                    choice++;\n                }\n\n                if (scope.data.cdtrSortcode == null || scope.data.cdtrSortcode == undefined ||scope.data.cdtrSortcode == '') {\n                    choice++;\n                }\n\n                if (choice != 1) {\n                    return true;\n                }\n\n                if (scope.data.username == null || scope.data.username == undefined || scope.data.username == '') {\n                    return true;\n                }\n\n                if (scope.data.password == null || scope.data.password == undefined || scope.data.password == '') {\n                    return true;\n                }\n\n                return false;\n            };\n\n        }\n    }\n\n\n\n\n    function getData(scope) {\n        console.log('Generating data ReturnPaymentId: ' + scope.data.returnPaymentId);\n        console.log('DbtorBic: ' + scope.data.dbtorBIC );\n        console.log('CdtrBic: ' + scope.data.cdtrBIC);\n        console.log('cdtrSortcode: ' + scope.data.cdtrSortcode);\n        \n        var data = JSON.stringify(\n        {\n            'returnPaymentId': scope.data.returnPaymentId,\n            'dbtrBIC' : scope.data.dbtorBIC,\n            'cdtrBIC' : scope.data.cdtrBIC,\n            'cdtrSortcode' : scope.data.cdtrSortcode\n        });\n\n        console.log('Data generated: ' + data);\n\n        return data;\n    }\n\n    function send_chaps_with_token(token, scope, returnPaymentId, dbtorBIC) {\n        scope.show = false;\n        scope.submit.inprogress = true;\n        scope.submit.text = \"Submitting...\";\n\n        var xhrTokenChaps = new XMLHttpRequest();\n        var url = \"https://api-0.node.consul:8183/bifrost/chaps/payment/return\";\n\n        var data  = getData(scope);\n\n        console.log('Return chaps payment URL obtained: ' + url);\n        xhrTokenChaps.timeout = 25000; //25 seconds\n        xhrTokenChaps.open(\"POST\", url, true);\n        xhrTokenChaps.setRequestHeader('Authorization', 'Bearer ' + token);\n        xhrTokenChaps.setRequestHeader(\"Content-type\", \"application/json\");\n        xhrTokenChaps.onreadystatechange = function () {\n            if (xhrTokenChaps.readyState === 4) {\n                if (xhrTokenChaps.status === 200) {\n                    console.log('Chaps payment response: ' + xhrTokenChaps.responseText);\n                    var result = JSON.parse(xhrTokenChaps.responseText);\n                    console.log('Result: ' + xhrTokenChaps.responseText);\n\n                    if (result.TxSts == 'SENT') {\n                        scope.result.text = \"Chaps Payment returned Successfully\";\n                        scope.result.success = true;\n                    } else {\n                        scope.result.text = \"Error returning chaps payment. Payment Rejected. Reason: \" + result.StsRsn;\n                        scope.result.success = false;\n                    }\n\n                    scope.result.payment = xhrTokenChaps.responseText;\n                    scope.show = true;\n                    scope.$apply(); \n                } else {\n                    scope.result.text = \"Error returning chaps payment\";\n                    scope.result.payment = xhrTokenChaps.responseText;\n                    scope.result.success = false;\n                    scope.show = true;\n                    scope.$apply(); \n                }\n            }\n\n            scope.submit.inprogress = false;\n            scope.submit.text = \"Return Chaps Payment\"\n        };\n\n        console.log('sending data: ' + data);\n        xhrTokenChaps.send(data);\n    }\n\n    function do_ajax_query_send_token(scope, returnPaymentId, dbtorBIC, data) {\n        scope.show = false;\n        scope.submit.inprogress = true;\n        scope.submit.text = \"Submitting...\";\n        var token = '';\n\n        var xhr = new XMLHttpRequest();\n        var url = \"https://api-0.node.consul:8285/bifrost/login\";\n        console.log('Get user token URL obtained: ' + url);\n        xhr.timeout = 25000; //25 seconds\n        xhr.open(\"POST\", url, true);\n        xhr.setRequestHeader(\"Content-type\", \"application/json\");\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    console.log('Chaps payment response: ' + xhr.responseText);\n                    var result = JSON.parse(xhr.responseText);\n                    token = result.access_token;\n                    console.log('Token retrieved: ' + token);\n                    send_chaps_with_token(token, scope, returnPaymentId, dbtorBIC);\n                } else {\n                    scope.result.text = \"Error getting token\";\n                    scope.result.payment = xhr.responseText;\n                    scope.result.success = false;\n                    scope.submit.inprogress = false;\n                    scope.submit.text = \"Send Chaps Payment\";\n                    scope.show = true;\n                    scope.$apply(); \n                }\n            }\n        };\n\n        console.log('sending token data: ' + data);\n        xhr.send(data);\n    }\n\n    function submit_return_chaps() {\n        var scope = angular.element($(\"#submit-returnChapsPayment-container\")).scope();\n\n        var returnPaymentId = scope.data.returnPaymentId;\n        var dbtorBIC = null;\n\n        if (scope.data.dbtorBIC != null && scope.data.dbtorBIC != undefined && scope.data.dbtorBIC != '') {\n            dbtorBIC = scope.data.dbtorBIC;\n        }\n\n        var tokenData = JSON.stringify(\n        {\n            'usr': scope.data.username,\n            'pwd' : scope.data.password\n        });\n\n        console.log('Return Payment Id: ' + returnPaymentId);\n\n        do_ajax_query_send_token(scope, returnPaymentId, dbtorBIC, tokenData);\n    }\n    \n</script>"}]},"apps":[],"jobName":"paragraph_1533800452164_207109104","id":"20180409-093553_154452000","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:22+0000","dateFinished":"2018-11-08T13:03:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3950"},{"title":"Search Chaps Payment","text":"%angular\n<div  id=\"submit-searchChaps-container\">\n    <div ng-show=\"show\" ng-class=\"{'searchChapsPayment-submit-status-container-failed': !result.success, 'searchChapsPayment-submit-status-container': result.success}\">\n        <div class=\"result-header\">{{result.text}}</div>\n        <div class=\"result-details row\" ng-show=\"show\">\n            <div class=\"col-xs-3\">\n                <label>Chaps Payment: </label>\n                <div>{{result.payment}}</div>\n             </div>\n        </div>\n    </div>\n\n    <form name=\"searchChapsPaymentForm\" id=\"post-searchChapsPayment-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- Payment Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"paymentId\">Payment Id: </label>\n                    <input type=\"text\" name=\"paymentId\" class=\"form-control\" id=\"paymentId\" ng-model=\"data.paymentId\">\n                </div>\n\n                <!-- Direction -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"direction\">Direction: </label>\n                    <select class=\"form-control\" id=\"direction\" ng-model=\"data.direction\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"I\">Inbound</option>\n                        <option value=\"O\">Outbound</option>\n                    </select>\n                </div>\n\n                <!-- Status -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"status\">Status: </label>\n                    <select class=\"form-control\" id=\"status\" ng-model=\"data.status\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"ACSP\">Accepted</option>\n                        <option value=\"RJCT\">Rejected</option>\n                    </select>\n                </div>\n\n                <!-- Credit / Debit -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"creditDebit\">Credit / Debit: </label>\n                    <select class=\"form-control\" id=\"creditDebit\" ng-model=\"data.creditDebit\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"D\">Debit</option>\n                        <option value=\"C\">Credit</option>\n                    </select>\n                </div>\n\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Scheme -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"scheme\">Scheme: </label>\n                    <select class=\"form-control\" id=\"scheme\" ng-model=\"data.scheme\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"pacs.008.001.07\">pacs_008_001_07</option>\n                        <option value=\"pacs.009.001.07\">pacs_009_001_07</option>\n                    </select>\n                </div>\n\n                <!-- Payment Type -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"paymentType\">Payment Type: </label>\n                    <select class=\"form-control\" id=\"paymentType\" ng-model=\"data.paymentType\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"MT103\">MT103</option>\n                        <option value=\"MT202\">MT202</option>\n                        <option value=\"MT202RTN\">MT202RTN</option>\n                        <option value=\"MT202COV\">MT202COV</option>\n                    </select>\n                </div>\n\n                <!-- Payment Timestamp Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"paymentTimestampDate\">Payment Date: </label>\n                    <input type=\"text\" name=\"paymentTimestampDate\" class=\"form-control\" id=\"paymentTimestampDate\" ng-model=\"data.paymentTimestampDate\" placeholder=\"yyyy-mm-dd\">\n                </div>\n\n\n                <!-- Payment Timestamp Time -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"paymentTimestampTime\">Payment Time: </label>\n                    <input type=\"text\" name=\"paymentTimestampTime\" class=\"form-control\" id=\"paymentTimestampTime\" ng-model=\"data.paymentTimestampTime\" placeholder=\"hh:mm:ss\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Transaction Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"transactionId\">Transaction Id: </label>\n                    <input type=\"text\" name=\"transactionId\" class=\"form-control\" id=\"transactionId\" ng-model=\"data.transactionId\">\n                </div>\n\n                <!-- Settlement Amount -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"settlementAmount\">Settlement Amount: </label>\n                    <input type=\"text\" name=\"settlementAmount\" class=\"form-control\" id=\"settlementAmount\" ng-model=\"data.settlementAmount\">\n                </div>\n\n                <!-- Currency -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"currency\">Currency: </label>\n                    <input type=\"text\" name=\"currency\" class=\"form-control\" id=\"currency\" ng-model=\"data.currency\">\n                </div>\n\n                <!-- Status Reason -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"statusReason\">Status Reason: </label>\n                    <input type=\"text\" name=\"statusReason\" class=\"form-control\" id=\"statusReason\" ng-model=\"data.statusReason\">\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Category Purpose -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"categoryPurpose\">Category Purpose: </label>\n                    <input type=\"text\" name=\"categoryPurpose\" class=\"form-control\" id=\"categoryPurpose\" ng-model=\"data.categoryPurpose\">\n                </div>\n\n                <!-- Returned Payment Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"returnedPaymentId\">Returned Payment Id: </label>\n                    <input type=\"text\" name=\"returnedPaymentId\" class=\"form-control\" id=\"returnedPaymentId\" ng-model=\"data.returnedPaymentId\">\n                </div>\n\n                <!-- Return Code -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"returnCode\">Return Code: </label>\n                    <input type=\"text\" name=\"returnCode\" class=\"form-control\" id=\"returnCode\" ng-model=\"data.returnCode\">\n                </div>\n\n                <!-- Remitance Info -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"remitanceInfo\">Remitance Info: </label>\n                    <input type=\"text\" name=\"remitanceInfo\" class=\"form-control\" id=\"remitanceInfo\" ng-model=\"data.remitanceInfo\">\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Creditor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorName\">Creditor Name: </label>\n                    <input type=\"text\" name=\"creditorName\" class=\"form-control\" id=\"creditorName\" ng-model=\"data.creditorName\">\n                </div>\n\n                <!-- Creditor Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAccount\">Creditor Account: </label>\n                    <input type=\"text\" name=\"creditorAccount\" class=\"form-control\" id=\"creditorAccount\" ng-model=\"data.creditorAccount\">\n                </div>\n\n                <!-- Creditor BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorBICFI\">Creditor BICFI: </label>\n                    <input type=\"text\" name=\"creditorBICFI\" class=\"form-control\" id=\"creditorBICFI\" ng-model=\"data.creditorBICFI\">\n                </div>\n\n                <!-- Creditor Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorPostalAddress\">Creditor Postal Address: </label>\n                    <input type=\"text\" name=\"creditorPostalAddress\" class=\"form-control\" id=\"creditorPostalAddress\" ng-model=\"data.creditorPostalAddress\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Debtor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorName\">Debtor Name: </label>\n                    <input type=\"text\" name=\"debtorName\" class=\"form-control\" id=\"debtorName\" ng-model=\"data.debtorName\">\n                </div>\n\n                <!-- Debtor Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAccount\">Debtor Account: </label>\n                    <input type=\"text\" name=\"debtorAccount\" class=\"form-control\" id=\"debtorAccount\" ng-model=\"data.debtorAccount\">\n                </div>\n\n                <!-- Debtor BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorBICFI\">Debtor BICFI: </label>\n                    <input type=\"text\" name=\"debtorBICFI\" class=\"form-control\" id=\"debtorBICFI\" ng-model=\"data.debtorBICFI\">\n                </div>\n\n                <!-- Debtor Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorPostalAddress\">Debtor Postal Address: </label>\n                    <input type=\"text\" name=\"debtorPostalAddress\" class=\"form-control\" id=\"debtorPostalAddress\" ng-model=\"data.debtorPostalAddress\">\n                </div>\n            </div> \n\n            <div class=\"row\">\n                <!-- Intermediary Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"intermediaryName\">Intermediary Name: </label>\n                    <input type=\"text\" name=\"intermediaryName\" class=\"form-control\" id=\"intermediaryName\" ng-model=\"data.intermediaryName\">\n                </div>\n\n                <!-- Intermediary Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"intermediaryAccount\">Intermediary Account: </label>\n                    <input type=\"text\" name=\"intermediaryAccount\" class=\"form-control\" id=\"intermediaryAccount\" ng-model=\"data.intermediaryAccount\">\n                </div>\n\n                <!-- Intermediary BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"intermediaryBICFI\">Intermediary BICFI: </label>\n                    <input type=\"text\" name=\"intermediaryBICFI\" class=\"form-control\" id=\"intermediaryBICFI\" ng-model=\"data.intermediaryBICFI\">\n                </div>\n\n                <!-- Intermediary Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"intermediaryPostalAddress\">Intermediary Postal Address: </label>\n                    <input type=\"text\" name=\"intermediaryPostalAddress\" class=\"form-control\" id=\"intermediaryPostalAddress\" ng-model=\"data.intermediaryPostalAddress\">\n                </div>\n            </div> \n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_search_chaps()\" ng-disabled=\"disableSubmitButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.searchChapsPayment-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.searchChapsPayment-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-searchChaps-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init search chaps payment');\n        init_searchChapsPayment();\n    });\n\n    function init_searchChapsPayment() {\n        \n        var scope = angular.element($(\"#submit-searchChaps-container\")).scope();\n        if (typeof(scope.result) === \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Search Chaps Payment'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function(scope) {\n                console.log('Initializing input values');\n                scope.data.direction = \"0\";\n                scope.data.status = \"0\";\n                scope.data.creditDebit = \"0\";\n                scope.data.scheme = \"0\";\n                scope.data.paymentType = \"0\";\n                scope.data.paymentTimestampDate = '';\n                scope.data.paymentTimestampTime = '';\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                var scope2 = angular.element($(\"#submit-searchChaps-container\")).scope();\n                scope2.data = {};\n                scope2.generateInputValues(scope2);\n            };\n\n            \n\n            scope.getActualDate = function() {\n                var today = new Date();\n                var dd = today.getDate();\n                var mm = today.getMonth()+1; //January is 0!\n                var yyyy = today.getFullYear();\n\n                if(dd<10) {\n                    dd = '0'+dd\n                } \n\n                if(mm<10) {\n                    mm = '0'+mm\n                } \n\n                today = yyyy + '-' + mm + '-' + dd;\n                console.log('Actual date generated: ' + today);\n                return today;\n            };\n\n            scope.validateDate = function(dateStr) {\n                if(!/^\\d{4}\\-\\d{2}\\-\\d{2}$/.test(dateStr))\n                    return false;\n\n                var params = dateStr.split('-');\n\n                var year = parseInt(params[0]);\n                var month = parseInt(params[1]);\n                var day = parseInt(params[2]);\n                \n\n                console.log('Payment Date ', day, month, year);\n\n                if (year < 2000 || year > 2050 || month < 1 || month > 12 || day < 0 || day > 31)\n                    return false;\n\n                var monthLength = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];\n\n                if(year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))\n                    monthLength[1] = 29;\n\n                if (day > monthLength[month -1])\n                    return false;\n\n                return true;\n            };\n\n            scope.validateTime = function(timeStr) {\n                if(!/^\\d{2}:\\d{2}:\\d{2}$/.test(timeStr))\n                    return false;\n\n                var params = timeStr.split(':');\n\n                var hour = parseInt(params[0]);\n                var minute = parseInt(params[1]);\n                var second = parseInt(params[2]);\n\n                console.log('Payment Time ', hour, minute, second);\n\n                if (hour < 0 || hour > 23 || minute < 0 || minute > 59 || second < 0 || second > 59)\n                    return false;\n\n                return true;\n            };\n\n            scope.disableSubmitButton = function() {\n                var scope2 = angular.element($(\"#submit-searchChaps-container\")).scope();\n                var result = false;\n\n                if (scope2.data.paymentTimestampDate !== null && scope2.data.paymentTimestampDate !== undefined && scope2.data.paymentTimestampDate !== '') {\n                    if (!scope2.validateDate(scope2.data.paymentTimestampDate)) {\n                        result = true;\n                    }\n                }\n\n                if (scope2.data.paymentTimestampTime !== null && scope2.data.paymentTimestampTime !== undefined && scope2.data.paymentTimestampTime !== '') {\n                    if (!scope2.validateTime(scope2.data.paymentTimestampTime)) {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n\n        }\n    }\n\n    function getObjStr(field, value, exactMatch){\n        var result = '{\"field\":';\n        result = result.concat('\"').concat(field).concat('\", \"value\":\"').concat(value).concat('\", \"exactMatch\":').concat(exactMatch).concat('}');\n        return result;\n    }\n\n    \n\n    function checkAnyFieldFilled(scope) {\n        var result = [];\n\n        console.log('paymentType: ' + scope.data.paymentType.toString());\n        console.log('scheme: ' + scope.data.scheme.toString());\n        console.log('direction: ' + scope.data.direction.toString());\n        console.log('status: ' + scope.data.status.toString());\n        console.log('creditDebit: ' + scope.data.creditDebit.toString());\n\n\n\n        try {\n\n            if (scope.data.direction != null && scope.data.direction != undefined && scope.data.direction != \"0\")\n                result.push(getObjStr(\"direction\", scope.data.direction.toString(), true));\n\n            if (scope.data.status != null && scope.data.status != undefined && scope.data.status != \"0\")\n                result.push(getObjStr(\"txstatus\", scope.data.status.toString(), true));\n\n            if (scope.data.creditDebit != null && scope.data.creditDebit != undefined && scope.data.creditDebit != \"0\")\n                result.push(getObjStr(\"cdtdbtind\", scope.data.creditDebit.toString(), true));\n\n            if (scope.data.scheme != null && scope.data.scheme != undefined && scope.data.scheme != \"0\")\n                result.push(getObjStr(\"paymentscheme\", scope.data.scheme.toString(), true));\n\n            if (scope.data.paymentType != null && scope.data.paymentType != undefined && scope.data.paymentType != \"0\")\n                result.push(getObjStr(\"paymenttype\", scope.data.paymentType.toString(), true));\n\n            if (scope.data.paymentId != null && scope.data.paymentId != undefined && scope.data.paymentId != '')\n                result.push(getObjStr(\"paymentId\", scope.data.paymentId.toString(), false));\n\n            if (scope.data.statusReason != null && scope.data.statusReason != undefined && scope.data.statusReason != '')\n                result.push(getObjStr(\"stsrsninf\", scope.data.statusReason.toString(), false));\n\n            if (scope.data.transactionId != null && scope.data.transactionId != undefined && scope.data.transactionId != '')\n                result.push(getObjStr(\"txid\", scope.data.transactionId.toString(), false));\n\n            if (scope.data.settlementAmount != null && scope.data.settlementAmount != undefined && scope.data.settlementAmount != '')\n                result.push(getObjStr(\"intrbksttlamt\", scope.data.settlementAmount.toString(), false));\n\n            if (scope.data.currency != null && scope.data.currency != undefined && scope.data.currency != '')\n                result.push(getObjStr(\"intrbksttlccy\", scope.data.currency.toString(), false));\n\n            if (scope.data.categoryPurpose != null && scope.data.categoryPurpose != undefined && scope.data.categoryPurpose != '')\n                result.push(getObjStr(\"ctgypurp\", scope.data.categoryPurpose.toString(), false));\n\n            if (scope.data.intermediaryName != null && scope.data.intermediaryName != undefined && scope.data.intermediaryName != '')\n                result.push(getObjStr(\"intrmydagt1_nm\", scope.data.intermediaryName.toString(), false));\n\n            if (scope.data.intermediaryPostalAddress != null && scope.data.intermediaryPostalAddress != undefined && scope.data.intermediaryPostalAddress != '')\n                result.push(getObjStr(\"intrmydagt1_nm\", scope.data.intermediaryPostalAddress.toString(), false));\n\n            if (scope.data.intermediaryAccount != null && scope.data.intermediaryAccount != undefined && scope.data.intermediaryAccount != '')\n                result.push(getObjStr(\"intrmydagt1_pstladr\", scope.data.intermediaryAccount.toString(), false));\n\n            if (scope.data.intermediaryBICFI != null && scope.data.intermediaryBICFI != undefined && scope.data.intermediaryBICFI != '')\n                result.push(getObjStr(\"intrmydagt1_bicfi\", scope.data.intermediaryBICFI.toString(), false));\n\n            if (scope.data.debtorName != null && scope.data.debtorName != undefined && scope.data.debtorName != '')\n                result.push(getObjStr(\"dbtragt_nm\", scope.data.debtorName.toString(), false));\n\n            if (scope.data.debtorPostalAddress != null && scope.data.debtorPostalAddress != undefined && scope.data.debtorPostalAddress != '')\n                result.push(getObjStr(\"dbtragt_pstladr\", scope.data.debtorPostalAddress.toString(), false));\n\n            if (scope.data.debtorAccount != null && scope.data.debtorAccount != undefined && scope.data.debtorAccount != '')\n                result.push(getObjStr(\"dbtragt_acct\", scope.data.debtorAccount.toString(), false));\n\n            if (scope.data.debtorBICFI != null && scope.data.debtorBICFI != undefined && scope.data.debtorBICFI != '')\n                result.push(getObjStr(\"dbtragt_bicfi\", scope.data.debtorBICFI.toString(), false));\n\n            if (scope.data.creditorName != null && scope.data.creditorName != undefined && scope.data.creditorName != '')\n                result.push(getObjStr(\"cdtragt_nm\", scope.data.creditorName.toString(), false));\n\n            if (scope.data.creditorPostalAddress != null && scope.data.creditorPostalAddress != undefined && scope.data.creditorPostalAddress != '')\n                result.push(getObjStr(\"cdtragt_pstladr\", scope.data.creditorPostalAddress.toString(), false));\n\n            if (scope.data.creditorAccount != null && scope.data.creditorAccount != undefined && scope.data.creditorAccount != '')\n                result.push(getObjStr(\"cdtragt_acct\", scope.data.creditorAccount.toString(), false));\n\n            if (scope.data.creditorBICFI != null && scope.data.creditorBICFI != undefined && scope.data.creditorBICFI != '')\n                result.push(getObjStr(\"cdtragt_bicfi\", scope.data.creditorBICFI.toString(), false));\n\n            if (scope.data.returnedPaymentId != null && scope.data.returnedPaymentId != undefined && scope.data.returnedPaymentId != '')\n                result.push(getObjStr(\"returnedpaymentid\", scope.data.returnedPaymentId.toString(), false));\n\n            if (scope.data.returnCode != null && scope.data.returnCode != undefined && scope.data.returnCode != '')\n                result.push(getObjStr(\"returncode\", scope.data.returnCode.toString(), false));\n\n            if (scope.data.remitanceInfo != null && scope.data.remitanceInfo != undefined && scope.data.remitanceInfo != '')\n                result.push(getObjStr(\"rmtinf\", scope.data.remitanceInfo.toString(), false));\n            \n        } catch (err) {\n            console.error('Error parsing fields. Error message: ' + err);\n        }\n\n        console.log('Result: ' + result);\n\n        var results = JSON.parse(\"[\" + result + \"]\");\n\n        console.log('Result JSON: ' + JSON.stringify(result));\n\n        return results;\n    }\n\n    function doQuery(scope) {\n        var sqlString = '';\n\n        var fields = checkAnyFieldFilled(scope);\n\n        console.log('fields: ' + fields);\n\n        if (fields.length > 0) {\n            var and = false;\n            sqlString = \"WHERE \";\n\n            for (i = 0; i < fields.length; i++) { \n                var obj = fields[i];\n                if (and)\n                    sqlString = sqlString.concat(\" AND \");\n\n\n                sqlString = sqlString.concat(obj.field);\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\" LIKE '%\");\n                else\n                    sqlString = sqlString.concat(\" = '\");\n\n                sqlString = sqlString.concat(obj.value);\n\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\"%\");\n\n                sqlString = sqlString.concat(\"'\");\n\n                and = true;\n            }\n        }\n\n        var queryDateTimes = addDateTimes(scope, and);\n        sqlString = sqlString.concat(queryDateTimes);\n\n        console.log(\"Query: \" + sqlString);\n        return sqlString;\n    }\n\n    function addDateTimes(scope, and) {\n        console.log('Generating Date & Time Query');\n        var sqlString = \"\";\n\n        if ((scope.data.paymentTimestampDate !== null && scope.data.paymentTimestampDate !== undefined && scope.data.paymentTimestampDate !== '') ||\n            (scope.data.paymentTimestampTime !== null && scope.data.paymentTimestampTime !== undefined && scope.data.paymentTimestampTime !== '')) {\n            console.log(\"Retrieving dates.\");\n\n            if (!and) {\n                sqlString = sqlString.concat(\" WHERE \");\n            }\n\n            var paymentTimestampDateFilled = false;\n            var paymentTimestampTimeFilled = false;\n        \n            var paymentTimestampDateTimeFilled = false;\n    \n\n            var paymentTimestampTimeStr = \"00:00:00\";\n            var paymentEndTimestampTimeStr = \"23:59:59\";\n        \n\n            var paymentTimestampDateTimeStr;\n            var paymentEndTimestampDateTimeStr;\n    \n\n\n            if (scope.data.paymentTimestampDate !== null && scope.data.paymentTimestampDate !== undefined && scope.data.paymentTimestampDate !== '') {\n                paymentTimestampDateFilled = true;\n            }\n            if (scope.data.paymentTimestampTime !== null && scope.data.paymentTimestampTime !== undefined && scope.data.paymentTimestampTime !== '') {\n                paymentTimestampTimeFilled = true;\n            }\n        \n\n        \n            if (paymentTimestampDateFilled && paymentTimestampTimeFilled) {\n                paymentTimestampDateTimeStr = scope.data.paymentTimestampDate + \" \" + scope.data.paymentTimestampTime;\n            } else if(paymentTimestampDateFilled && !paymentTimestampTimeFilled) {\n                paymentTimestampDateTimeStr = scope.data.paymentTimestampDate + \" \" + paymentTimestampTimeStr;\n            } else if (!paymentTimestampDateFilled && paymentTimestampTimeFilled) {\n                paymentTimestampDateTimeStr =  scope.getActualDate() + \" \" + scope.data.paymentTimestampTime;\n            }\n    \n\n            if (paymentTimestampDateTimeStr !== null && paymentTimestampDateTimeStr !== undefined && paymentTimestampDateTimeStr !== '') {\n                paymentTimestampDateTimeFilled = true;\n                if(paymentTimestampDateFilled){\n                    paymentEndTimestampDateTimeStr = scope.data.paymentTimestampDate + \" \" + paymentEndTimestampTimeStr;\n                }else{\n                    paymentEndTimestampDateTimeStr = scope.getActualDate() + \" \" + paymentEndTimestampTimeStr;\n                }\n                \n            }\n\n            if (paymentTimestampDateTimeFilled) {\n                if (and) {\n                    sqlString = sqlString + \" AND \";\n                }\n            \n                sqlString = sqlString + \"paymenttimestamp >= '\" + paymentTimestampDateTimeStr+\"' AND paymenttimestamp <= '\" + paymentEndTimestampDateTimeStr+\"'\";\n            }\n        }\n\n        console.log('Query: ' + sqlString);\n        return sqlString;\n    }\n\n\n    function submit_search_chaps() {\n        var scope = angular.element($(\"#submit-searchChaps-container\")).scope();\n\n        \n        var query = doQuery(scope);\n\n        console.log('Submitting search payment ', query);\n        \n        scope.z.angularBind('query', query, '20180619-073855_945887381');\n        scope.z.runParagraph('20180619-073855_945887381');\n\n    }\n\n    \n</script>","user":"jjimenez","dateUpdated":"2018-11-08T13:03:22+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":6,"editorMode":"ace/mode/undefined","editorHide":true,"title":true,"results":{"0":{"graph":{"mode":"table","height":613.5,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"ANGULAR","data":"<div  id=\"submit-searchChaps-container\">\n    <div ng-show=\"show\" ng-class=\"{'searchChapsPayment-submit-status-container-failed': !result.success, 'searchChapsPayment-submit-status-container': result.success}\">\n        <div class=\"result-header\">{{result.text}}</div>\n        <div class=\"result-details row\" ng-show=\"show\">\n            <div class=\"col-xs-3\">\n                <label>Chaps Payment: </label>\n                <div>{{result.payment}}</div>\n             </div>\n        </div>\n    </div>\n\n    <form name=\"searchChapsPaymentForm\" id=\"post-searchChapsPayment-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- Payment Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"paymentId\">Payment Id: </label>\n                    <input type=\"text\" name=\"paymentId\" class=\"form-control\" id=\"paymentId\" ng-model=\"data.paymentId\">\n                </div>\n\n                <!-- Direction -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"direction\">Direction: </label>\n                    <select class=\"form-control\" id=\"direction\" ng-model=\"data.direction\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"I\">Inbound</option>\n                        <option value=\"O\">Outbound</option>\n                    </select>\n                </div>\n\n                <!-- Status -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"status\">Status: </label>\n                    <select class=\"form-control\" id=\"status\" ng-model=\"data.status\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"ACSP\">Accepted</option>\n                        <option value=\"RJCT\">Rejected</option>\n                    </select>\n                </div>\n\n                <!-- Credit / Debit -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"creditDebit\">Credit / Debit: </label>\n                    <select class=\"form-control\" id=\"creditDebit\" ng-model=\"data.creditDebit\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"D\">Debit</option>\n                        <option value=\"C\">Credit</option>\n                    </select>\n                </div>\n\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Scheme -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"scheme\">Scheme: </label>\n                    <select class=\"form-control\" id=\"scheme\" ng-model=\"data.scheme\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"pacs.008.001.07\">pacs_008_001_07</option>\n                        <option value=\"pacs.009.001.07\">pacs_009_001_07</option>\n                    </select>\n                </div>\n\n                <!-- Payment Type -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"paymentType\">Payment Type: </label>\n                    <select class=\"form-control\" id=\"paymentType\" ng-model=\"data.paymentType\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"MT103\">MT103</option>\n                        <option value=\"MT202\">MT202</option>\n                        <option value=\"MT202RTN\">MT202RTN</option>\n                        <option value=\"MT202COV\">MT202COV</option>\n                    </select>\n                </div>\n\n                <!-- Payment Timestamp Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"paymentTimestampDate\">Payment Date: </label>\n                    <input type=\"text\" name=\"paymentTimestampDate\" class=\"form-control\" id=\"paymentTimestampDate\" ng-model=\"data.paymentTimestampDate\" placeholder=\"yyyy-mm-dd\">\n                </div>\n\n\n                <!-- Payment Timestamp Time -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"paymentTimestampTime\">Payment Time: </label>\n                    <input type=\"text\" name=\"paymentTimestampTime\" class=\"form-control\" id=\"paymentTimestampTime\" ng-model=\"data.paymentTimestampTime\" placeholder=\"hh:mm:ss\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Transaction Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"transactionId\">Transaction Id: </label>\n                    <input type=\"text\" name=\"transactionId\" class=\"form-control\" id=\"transactionId\" ng-model=\"data.transactionId\">\n                </div>\n\n                <!-- Settlement Amount -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"settlementAmount\">Settlement Amount: </label>\n                    <input type=\"text\" name=\"settlementAmount\" class=\"form-control\" id=\"settlementAmount\" ng-model=\"data.settlementAmount\">\n                </div>\n\n                <!-- Currency -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"currency\">Currency: </label>\n                    <input type=\"text\" name=\"currency\" class=\"form-control\" id=\"currency\" ng-model=\"data.currency\">\n                </div>\n\n                <!-- Status Reason -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"statusReason\">Status Reason: </label>\n                    <input type=\"text\" name=\"statusReason\" class=\"form-control\" id=\"statusReason\" ng-model=\"data.statusReason\">\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Category Purpose -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"categoryPurpose\">Category Purpose: </label>\n                    <input type=\"text\" name=\"categoryPurpose\" class=\"form-control\" id=\"categoryPurpose\" ng-model=\"data.categoryPurpose\">\n                </div>\n\n                <!-- Returned Payment Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"returnedPaymentId\">Returned Payment Id: </label>\n                    <input type=\"text\" name=\"returnedPaymentId\" class=\"form-control\" id=\"returnedPaymentId\" ng-model=\"data.returnedPaymentId\">\n                </div>\n\n                <!-- Return Code -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"returnCode\">Return Code: </label>\n                    <input type=\"text\" name=\"returnCode\" class=\"form-control\" id=\"returnCode\" ng-model=\"data.returnCode\">\n                </div>\n\n                <!-- Remitance Info -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"remitanceInfo\">Remitance Info: </label>\n                    <input type=\"text\" name=\"remitanceInfo\" class=\"form-control\" id=\"remitanceInfo\" ng-model=\"data.remitanceInfo\">\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Creditor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorName\">Creditor Name: </label>\n                    <input type=\"text\" name=\"creditorName\" class=\"form-control\" id=\"creditorName\" ng-model=\"data.creditorName\">\n                </div>\n\n                <!-- Creditor Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAccount\">Creditor Account: </label>\n                    <input type=\"text\" name=\"creditorAccount\" class=\"form-control\" id=\"creditorAccount\" ng-model=\"data.creditorAccount\">\n                </div>\n\n                <!-- Creditor BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorBICFI\">Creditor BICFI: </label>\n                    <input type=\"text\" name=\"creditorBICFI\" class=\"form-control\" id=\"creditorBICFI\" ng-model=\"data.creditorBICFI\">\n                </div>\n\n                <!-- Creditor Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorPostalAddress\">Creditor Postal Address: </label>\n                    <input type=\"text\" name=\"creditorPostalAddress\" class=\"form-control\" id=\"creditorPostalAddress\" ng-model=\"data.creditorPostalAddress\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Debtor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorName\">Debtor Name: </label>\n                    <input type=\"text\" name=\"debtorName\" class=\"form-control\" id=\"debtorName\" ng-model=\"data.debtorName\">\n                </div>\n\n                <!-- Debtor Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAccount\">Debtor Account: </label>\n                    <input type=\"text\" name=\"debtorAccount\" class=\"form-control\" id=\"debtorAccount\" ng-model=\"data.debtorAccount\">\n                </div>\n\n                <!-- Debtor BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorBICFI\">Debtor BICFI: </label>\n                    <input type=\"text\" name=\"debtorBICFI\" class=\"form-control\" id=\"debtorBICFI\" ng-model=\"data.debtorBICFI\">\n                </div>\n\n                <!-- Debtor Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorPostalAddress\">Debtor Postal Address: </label>\n                    <input type=\"text\" name=\"debtorPostalAddress\" class=\"form-control\" id=\"debtorPostalAddress\" ng-model=\"data.debtorPostalAddress\">\n                </div>\n            </div> \n\n            <div class=\"row\">\n                <!-- Intermediary Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"intermediaryName\">Intermediary Name: </label>\n                    <input type=\"text\" name=\"intermediaryName\" class=\"form-control\" id=\"intermediaryName\" ng-model=\"data.intermediaryName\">\n                </div>\n\n                <!-- Intermediary Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"intermediaryAccount\">Intermediary Account: </label>\n                    <input type=\"text\" name=\"intermediaryAccount\" class=\"form-control\" id=\"intermediaryAccount\" ng-model=\"data.intermediaryAccount\">\n                </div>\n\n                <!-- Intermediary BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"intermediaryBICFI\">Intermediary BICFI: </label>\n                    <input type=\"text\" name=\"intermediaryBICFI\" class=\"form-control\" id=\"intermediaryBICFI\" ng-model=\"data.intermediaryBICFI\">\n                </div>\n\n                <!-- Intermediary Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"intermediaryPostalAddress\">Intermediary Postal Address: </label>\n                    <input type=\"text\" name=\"intermediaryPostalAddress\" class=\"form-control\" id=\"intermediaryPostalAddress\" ng-model=\"data.intermediaryPostalAddress\">\n                </div>\n            </div> \n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_search_chaps()\" ng-disabled=\"disableSubmitButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.searchChapsPayment-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.searchChapsPayment-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-searchChaps-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init search chaps payment');\n        init_searchChapsPayment();\n    });\n\n    function init_searchChapsPayment() {\n        \n        var scope = angular.element($(\"#submit-searchChaps-container\")).scope();\n        if (typeof(scope.result) === \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Search Chaps Payment'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function(scope) {\n                console.log('Initializing input values');\n                scope.data.direction = \"0\";\n                scope.data.status = \"0\";\n                scope.data.creditDebit = \"0\";\n                scope.data.scheme = \"0\";\n                scope.data.paymentType = \"0\";\n                scope.data.paymentTimestampDate = '';\n                scope.data.paymentTimestampTime = '';\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                var scope2 = angular.element($(\"#submit-searchChaps-container\")).scope();\n                scope2.data = {};\n                scope2.generateInputValues(scope2);\n            };\n\n            \n\n            scope.getActualDate = function() {\n                var today = new Date();\n                var dd = today.getDate();\n                var mm = today.getMonth()+1; //January is 0!\n                var yyyy = today.getFullYear();\n\n                if(dd<10) {\n                    dd = '0'+dd\n                } \n\n                if(mm<10) {\n                    mm = '0'+mm\n                } \n\n                today = yyyy + '-' + mm + '-' + dd;\n                console.log('Actual date generated: ' + today);\n                return today;\n            };\n\n            scope.validateDate = function(dateStr) {\n                if(!/^\\d{4}\\-\\d{2}\\-\\d{2}$/.test(dateStr))\n                    return false;\n\n                var params = dateStr.split('-');\n\n                var year = parseInt(params[0]);\n                var month = parseInt(params[1]);\n                var day = parseInt(params[2]);\n                \n\n                console.log('Payment Date ', day, month, year);\n\n                if (year < 2000 || year > 2050 || month < 1 || month > 12 || day < 0 || day > 31)\n                    return false;\n\n                var monthLength = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];\n\n                if(year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))\n                    monthLength[1] = 29;\n\n                if (day > monthLength[month -1])\n                    return false;\n\n                return true;\n            };\n\n            scope.validateTime = function(timeStr) {\n                if(!/^\\d{2}:\\d{2}:\\d{2}$/.test(timeStr))\n                    return false;\n\n                var params = timeStr.split(':');\n\n                var hour = parseInt(params[0]);\n                var minute = parseInt(params[1]);\n                var second = parseInt(params[2]);\n\n                console.log('Payment Time ', hour, minute, second);\n\n                if (hour < 0 || hour > 23 || minute < 0 || minute > 59 || second < 0 || second > 59)\n                    return false;\n\n                return true;\n            };\n\n            scope.disableSubmitButton = function() {\n                var scope2 = angular.element($(\"#submit-searchChaps-container\")).scope();\n                var result = false;\n\n                if (scope2.data.paymentTimestampDate !== null && scope2.data.paymentTimestampDate !== undefined && scope2.data.paymentTimestampDate !== '') {\n                    if (!scope2.validateDate(scope2.data.paymentTimestampDate)) {\n                        result = true;\n                    }\n                }\n\n                if (scope2.data.paymentTimestampTime !== null && scope2.data.paymentTimestampTime !== undefined && scope2.data.paymentTimestampTime !== '') {\n                    if (!scope2.validateTime(scope2.data.paymentTimestampTime)) {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n\n        }\n    }\n\n    function getObjStr(field, value, exactMatch){\n        var result = '{\"field\":';\n        result = result.concat('\"').concat(field).concat('\", \"value\":\"').concat(value).concat('\", \"exactMatch\":').concat(exactMatch).concat('}');\n        return result;\n    }\n\n    \n\n    function checkAnyFieldFilled(scope) {\n        var result = [];\n\n        console.log('paymentType: ' + scope.data.paymentType.toString());\n        console.log('scheme: ' + scope.data.scheme.toString());\n        console.log('direction: ' + scope.data.direction.toString());\n        console.log('status: ' + scope.data.status.toString());\n        console.log('creditDebit: ' + scope.data.creditDebit.toString());\n\n\n\n        try {\n\n            if (scope.data.direction != null && scope.data.direction != undefined && scope.data.direction != \"0\")\n                result.push(getObjStr(\"direction\", scope.data.direction.toString(), true));\n\n            if (scope.data.status != null && scope.data.status != undefined && scope.data.status != \"0\")\n                result.push(getObjStr(\"txstatus\", scope.data.status.toString(), true));\n\n            if (scope.data.creditDebit != null && scope.data.creditDebit != undefined && scope.data.creditDebit != \"0\")\n                result.push(getObjStr(\"cdtdbtind\", scope.data.creditDebit.toString(), true));\n\n            if (scope.data.scheme != null && scope.data.scheme != undefined && scope.data.scheme != \"0\")\n                result.push(getObjStr(\"paymentscheme\", scope.data.scheme.toString(), true));\n\n            if (scope.data.paymentType != null && scope.data.paymentType != undefined && scope.data.paymentType != \"0\")\n                result.push(getObjStr(\"paymenttype\", scope.data.paymentType.toString(), true));\n\n            if (scope.data.paymentId != null && scope.data.paymentId != undefined && scope.data.paymentId != '')\n                result.push(getObjStr(\"paymentId\", scope.data.paymentId.toString(), false));\n\n            if (scope.data.statusReason != null && scope.data.statusReason != undefined && scope.data.statusReason != '')\n                result.push(getObjStr(\"stsrsninf\", scope.data.statusReason.toString(), false));\n\n            if (scope.data.transactionId != null && scope.data.transactionId != undefined && scope.data.transactionId != '')\n                result.push(getObjStr(\"txid\", scope.data.transactionId.toString(), false));\n\n            if (scope.data.settlementAmount != null && scope.data.settlementAmount != undefined && scope.data.settlementAmount != '')\n                result.push(getObjStr(\"intrbksttlamt\", scope.data.settlementAmount.toString(), false));\n\n            if (scope.data.currency != null && scope.data.currency != undefined && scope.data.currency != '')\n                result.push(getObjStr(\"intrbksttlccy\", scope.data.currency.toString(), false));\n\n            if (scope.data.categoryPurpose != null && scope.data.categoryPurpose != undefined && scope.data.categoryPurpose != '')\n                result.push(getObjStr(\"ctgypurp\", scope.data.categoryPurpose.toString(), false));\n\n            if (scope.data.intermediaryName != null && scope.data.intermediaryName != undefined && scope.data.intermediaryName != '')\n                result.push(getObjStr(\"intrmydagt1_nm\", scope.data.intermediaryName.toString(), false));\n\n            if (scope.data.intermediaryPostalAddress != null && scope.data.intermediaryPostalAddress != undefined && scope.data.intermediaryPostalAddress != '')\n                result.push(getObjStr(\"intrmydagt1_nm\", scope.data.intermediaryPostalAddress.toString(), false));\n\n            if (scope.data.intermediaryAccount != null && scope.data.intermediaryAccount != undefined && scope.data.intermediaryAccount != '')\n                result.push(getObjStr(\"intrmydagt1_pstladr\", scope.data.intermediaryAccount.toString(), false));\n\n            if (scope.data.intermediaryBICFI != null && scope.data.intermediaryBICFI != undefined && scope.data.intermediaryBICFI != '')\n                result.push(getObjStr(\"intrmydagt1_bicfi\", scope.data.intermediaryBICFI.toString(), false));\n\n            if (scope.data.debtorName != null && scope.data.debtorName != undefined && scope.data.debtorName != '')\n                result.push(getObjStr(\"dbtragt_nm\", scope.data.debtorName.toString(), false));\n\n            if (scope.data.debtorPostalAddress != null && scope.data.debtorPostalAddress != undefined && scope.data.debtorPostalAddress != '')\n                result.push(getObjStr(\"dbtragt_pstladr\", scope.data.debtorPostalAddress.toString(), false));\n\n            if (scope.data.debtorAccount != null && scope.data.debtorAccount != undefined && scope.data.debtorAccount != '')\n                result.push(getObjStr(\"dbtragt_acct\", scope.data.debtorAccount.toString(), false));\n\n            if (scope.data.debtorBICFI != null && scope.data.debtorBICFI != undefined && scope.data.debtorBICFI != '')\n                result.push(getObjStr(\"dbtragt_bicfi\", scope.data.debtorBICFI.toString(), false));\n\n            if (scope.data.creditorName != null && scope.data.creditorName != undefined && scope.data.creditorName != '')\n                result.push(getObjStr(\"cdtragt_nm\", scope.data.creditorName.toString(), false));\n\n            if (scope.data.creditorPostalAddress != null && scope.data.creditorPostalAddress != undefined && scope.data.creditorPostalAddress != '')\n                result.push(getObjStr(\"cdtragt_pstladr\", scope.data.creditorPostalAddress.toString(), false));\n\n            if (scope.data.creditorAccount != null && scope.data.creditorAccount != undefined && scope.data.creditorAccount != '')\n                result.push(getObjStr(\"cdtragt_acct\", scope.data.creditorAccount.toString(), false));\n\n            if (scope.data.creditorBICFI != null && scope.data.creditorBICFI != undefined && scope.data.creditorBICFI != '')\n                result.push(getObjStr(\"cdtragt_bicfi\", scope.data.creditorBICFI.toString(), false));\n\n            if (scope.data.returnedPaymentId != null && scope.data.returnedPaymentId != undefined && scope.data.returnedPaymentId != '')\n                result.push(getObjStr(\"returnedpaymentid\", scope.data.returnedPaymentId.toString(), false));\n\n            if (scope.data.returnCode != null && scope.data.returnCode != undefined && scope.data.returnCode != '')\n                result.push(getObjStr(\"returncode\", scope.data.returnCode.toString(), false));\n\n            if (scope.data.remitanceInfo != null && scope.data.remitanceInfo != undefined && scope.data.remitanceInfo != '')\n                result.push(getObjStr(\"rmtinf\", scope.data.remitanceInfo.toString(), false));\n            \n        } catch (err) {\n            console.error('Error parsing fields. Error message: ' + err);\n        }\n\n        console.log('Result: ' + result);\n\n        var results = JSON.parse(\"[\" + result + \"]\");\n\n        console.log('Result JSON: ' + JSON.stringify(result));\n\n        return results;\n    }\n\n    function doQuery(scope) {\n        var sqlString = '';\n\n        var fields = checkAnyFieldFilled(scope);\n\n        console.log('fields: ' + fields);\n\n        if (fields.length > 0) {\n            var and = false;\n            sqlString = \"WHERE \";\n\n            for (i = 0; i < fields.length; i++) { \n                var obj = fields[i];\n                if (and)\n                    sqlString = sqlString.concat(\" AND \");\n\n\n                sqlString = sqlString.concat(obj.field);\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\" LIKE '%\");\n                else\n                    sqlString = sqlString.concat(\" = '\");\n\n                sqlString = sqlString.concat(obj.value);\n\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\"%\");\n\n                sqlString = sqlString.concat(\"'\");\n\n                and = true;\n            }\n        }\n\n        var queryDateTimes = addDateTimes(scope, and);\n        sqlString = sqlString.concat(queryDateTimes);\n\n        console.log(\"Query: \" + sqlString);\n        return sqlString;\n    }\n\n    function addDateTimes(scope, and) {\n        console.log('Generating Date & Time Query');\n        var sqlString = \"\";\n\n        if ((scope.data.paymentTimestampDate !== null && scope.data.paymentTimestampDate !== undefined && scope.data.paymentTimestampDate !== '') ||\n            (scope.data.paymentTimestampTime !== null && scope.data.paymentTimestampTime !== undefined && scope.data.paymentTimestampTime !== '')) {\n            console.log(\"Retrieving dates.\");\n\n            if (!and) {\n                sqlString = sqlString.concat(\" WHERE \");\n            }\n\n            var paymentTimestampDateFilled = false;\n            var paymentTimestampTimeFilled = false;\n        \n            var paymentTimestampDateTimeFilled = false;\n    \n\n            var paymentTimestampTimeStr = \"00:00:00\";\n            var paymentEndTimestampTimeStr = \"23:59:59\";\n        \n\n            var paymentTimestampDateTimeStr;\n            var paymentEndTimestampDateTimeStr;\n    \n\n\n            if (scope.data.paymentTimestampDate !== null && scope.data.paymentTimestampDate !== undefined && scope.data.paymentTimestampDate !== '') {\n                paymentTimestampDateFilled = true;\n            }\n            if (scope.data.paymentTimestampTime !== null && scope.data.paymentTimestampTime !== undefined && scope.data.paymentTimestampTime !== '') {\n                paymentTimestampTimeFilled = true;\n            }\n        \n\n        \n            if (paymentTimestampDateFilled && paymentTimestampTimeFilled) {\n                paymentTimestampDateTimeStr = scope.data.paymentTimestampDate + \" \" + scope.data.paymentTimestampTime;\n            } else if(paymentTimestampDateFilled && !paymentTimestampTimeFilled) {\n                paymentTimestampDateTimeStr = scope.data.paymentTimestampDate + \" \" + paymentTimestampTimeStr;\n            } else if (!paymentTimestampDateFilled && paymentTimestampTimeFilled) {\n                paymentTimestampDateTimeStr =  scope.getActualDate() + \" \" + scope.data.paymentTimestampTime;\n            }\n    \n\n            if (paymentTimestampDateTimeStr !== null && paymentTimestampDateTimeStr !== undefined && paymentTimestampDateTimeStr !== '') {\n                paymentTimestampDateTimeFilled = true;\n                if(paymentTimestampDateFilled){\n                    paymentEndTimestampDateTimeStr = scope.data.paymentTimestampDate + \" \" + paymentEndTimestampTimeStr;\n                }else{\n                    paymentEndTimestampDateTimeStr = scope.getActualDate() + \" \" + paymentEndTimestampTimeStr;\n                }\n                \n            }\n\n            if (paymentTimestampDateTimeFilled) {\n                if (and) {\n                    sqlString = sqlString + \" AND \";\n                }\n            \n                sqlString = sqlString + \"paymenttimestamp >= '\" + paymentTimestampDateTimeStr+\"' AND paymenttimestamp <= '\" + paymentEndTimestampDateTimeStr+\"'\";\n            }\n        }\n\n        console.log('Query: ' + sqlString);\n        return sqlString;\n    }\n\n\n    function submit_search_chaps() {\n        var scope = angular.element($(\"#submit-searchChaps-container\")).scope();\n\n        \n        var query = doQuery(scope);\n\n        console.log('Submitting search payment ', query);\n        \n        scope.z.angularBind('query', query, '20180619-073855_945887381');\n        scope.z.runParagraph('20180619-073855_945887381');\n\n    }\n\n    \n</script>"}]},"apps":[],"jobName":"paragraph_1533800452165_206724355","id":"20180619-065848_1677225726","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:22+0000","dateFinished":"2018-11-08T13:03:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3951"},{"text":"%hive(hive)\nselect * from CHAPS.CHAPSPayment ${query}","user":"jjimenez","dateUpdated":"2018-11-08T13:03:22+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false}}},"enabled":true},"settings":{"params":{"query":""},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"chapspayment.paymentid\tchapspayment.paymenttimestamp\tchapspayment.paymenttype\tchapspayment.paymentscheme\tchapspayment.direction\tchapspayment.cdtdbtind\tchapspayment.txstatus\tchapspayment.stsrsninf\tchapspayment.trn\tchapspayment.txid\tchapspayment.endtoendid\tchapspayment.sttlmtmindctn\tchapspayment.intrbksttldt\tchapspayment.intrbksttlamt\tchapspayment.intrbksttlccy\tchapspayment.instdamt\tchapspayment.instdccy\tchapspayment.xchgrate\tchapspayment.lclinstrm\tchapspayment.svclvl\tchapspayment.purp\tchapspayment.chrgbr\tchapspayment.chrgsender_amt\tchapspayment.chrgsender_ccy\tchapspayment.chrgreceiver_amt\tchapspayment.chrgreceiver_ccy\tchapspayment.intrmydagt1_nm\tchapspayment.intrmydagt1_pstladr\tchapspayment.intrmydagt1_acct\tchapspayment.intrmydagt1_clrsysmmbid\tchapspayment.intrmydagt1_bicfi\tchapspayment.dbtragt_nm\tchapspayment.dbtragt_pstladr\tchapspayment.dbtragt_acct\tchapspayment.dbtragt_clrsysmmbid\tchapspayment.dbtragt_bicfi\tchapspayment.dbtrnm\tchapspayment.dbtrpstladr\tchapspayment.dbtracct\tchapspayment.dbtr_bicfi\tchapspayment.cdtragt_nm\tchapspayment.cdtragt_pstladr\tchapspayment.cdtragt_acct\tchapspayment.cdtragt_bicfi\tchapspayment.cdtragt_clrsysmmbid\tchapspayment.cdtrnm\tchapspayment.cdtrpstladr\tchapspayment.cdtracct\tchapspayment.cdtr_bicfi\tchapspayment.rgltryrptg\tchapspayment.instrinf\tchapspayment.rmtinf\nSIJK11210230703\t2018-08-09 10:11:21.027\tMT202\tpacs.009.001.07\tO\tnull\tnull\tnull\tSIJK11210230703\tSIJK11210230703\t1\tnull\t2018-08-09\t1.0\tGBP\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tORUNGB3L\tORUNGB3L\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tLOYDG2L\tLOYDG2L\tLloyds Bank\tnull\t\tnull\tnull\tnull\tnull\nSIJK11210230703\t2018-08-09 10:11:21.027\tMT202\tpacs.009.001.07\tO\tD\tNACK\tH99\tSIJK11210230703\tSIJK11210230703\t1\tnull\t2018-08-09\t1.0\tGBP\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tORUNGB3L\tORUNGB3L\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tLOYDG2L\tLOYDG2L\tLloyds Bank\tnull\t\tnull\tnull\tnull\tnull\nSIJK11210230703\t2018-08-09 10:11:21.027\tMT202\tpacs.009.001.07\tO\tD\tSENT\tnull\tSIJK11210230703\tSIJK11210230703\t1\tnull\t2018-08-09\t1.0\tGBP\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tORUNGB3L\tORUNGB3L\tnull\tnull\tnull\tnull\tnull\tnull\tnull\tLOYDG2L\tLOYDG2L\tLloyds Bank\tnull\t\tnull\tnull\tnull\tnull\n"}]},"apps":[],"jobName":"paragraph_1533800452165_206724355","id":"20180619-073855_945887381","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:22+0000","dateFinished":"2018-11-08T13:06:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3952"},{"title":"Search Sanctions","text":"%angular\n<div  id=\"submit-searchChapsSanction-container\">\n\n    <form name=\"searchChapsSanctionForm\" id=\"post-searchChapsSanction-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- Payment Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"paymentId\">Payment Id: </label>\n                    <input type=\"text\" name=\"paymentId\" class=\"form-control\" id=\"paymentId\" ng-model=\"data.paymentId\">\n                </div>\n\n                <!-- Sanction Request Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"sanctionRequestId\">Sanction Request Id: </label>\n                    <input type=\"text\" name=\"fpid\" class=\"form-control\" id=\"sanctionRequestId\" ng-model=\"data.sanctionRequestId\">\n                </div>\n\n                <!-- Payment System -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"paymentSystem\">Payment System: </label>\n                    <select class=\"form-control\" id=\"paymentSystem\" ng-model=\"data.paymentSystem\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"FPS\">FPS</option>\n                        <option value=\"CHAPS\">Chaps</option>\n                    </select>\n                </div>\n\n                <!--div class=\"col-xs-3 form-group\">\n                    <label for=\"scheme\">Scheme: </label>\n                    <select class=\"form-control\" id=\"scheme\" ng-model=\"data.scheme\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"pacs.008.001.07\">pacs_008_001_07</option>\n                        <option value=\"pacs.009.001.07\">pacs_009_001_07</option>\n                    </select>\n                </div-->\n            </div>\n\n            <div class=\"row\">\n                <!-- Direction -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"direction\">Direction: </label>\n                    <select class=\"form-control\" id=\"direction\" ng-model=\"data.direction\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"I\">Inbound</option>\n                        <option value=\"O\">Outbound</option>\n                    </select>\n                </div>\n\n                <!-- Credit / Debit -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"creditDebit\">Credit / Debit: </label>\n                    <select class=\"form-control\" id=\"creditDebit\" ng-model=\"data.creditDebit\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"D\">Debit</option>\n                        <option value=\"C\">Credit</option>\n                    </select>\n                </div>\n\n                <!-- Settlement Amount -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"settlementAmount\">Settlement Amount: </label>\n                    <input type=\"text\" name=\"settlementAmount\" class=\"form-control\" id=\"settlementAmount\" ng-model=\"data.settlementAmount\">\n                </div>\n\n                <!-- Currency -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"currency\">Currency: </label>\n                    <input type=\"text\" name=\"currency\" class=\"form-control\" id=\"currency\" ng-model=\"data.currency\">\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Counterparty Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"counterpartyName\">Counterparty Name: </label>\n                    <input type=\"text\" name=\"counterpartyName\" class=\"form-control\" id=\"counterpartyName\" ng-model=\"data.counterpartyName\">\n                </div>\n\n                <!-- Counterparty Sort Code -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"counterpartySortcode\">Counterparty Sort Code: </label>\n                    <input type=\"text\" name=\"counterpartySortcode\" class=\"form-control\" id=\"counterpartySortcode\" ng-model=\"data.counterpartySortcode\">\n                </div>\n\n                <!-- Counterparty Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"counterpartyAccount\">Counterparty Account: </label>\n                    <input type=\"text\" name=\"counterpartyAccount\" class=\"form-control\" id=\"counterpartyAccount\" ng-model=\"data.counterpartyAccount\">\n                </div>\n\n                <!-- Counterparty Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"counterpartyAddress\">Counterparty Address: </label>\n                    <input type=\"text\" name=\"counterpartyAddress\" class=\"form-control\" id=\"counterpartyAddress\" ng-model=\"data.counterpartyAddress\">\n                </div>\n\n            </div>\n\n            <div class=\"row\">\n                <!-- Customer Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"customerName\">Customer Name: </label>\n                    <input type=\"text\" name=\"customerName\" class=\"form-control\" id=\"customerName\" ng-model=\"data.customerName\">\n                </div>\n\n                <!-- Customer Sortcode -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"customerSortcode\">Customer Sort Code: </label>\n                    <input type=\"text\" name=\"customerSortcode\" class=\"form-control\" id=\"customerSortcode\" ng-model=\"data.customerSortcode\">\n                </div>\n\n                <!-- Customer Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"customerAccount\">Customer Account: </label>\n                    <input type=\"text\" name=\"customerAccount\" class=\"form-control\" id=\"customerAccount\" ng-model=\"data.customerAccount\">\n                </div>\n                \n                 <!-- Status -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"sanctionsts\">Sanction Status: </label>\n                    <select class=\"form-control\" id=\"sanctionsts\" ng-model=\"data.sanctionsts\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"FAIL\">Fail</option>        \n                        <option value=\"PASS\">Pass</option>                        \n                        <option value=\"RECEIVED\">Received</option>\n                        <option value=\"SEARCH_COMPLETED\">Search Completed</option>\n                    </select>\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Start Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"startDate\">Start Date: </label>\n                    <input type=\"text\" name=\"startDate\" class=\"form-control\" id=\"startDate\" ng-model=\"data.startDate\" placeholder=\"yyyy-mm-dd\">\n                </div>\n\n                <!-- Start Time -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"startTime\">Start Time: </label>\n                    <input type=\"text\" name=\"startTime\" class=\"form-control\" id=\"startTime\" ng-model=\"data.startTime\" placeholder=\"hh:mm:ss\">\n                </div>\n\n                <!-- End Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"endDate\">End Date: </label>\n                    <input type=\"text\" name=\"endDate\" class=\"form-control\" id=\"endDate\" ng-model=\"data.endDate\" placeholder=\"yyyy-mm-dd\">\n                </div>\n\n                <!-- End Time -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"endTime\">End Time: </label>\n                    <input type=\"text\" name=\"endTime\" class=\"form-control\" id=\"endTime\" ng-model=\"data.endTime\" placeholder=\"hh:mm:ss\">\n                </div>\n            </div>\n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_search_sanction()\" ng-disabled=\"disableSubmitButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.searchChapsSanction-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.searchChapsSanction-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-searchChapsSanction-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init search chaps sanction');\n        init_searchChapsSanction();\n    });\n\n    function init_searchChapsSanction() {\n        var scope = angular.element($(\"#submit-searchChapsSanction-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Search Sanction'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function(scope) {\n                console.log('Initializing input values');\n                scope.data.paymentSystem = \"0\";\n                scope.data.direction = \"0\";\n                scope.data.creditDebit = \"0\";\n                scope.data.scheme = \"0\";\n                scope.data.sanctionsts = \"0\";\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                var scope = angular.element($(\"#submit-searchChapsSanction-container\")).scope();\n                scope.data = {};\n                scope.generateInputValues(scope);\n            };\n\n            function getObjStr(field, value, exactMatch){\n                var result = '{\"field\":';\n                result = result.concat('\"').concat(field).concat('\", \"value\":\"').concat(value).concat('\", \"exactMatch\":').concat(exactMatch).concat('}');\n                return result;\n            }\n\n            scope.getActualDate = function() {\n                var today = new Date();\n                var dd = today.getDate();\n                var mm = today.getMonth()+1; //January is 0!\n                var yyyy = today.getFullYear();\n\n                if(dd<10) {\n                    dd = '0'+dd\n                } \n\n                if(mm<10) {\n                    mm = '0'+mm\n                } \n\n                today = yyyy + '-' + mm + '-' + dd;\n                console.log('Actual date generated: ' + today);\n                return today;\n            };\n\n            scope.validateDate = function(dateStr) {\n                 if(!/^\\d{4}\\-\\d{2}\\-\\d{2}$/.test(dateStr))\n                    return false;\n\n                var params = dateStr.split('-');\n\n                var year = parseInt(params[0]);\n                var month = parseInt(params[1]);\n                var day = parseInt(params[2]);\n\n                if (year < 2000 || year > 2050 || month < 1 || month > 12 || day < 0 || day > 31)\n                    return false;\n\n                var monthLength = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];\n\n                if(year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))\n                    monthLength[1] = 29;\n\n                if (day > monthLength[month -1])\n                    return false;\n\n                return true;\n            };\n\n            scope.validateTime = function(timeStr) {\n                if(!/^\\d{2}:\\d{2}:\\d{2}$/.test(timeStr))\n                    return false;\n\n                var params = timeStr.split(':');\n\n                var hour = parseInt(params[0]);\n                var minute = parseInt(params[1]);\n                var second = parseInt(params[2]);\n\n                if (hour < 0 || hour > 23 || minute < 0 || minute > 59 || second < 0 || second > 59)\n                    return false;\n\n                return true;\n            };\n\n            scope.disableSubmitButton = function() {\n                var scope = angular.element($(\"#submit-searchChapsSanction-container\")).scope();\n                var result = false;\n\n                if (scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') {\n                    if (!scope.validateDate(scope.data.startDate)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') {\n                    if (!scope.validateDate(scope.data.endDate)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') {\n                    if (!scope.validateTime(scope.data.startTime)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '') {\n                    if (!scope.validateTime(scope.data.endTime)) {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n\n        }\n    }\n\n    function checkAnyFieldFilled(scope) {\n        var result = [];\n\n        try {\n\n            if (scope.data.paymentSystem != null && scope.data.paymentSystem != undefined && scope.data.paymentSystem != \"0\")\n                result.push(getObjStr(\"paymentsystem\", scope.data.paymentSystem.toString(), true));\n\n            if (scope.data.direction != null && scope.data.direction != undefined && scope.data.direction != \"0\")\n                result.push(getObjStr(\"direction\", scope.data.direction.toString(), true));\n\n            if (scope.data.creditDebit != null && scope.data.creditDebit != undefined && scope.data.creditDebit != \"0\")\n                result.push(getObjStr(\"cdtdbtind\", scope.data.creditDebit.toString(), true));\n\n            if (scope.data.scheme != null && scope.data.scheme != undefined && scope.data.scheme != \"0\")\n                result.push(getObjStr(\"paymentscheme\", scope.data.scheme.toString(), true));\n            \n            if (scope.data.sanctionsts != null && scope.data.sanctionsts != undefined && scope.data.sanctionsts != \"0\")\n                result.push(getObjStr(\"sanctionsts\", scope.data.sanctionsts.toString(), true));\n\n            if (scope.data.paymentId != null && scope.data.paymentId != undefined && scope.data.paymentId != '')\n                result.push(getObjStr(\"paymentId\", scope.data.paymentId.toString(), false));\n\n            if (scope.data.sanctionRequestId != null && scope.data.sanctionRequestId != undefined && scope.data.sanctionRequestId != '')\n                result.push(getObjStr(\"sanctionsrequestid\", scope.data.sanctionRequestId.toString(), false));\n\n            if (scope.data.settlementAmount != null && scope.data.settlementAmount != undefined && scope.data.settlementAmount != '')\n                result.push(getObjStr(\"intrbksttlamt\", scope.data.settlementAmount.toString(), false));\n\n            if (scope.data.currency != null && scope.data.currency != undefined && scope.data.currency != '')\n                result.push(getObjStr(\"intrbksttlccy\", scope.data.currency.toString(), false));\n\n            if (scope.data.counterpartyName != null && scope.data.counterpartyName != undefined && scope.data.counterpartyName != '')\n                result.push(getObjStr(\"counterpartynm\", scope.data.counterpartyName.toString(), false));\n\n            if (scope.data.counterpartySortcode != null && scope.data.counterpartySortcode != undefined && scope.data.counterpartySortcode != '')\n                result.push(getObjStr(\"counterpartyagt\", scope.data.counterpartySortcode.toString(), false));\n\n            if (scope.data.counterpartyAccount != null && scope.data.counterpartyAccount != undefined && scope.data.counterpartyAccount != '')\n                result.push(getObjStr(\"counterpartyacct\", scope.data.counterpartyAccount.toString(), false));\n\n            if (scope.data.counterpartyAddress != null && scope.data.counterpartyAddress != undefined && scope.data.counterpartyAddress != '')\n                result.push(getObjStr(\"counterpartyadr\", scope.data.counterpartyAddress.toString(), false));\n\n            if (scope.data.customerName != null && scope.data.customerName != undefined && scope.data.customerName != '')\n                result.push(getObjStr(\"customernm\", scope.data.customerName.toString(), false));\n\n            if (scope.data.customerSortcode != null && scope.data.customerSortcode != undefined && scope.data.customerSortcode != '')\n                result.push(getObjStr(\"customeragt\", scope.data.customerSortcode.toString(), false));\n\n            if (scope.data.customerAccount != null && scope.data.customerAccount != undefined && scope.data.customerAccount != '')\n                result.push(getObjStr(\"customeracct\", scope.data.customerAccount.toString(), false));\n\n        } catch (err) {\n            console.error('Error parsing fields. Error message: ' + err);\n        }\n\n        console.log('Result: ' + result);\n\n        var results = JSON.parse(\"[\" + result + \"]\");\n\n        console.log('Result JSON: ' + JSON.stringify(result));\n\n        return results;\n    }\n\n    function doQuery(scope) {\n        var sqlString = '';\n\n        var fields = checkAnyFieldFilled(scope);\n\n        console.log('fields: ' + fields);\n\n        if (fields.length > 0) {\n            var and = false;\n            sqlString = \"WHERE \";\n\n            for (i = 0; i < fields.length; i++) { \n                var obj = fields[i];\n                if (and)\n                    sqlString = sqlString.concat(\" AND \");\n\n\n                sqlString = sqlString.concat(obj.field);\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\" LIKE '%\");\n                else\n                    sqlString = sqlString.concat(\" = '\");\n\n                sqlString = sqlString.concat(obj.value);\n\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\"%\");\n\n                sqlString = sqlString.concat(\"'\");\n\n                and = true;\n            }\n        }\n\n        var queryDateTimes = addDateTimes(scope, and);\n        sqlString = sqlString.concat(queryDateTimes);\n\n        console.log(\"Query: \" + sqlString);\n        return sqlString;\n    }\n\n\n    function addDateTimes(scope, and) {\n        console.log('Generating Query')\n        var sqlString = \"\";\n\n        if ((scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') ||\n            (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') ||\n            (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') ||\n            (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '')) {\n            console.log(\"Retrieving dates.\");\n\n            if (!and) {\n                sqlString = sqlString.concat(\" WHERE \");\n            }\n\n            var startDateFilled = false;\n            var startTimeFilled = false;\n            var endDateFilled = false;\n            var endTimeFilled = false;\n\n            var startDateTimeFilled = false;\n            var endDateTimeFilled = false;\n\n            var startTimeStr = \"00:00:00\";\n            var endTimeStr = \"23:59:59\";\n\n            var startDateTimeStr;\n            var endDateTimeStr;\n\n\n            if (scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') {\n                startDateFilled = true;\n            }\n            if (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') {\n                startTimeFilled = true;\n            }\n            if (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') {\n                endDateFilled = true;\n            }\n            if (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '') {\n                endTimeFilled = true;\n            }\n\n            if (startDateFilled || startTimeFilled || endDateFilled || endTimeFilled) {\n                if (startDateFilled && startTimeFilled) {\n                    startDateTimeStr = scope.data.startDate + \" \" + scope.data.startTime;\n                } else if(startDateFilled && !startTimeFilled) {\n                    startDateTimeStr = scope.data.startDate + \" \" + startTimeStr;\n                } else if (!startDateFilled && startTimeFilled) {\n                    startDateTimeStr =  scope.getActualDate() + \" \" + scope.data.startTime;\n                }\n\n                if (endDateFilled && endTimeFilled) {\n                    endDateTimeStr = scope.data.endDate + \" \" + scope.data.endTime;\n                } else if(endDateFilled && !endTimeFilled) {\n                    endDateTimeStr = scope.data.endDate + \" \" + endTimeStr;\n                } else if(!endDateFilled && endTimeFilled) {\n                    endDateTimeStr + scope.getActualDate() + scope.data.endTime;\n                }\n            }\n\n            if (startDateTimeStr != null && startDateTimeStr != undefined && startDateTimeStr != '') {\n                startDateTimeFilled = true;\n            }\n\n            if (endDateTimeStr != null && endDateTimeStr != undefined && endDateTimeStr != '') {\n                endDateTimeFilled = true;\n            }\n\n\n            if (startDateTimeFilled || endDateTimeFilled) {\n                if (and) {\n                    sqlString = sqlString + \" AND \";\n                }\n\n                if (startDateTimeFilled && endDateTimeFilled) {\n                    sqlString = sqlString + \"paymenttimestamp >= '\" + startDateTimeStr + \"' AND paymenttimestamp <= '\" + endDateTimeStr+\"'\";\n                }else if (startDateTimeFilled) {\n                    sqlString = sqlString + \"paymenttimestamp >= '\" + startDateTimeStr+\"'\";                     \n                } else {\n                    sqlString = sqlString + \"paymenttimestamp <= '\" + endDateTimeStr+\"'\";                    \n                }\n            }\n        }\n\n        console.log('Query: ' + sqlString);\n        return sqlString;\n    }\n\n\n    function submit_search_sanction() {\n        var scope = angular.element($(\"#submit-searchChapsSanction-container\")).scope();\n\n        console.log('Submitting search sanction');\n        \n        var query = doQuery(scope);\n\n        scope.z.angularBind('sanctionsQuery', query, '20180619-074807_684250220');\n        scope.z.runParagraph('20180619-074807_684250220');\n    }\n\n    \n</script>\n","user":"jjimenez","dateUpdated":"2018-11-08T13:03:22+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":7,"editorMode":"ace/mode/undefined","editorHide":true,"title":true,"results":{"0":{"graph":{"mode":"table","height":464.5,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"ANGULAR","data":"<div  id=\"submit-searchChapsSanction-container\">\n\n    <form name=\"searchChapsSanctionForm\" id=\"post-searchChapsSanction-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- Payment Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"paymentId\">Payment Id: </label>\n                    <input type=\"text\" name=\"paymentId\" class=\"form-control\" id=\"paymentId\" ng-model=\"data.paymentId\">\n                </div>\n\n                <!-- Sanction Request Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"sanctionRequestId\">Sanction Request Id: </label>\n                    <input type=\"text\" name=\"fpid\" class=\"form-control\" id=\"sanctionRequestId\" ng-model=\"data.sanctionRequestId\">\n                </div>\n\n                <!-- Payment System -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"paymentSystem\">Payment System: </label>\n                    <select class=\"form-control\" id=\"paymentSystem\" ng-model=\"data.paymentSystem\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"FPS\">FPS</option>\n                        <option value=\"CHAPS\">Chaps</option>\n                    </select>\n                </div>\n\n                <!--div class=\"col-xs-3 form-group\">\n                    <label for=\"scheme\">Scheme: </label>\n                    <select class=\"form-control\" id=\"scheme\" ng-model=\"data.scheme\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"pacs.008.001.07\">pacs_008_001_07</option>\n                        <option value=\"pacs.009.001.07\">pacs_009_001_07</option>\n                    </select>\n                </div-->\n            </div>\n\n            <div class=\"row\">\n                <!-- Direction -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"direction\">Direction: </label>\n                    <select class=\"form-control\" id=\"direction\" ng-model=\"data.direction\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"I\">Inbound</option>\n                        <option value=\"O\">Outbound</option>\n                    </select>\n                </div>\n\n                <!-- Credit / Debit -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"creditDebit\">Credit / Debit: </label>\n                    <select class=\"form-control\" id=\"creditDebit\" ng-model=\"data.creditDebit\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"D\">Debit</option>\n                        <option value=\"C\">Credit</option>\n                    </select>\n                </div>\n\n                <!-- Settlement Amount -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"settlementAmount\">Settlement Amount: </label>\n                    <input type=\"text\" name=\"settlementAmount\" class=\"form-control\" id=\"settlementAmount\" ng-model=\"data.settlementAmount\">\n                </div>\n\n                <!-- Currency -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"currency\">Currency: </label>\n                    <input type=\"text\" name=\"currency\" class=\"form-control\" id=\"currency\" ng-model=\"data.currency\">\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Counterparty Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"counterpartyName\">Counterparty Name: </label>\n                    <input type=\"text\" name=\"counterpartyName\" class=\"form-control\" id=\"counterpartyName\" ng-model=\"data.counterpartyName\">\n                </div>\n\n                <!-- Counterparty Sort Code -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"counterpartySortcode\">Counterparty Sort Code: </label>\n                    <input type=\"text\" name=\"counterpartySortcode\" class=\"form-control\" id=\"counterpartySortcode\" ng-model=\"data.counterpartySortcode\">\n                </div>\n\n                <!-- Counterparty Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"counterpartyAccount\">Counterparty Account: </label>\n                    <input type=\"text\" name=\"counterpartyAccount\" class=\"form-control\" id=\"counterpartyAccount\" ng-model=\"data.counterpartyAccount\">\n                </div>\n\n                <!-- Counterparty Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"counterpartyAddress\">Counterparty Address: </label>\n                    <input type=\"text\" name=\"counterpartyAddress\" class=\"form-control\" id=\"counterpartyAddress\" ng-model=\"data.counterpartyAddress\">\n                </div>\n\n            </div>\n\n            <div class=\"row\">\n                <!-- Customer Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"customerName\">Customer Name: </label>\n                    <input type=\"text\" name=\"customerName\" class=\"form-control\" id=\"customerName\" ng-model=\"data.customerName\">\n                </div>\n\n                <!-- Customer Sortcode -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"customerSortcode\">Customer Sort Code: </label>\n                    <input type=\"text\" name=\"customerSortcode\" class=\"form-control\" id=\"customerSortcode\" ng-model=\"data.customerSortcode\">\n                </div>\n\n                <!-- Customer Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"customerAccount\">Customer Account: </label>\n                    <input type=\"text\" name=\"customerAccount\" class=\"form-control\" id=\"customerAccount\" ng-model=\"data.customerAccount\">\n                </div>\n                \n                 <!-- Status -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"sanctionsts\">Sanction Status: </label>\n                    <select class=\"form-control\" id=\"sanctionsts\" ng-model=\"data.sanctionsts\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"FAIL\">Fail</option>        \n                        <option value=\"PASS\">Pass</option>                        \n                        <option value=\"RECEIVED\">Received</option>\n                        <option value=\"SEARCH_COMPLETED\">Search Completed</option>\n                    </select>\n                </div>\n            </div>\n\n\n            <div class=\"row\">\n                <!-- Start Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"startDate\">Start Date: </label>\n                    <input type=\"text\" name=\"startDate\" class=\"form-control\" id=\"startDate\" ng-model=\"data.startDate\" placeholder=\"yyyy-mm-dd\">\n                </div>\n\n                <!-- Start Time -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"startTime\">Start Time: </label>\n                    <input type=\"text\" name=\"startTime\" class=\"form-control\" id=\"startTime\" ng-model=\"data.startTime\" placeholder=\"hh:mm:ss\">\n                </div>\n\n                <!-- End Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"endDate\">End Date: </label>\n                    <input type=\"text\" name=\"endDate\" class=\"form-control\" id=\"endDate\" ng-model=\"data.endDate\" placeholder=\"yyyy-mm-dd\">\n                </div>\n\n                <!-- End Time -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"endTime\">End Time: </label>\n                    <input type=\"text\" name=\"endTime\" class=\"form-control\" id=\"endTime\" ng-model=\"data.endTime\" placeholder=\"hh:mm:ss\">\n                </div>\n            </div>\n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_search_sanction()\" ng-disabled=\"disableSubmitButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.searchChapsSanction-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.searchChapsSanction-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-searchChapsSanction-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init search chaps sanction');\n        init_searchChapsSanction();\n    });\n\n    function init_searchChapsSanction() {\n        var scope = angular.element($(\"#submit-searchChapsSanction-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Search Sanction'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function(scope) {\n                console.log('Initializing input values');\n                scope.data.paymentSystem = \"0\";\n                scope.data.direction = \"0\";\n                scope.data.creditDebit = \"0\";\n                scope.data.scheme = \"0\";\n                scope.data.sanctionsts = \"0\";\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                var scope = angular.element($(\"#submit-searchChapsSanction-container\")).scope();\n                scope.data = {};\n                scope.generateInputValues(scope);\n            };\n\n            function getObjStr(field, value, exactMatch){\n                var result = '{\"field\":';\n                result = result.concat('\"').concat(field).concat('\", \"value\":\"').concat(value).concat('\", \"exactMatch\":').concat(exactMatch).concat('}');\n                return result;\n            }\n\n            scope.getActualDate = function() {\n                var today = new Date();\n                var dd = today.getDate();\n                var mm = today.getMonth()+1; //January is 0!\n                var yyyy = today.getFullYear();\n\n                if(dd<10) {\n                    dd = '0'+dd\n                } \n\n                if(mm<10) {\n                    mm = '0'+mm\n                } \n\n                today = yyyy + '-' + mm + '-' + dd;\n                console.log('Actual date generated: ' + today);\n                return today;\n            };\n\n            scope.validateDate = function(dateStr) {\n                 if(!/^\\d{4}\\-\\d{2}\\-\\d{2}$/.test(dateStr))\n                    return false;\n\n                var params = dateStr.split('-');\n\n                var year = parseInt(params[0]);\n                var month = parseInt(params[1]);\n                var day = parseInt(params[2]);\n\n                if (year < 2000 || year > 2050 || month < 1 || month > 12 || day < 0 || day > 31)\n                    return false;\n\n                var monthLength = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];\n\n                if(year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))\n                    monthLength[1] = 29;\n\n                if (day > monthLength[month -1])\n                    return false;\n\n                return true;\n            };\n\n            scope.validateTime = function(timeStr) {\n                if(!/^\\d{2}:\\d{2}:\\d{2}$/.test(timeStr))\n                    return false;\n\n                var params = timeStr.split(':');\n\n                var hour = parseInt(params[0]);\n                var minute = parseInt(params[1]);\n                var second = parseInt(params[2]);\n\n                if (hour < 0 || hour > 23 || minute < 0 || minute > 59 || second < 0 || second > 59)\n                    return false;\n\n                return true;\n            };\n\n            scope.disableSubmitButton = function() {\n                var scope = angular.element($(\"#submit-searchChapsSanction-container\")).scope();\n                var result = false;\n\n                if (scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') {\n                    if (!scope.validateDate(scope.data.startDate)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') {\n                    if (!scope.validateDate(scope.data.endDate)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') {\n                    if (!scope.validateTime(scope.data.startTime)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '') {\n                    if (!scope.validateTime(scope.data.endTime)) {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n\n        }\n    }\n\n    function checkAnyFieldFilled(scope) {\n        var result = [];\n\n        try {\n\n            if (scope.data.paymentSystem != null && scope.data.paymentSystem != undefined && scope.data.paymentSystem != \"0\")\n                result.push(getObjStr(\"paymentsystem\", scope.data.paymentSystem.toString(), true));\n\n            if (scope.data.direction != null && scope.data.direction != undefined && scope.data.direction != \"0\")\n                result.push(getObjStr(\"direction\", scope.data.direction.toString(), true));\n\n            if (scope.data.creditDebit != null && scope.data.creditDebit != undefined && scope.data.creditDebit != \"0\")\n                result.push(getObjStr(\"cdtdbtind\", scope.data.creditDebit.toString(), true));\n\n            if (scope.data.scheme != null && scope.data.scheme != undefined && scope.data.scheme != \"0\")\n                result.push(getObjStr(\"paymentscheme\", scope.data.scheme.toString(), true));\n            \n            if (scope.data.sanctionsts != null && scope.data.sanctionsts != undefined && scope.data.sanctionsts != \"0\")\n                result.push(getObjStr(\"sanctionsts\", scope.data.sanctionsts.toString(), true));\n\n            if (scope.data.paymentId != null && scope.data.paymentId != undefined && scope.data.paymentId != '')\n                result.push(getObjStr(\"paymentId\", scope.data.paymentId.toString(), false));\n\n            if (scope.data.sanctionRequestId != null && scope.data.sanctionRequestId != undefined && scope.data.sanctionRequestId != '')\n                result.push(getObjStr(\"sanctionsrequestid\", scope.data.sanctionRequestId.toString(), false));\n\n            if (scope.data.settlementAmount != null && scope.data.settlementAmount != undefined && scope.data.settlementAmount != '')\n                result.push(getObjStr(\"intrbksttlamt\", scope.data.settlementAmount.toString(), false));\n\n            if (scope.data.currency != null && scope.data.currency != undefined && scope.data.currency != '')\n                result.push(getObjStr(\"intrbksttlccy\", scope.data.currency.toString(), false));\n\n            if (scope.data.counterpartyName != null && scope.data.counterpartyName != undefined && scope.data.counterpartyName != '')\n                result.push(getObjStr(\"counterpartynm\", scope.data.counterpartyName.toString(), false));\n\n            if (scope.data.counterpartySortcode != null && scope.data.counterpartySortcode != undefined && scope.data.counterpartySortcode != '')\n                result.push(getObjStr(\"counterpartyagt\", scope.data.counterpartySortcode.toString(), false));\n\n            if (scope.data.counterpartyAccount != null && scope.data.counterpartyAccount != undefined && scope.data.counterpartyAccount != '')\n                result.push(getObjStr(\"counterpartyacct\", scope.data.counterpartyAccount.toString(), false));\n\n            if (scope.data.counterpartyAddress != null && scope.data.counterpartyAddress != undefined && scope.data.counterpartyAddress != '')\n                result.push(getObjStr(\"counterpartyadr\", scope.data.counterpartyAddress.toString(), false));\n\n            if (scope.data.customerName != null && scope.data.customerName != undefined && scope.data.customerName != '')\n                result.push(getObjStr(\"customernm\", scope.data.customerName.toString(), false));\n\n            if (scope.data.customerSortcode != null && scope.data.customerSortcode != undefined && scope.data.customerSortcode != '')\n                result.push(getObjStr(\"customeragt\", scope.data.customerSortcode.toString(), false));\n\n            if (scope.data.customerAccount != null && scope.data.customerAccount != undefined && scope.data.customerAccount != '')\n                result.push(getObjStr(\"customeracct\", scope.data.customerAccount.toString(), false));\n\n        } catch (err) {\n            console.error('Error parsing fields. Error message: ' + err);\n        }\n\n        console.log('Result: ' + result);\n\n        var results = JSON.parse(\"[\" + result + \"]\");\n\n        console.log('Result JSON: ' + JSON.stringify(result));\n\n        return results;\n    }\n\n    function doQuery(scope) {\n        var sqlString = '';\n\n        var fields = checkAnyFieldFilled(scope);\n\n        console.log('fields: ' + fields);\n\n        if (fields.length > 0) {\n            var and = false;\n            sqlString = \"WHERE \";\n\n            for (i = 0; i < fields.length; i++) { \n                var obj = fields[i];\n                if (and)\n                    sqlString = sqlString.concat(\" AND \");\n\n\n                sqlString = sqlString.concat(obj.field);\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\" LIKE '%\");\n                else\n                    sqlString = sqlString.concat(\" = '\");\n\n                sqlString = sqlString.concat(obj.value);\n\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\"%\");\n\n                sqlString = sqlString.concat(\"'\");\n\n                and = true;\n            }\n        }\n\n        var queryDateTimes = addDateTimes(scope, and);\n        sqlString = sqlString.concat(queryDateTimes);\n\n        console.log(\"Query: \" + sqlString);\n        return sqlString;\n    }\n\n\n    function addDateTimes(scope, and) {\n        console.log('Generating Query')\n        var sqlString = \"\";\n\n        if ((scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') ||\n            (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') ||\n            (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') ||\n            (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '')) {\n            console.log(\"Retrieving dates.\");\n\n            if (!and) {\n                sqlString = sqlString.concat(\" WHERE \");\n            }\n\n            var startDateFilled = false;\n            var startTimeFilled = false;\n            var endDateFilled = false;\n            var endTimeFilled = false;\n\n            var startDateTimeFilled = false;\n            var endDateTimeFilled = false;\n\n            var startTimeStr = \"00:00:00\";\n            var endTimeStr = \"23:59:59\";\n\n            var startDateTimeStr;\n            var endDateTimeStr;\n\n\n            if (scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') {\n                startDateFilled = true;\n            }\n            if (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') {\n                startTimeFilled = true;\n            }\n            if (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') {\n                endDateFilled = true;\n            }\n            if (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '') {\n                endTimeFilled = true;\n            }\n\n            if (startDateFilled || startTimeFilled || endDateFilled || endTimeFilled) {\n                if (startDateFilled && startTimeFilled) {\n                    startDateTimeStr = scope.data.startDate + \" \" + scope.data.startTime;\n                } else if(startDateFilled && !startTimeFilled) {\n                    startDateTimeStr = scope.data.startDate + \" \" + startTimeStr;\n                } else if (!startDateFilled && startTimeFilled) {\n                    startDateTimeStr =  scope.getActualDate() + \" \" + scope.data.startTime;\n                }\n\n                if (endDateFilled && endTimeFilled) {\n                    endDateTimeStr = scope.data.endDate + \" \" + scope.data.endTime;\n                } else if(endDateFilled && !endTimeFilled) {\n                    endDateTimeStr = scope.data.endDate + \" \" + endTimeStr;\n                } else if(!endDateFilled && endTimeFilled) {\n                    endDateTimeStr + scope.getActualDate() + scope.data.endTime;\n                }\n            }\n\n            if (startDateTimeStr != null && startDateTimeStr != undefined && startDateTimeStr != '') {\n                startDateTimeFilled = true;\n            }\n\n            if (endDateTimeStr != null && endDateTimeStr != undefined && endDateTimeStr != '') {\n                endDateTimeFilled = true;\n            }\n\n\n            if (startDateTimeFilled || endDateTimeFilled) {\n                if (and) {\n                    sqlString = sqlString + \" AND \";\n                }\n\n                if (startDateTimeFilled && endDateTimeFilled) {\n                    sqlString = sqlString + \"paymenttimestamp >= '\" + startDateTimeStr + \"' AND paymenttimestamp <= '\" + endDateTimeStr+\"'\";\n                }else if (startDateTimeFilled) {\n                    sqlString = sqlString + \"paymenttimestamp >= '\" + startDateTimeStr+\"'\";                     \n                } else {\n                    sqlString = sqlString + \"paymenttimestamp <= '\" + endDateTimeStr+\"'\";                    \n                }\n            }\n        }\n\n        console.log('Query: ' + sqlString);\n        return sqlString;\n    }\n\n\n    function submit_search_sanction() {\n        var scope = angular.element($(\"#submit-searchChapsSanction-container\")).scope();\n\n        console.log('Submitting search sanction');\n        \n        var query = doQuery(scope);\n\n        scope.z.angularBind('sanctionsQuery', query, '20180619-074807_684250220');\n        scope.z.runParagraph('20180619-074807_684250220');\n    }\n\n    \n</script>"}]},"apps":[],"jobName":"paragraph_1533800452166_207878601","id":"20180619-094159_742567268","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:22+0000","dateFinished":"2018-11-08T13:03:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3953"},{"title":"Send Sanction Outcome","text":"%angular\n<div  id=\"submit-sendPassFailChapsSanction-container\">\n    <div ng-show=\"show\" ng-class=\"{'sendPassFailChapsSanction-submit-status-container-failed': !result.success, 'sendPassFailChapsSanction-submit-status-container': result.success}\">\n        <div class=\"result-header\">{{result.text}}</div>\n    </div>\n\n\n    <form name=\"sendPassFailChapsSanctionForm\" id=\"post-sendPassFailChapsSanction-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- Sanction Request Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"sanctionRequestId\">Sanction Request Id: </label>\n                    <input type=\"text\" name=\"sanctionRequestId\" class=\"form-control\" id=\"sanctionRequestId\" ng-model=\"data.sanctionRequestId\">\n                </div>\n\n                <!-- Sanction Action -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"sanctionAction\">Sanction Action: </label>\n                    <select class=\"form-control\" id=\"sanctionAction\" ng-model=\"data.sanctionAction\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"PASS\">Pass</option>\n                        <option value=\"FAIL\">Fail</option>\n                    </select>\n                </div>\n            </div>\n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_send_pass_fail_sanction()\" ng-disabled=\"disableSubmitButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.sendPassFailChapsSanction-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.sendPassFailChapsSanction-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-sendPassFailChapsSanction-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init send pass fail chaps sanction');\n        init_sendPassFailChapsSanction();\n    });\n\n    function init_sendPassFailChapsSanction() {\n        var scope = angular.element($(\"#submit-sendPassFailChapsSanction-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Send Sanction'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function(scope) {\n                console.log('Initializing input values');\n                scope.data.sanctionAction = \"0\";\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                var scope = angular.element($(\"#submit-sendPassFailChapsSanction-container\")).scope();\n                scope.data = {};\n                scope.generateInputValues(scope);\n            };\n\n            scope.disableSubmitButton = function() {\n                var scope = angular.element($(\"#submit-sendPassFailChapsSanction-container\")).scope();\n\n                if (scope.data.sanctionRequestId == null || scope.data.sanctionRequestId == undefined || scope.data.sanctionRequestId == '') {\n                    return true;\n                }\n\n                if (scope.data.sanctionAction == null || scope.data.sanctionAction == undefined || scope.data.sanctionAction == '0') {\n                    return true;\n                }\n\n                return false;\n            };\n\n        }\n    }\n\n\n\n    function getData(scope) {\n            var data = JSON.stringify(\n            {\n                'sanctionsRequestId': scope.data.sanctionRequestId,\n                'sanctionAction' : scope.data.sanctionAction\n            });\n\n        return data;\n    }\n\n    function reloadSanctions(){\n        var scope = angular.element($(\"#submit-sendPassFailChapsSanction-container\")).scope();\n        scope.z.runParagraph('20180619-074807_684250220');\n    }\n\n    function do_ajax_query_send_sanction_chaps(scope) {\n        scope.show = false;\n        scope.submit.inprogress = true;\n        var textBefore = scope.submit.text;\n        scope.submit.text = \"Submitting...\";\n\n        var xhr = new XMLHttpRequest();\n        var url = \"http://52.212.192.94:8181/bifrost/sanctions/sendSanction\";\n\n        var data  = getData(scope);\n\n        console.log('Send Sanction payment URL obtained: ' + url);\n        xhr.timeout = 25000; //25 seconds\n        xhr.open(\"POST\", url, true);\n        xhr.setRequestHeader(\"Content-type\", \"application/json\");\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    console.log('Chaps Sanction response: ' + xhr.responseText);\n                    scope.result.text = \"Sanction send successfully\";\n                    scope.result.success = true;\n                    scope.show = true;\n                    scope.$apply(); \n                } else {\n                    scope.result.text = \"Error sending chaps sanction\";\n                    scope.result.success = false;\n                    scope.show = true;\n                    scope.$apply(); \n                }\n            }\n\n            scope.submit.inprogress = false;\n            scope.submit.text = textBefore;\n            reloadSanctions();\n        };\n\n        console.log('sending data: ' + data);\n        xhr.send(data);\n    }\n\n    function submit_send_pass_fail_sanction() {\n        var scope = angular.element($(\"#submit-sendPassFailChapsSanction-container\")).scope();\n        do_ajax_query_send_sanction_chaps(scope);\n    }\n\n    \n</script>\n","user":"jjimenez","dateUpdated":"2018-11-08T13:03:22+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":5,"editorMode":"ace/mode/undefined","editorHide":true,"title":true,"results":{"0":{"graph":{"mode":"table","height":166.5,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"ANGULAR","data":"<div  id=\"submit-sendPassFailChapsSanction-container\">\n    <div ng-show=\"show\" ng-class=\"{'sendPassFailChapsSanction-submit-status-container-failed': !result.success, 'sendPassFailChapsSanction-submit-status-container': result.success}\">\n        <div class=\"result-header\">{{result.text}}</div>\n    </div>\n\n\n    <form name=\"sendPassFailChapsSanctionForm\" id=\"post-sendPassFailChapsSanction-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- Sanction Request Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"sanctionRequestId\">Sanction Request Id: </label>\n                    <input type=\"text\" name=\"sanctionRequestId\" class=\"form-control\" id=\"sanctionRequestId\" ng-model=\"data.sanctionRequestId\">\n                </div>\n\n                <!-- Sanction Action -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"sanctionAction\">Sanction Action: </label>\n                    <select class=\"form-control\" id=\"sanctionAction\" ng-model=\"data.sanctionAction\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"PASS\">Pass</option>\n                        <option value=\"FAIL\">Fail</option>\n                    </select>\n                </div>\n            </div>\n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_send_pass_fail_sanction()\" ng-disabled=\"disableSubmitButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.sendPassFailChapsSanction-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.sendPassFailChapsSanction-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-sendPassFailChapsSanction-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init send pass fail chaps sanction');\n        init_sendPassFailChapsSanction();\n    });\n\n    function init_sendPassFailChapsSanction() {\n        var scope = angular.element($(\"#submit-sendPassFailChapsSanction-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Send Sanction'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function(scope) {\n                console.log('Initializing input values');\n                scope.data.sanctionAction = \"0\";\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                var scope = angular.element($(\"#submit-sendPassFailChapsSanction-container\")).scope();\n                scope.data = {};\n                scope.generateInputValues(scope);\n            };\n\n            scope.disableSubmitButton = function() {\n                var scope = angular.element($(\"#submit-sendPassFailChapsSanction-container\")).scope();\n\n                if (scope.data.sanctionRequestId == null || scope.data.sanctionRequestId == undefined || scope.data.sanctionRequestId == '') {\n                    return true;\n                }\n\n                if (scope.data.sanctionAction == null || scope.data.sanctionAction == undefined || scope.data.sanctionAction == '0') {\n                    return true;\n                }\n\n                return false;\n            };\n\n        }\n    }\n\n\n\n    function getData(scope) {\n            var data = JSON.stringify(\n            {\n                'sanctionsRequestId': scope.data.sanctionRequestId,\n                'sanctionAction' : scope.data.sanctionAction\n            });\n\n        return data;\n    }\n\n    function reloadSanctions(){\n        var scope = angular.element($(\"#submit-sendPassFailChapsSanction-container\")).scope();\n        scope.z.runParagraph('20180619-074807_684250220');\n    }\n\n    function do_ajax_query_send_sanction_chaps(scope) {\n        scope.show = false;\n        scope.submit.inprogress = true;\n        var textBefore = scope.submit.text;\n        scope.submit.text = \"Submitting...\";\n\n        var xhr = new XMLHttpRequest();\n        var url = \"http://52.212.192.94:8181/bifrost/sanctions/sendSanction\";\n\n        var data  = getData(scope);\n\n        console.log('Send Sanction payment URL obtained: ' + url);\n        xhr.timeout = 25000; //25 seconds\n        xhr.open(\"POST\", url, true);\n        xhr.setRequestHeader(\"Content-type\", \"application/json\");\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    console.log('Chaps Sanction response: ' + xhr.responseText);\n                    scope.result.text = \"Sanction send successfully\";\n                    scope.result.success = true;\n                    scope.show = true;\n                    scope.$apply(); \n                } else {\n                    scope.result.text = \"Error sending chaps sanction\";\n                    scope.result.success = false;\n                    scope.show = true;\n                    scope.$apply(); \n                }\n            }\n\n            scope.submit.inprogress = false;\n            scope.submit.text = textBefore;\n            reloadSanctions();\n        };\n\n        console.log('sending data: ' + data);\n        xhr.send(data);\n    }\n\n    function submit_send_pass_fail_sanction() {\n        var scope = angular.element($(\"#submit-sendPassFailChapsSanction-container\")).scope();\n        do_ajax_query_send_sanction_chaps(scope);\n    }\n\n    \n</script>"}]},"apps":[],"jobName":"paragraph_1533800452166_207878601","id":"20180703-135750_1321878248","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:22+0000","dateFinished":"2018-11-08T13:03:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3954"},{"text":"%hive(hive)\nselect paymentId, \nsanctionsRequestId,\nsanctionsts,\npaymentsystem,\npaymenttimestamp,\npaymentscheme,\ndirection,\ncdtdbtind,\nintrbksttldt,\nintrbksttlamt,\nintrbksttlccy,\ncounterpartyacct,\ncounterpartyagt,\ncounterpartynm,\ncounterpartyadr,\ncustomernm,\ncustomeracct,\ncustomeragt,\ncustomeracctid,\nsanctionsmatchlist,\npaymentmessage from fasterpayments.FpsSanctions ${sanctionsQuery}","user":"jjimenez","dateUpdated":"2018-11-08T13:06:55+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":true,"results":{"0":{"graph":{"mode":"table","height":425.15,"optionOpen":false}}},"enabled":true},"settings":{"params":{"sanctionsQuery":""},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"paymentid\tsanctionsrequestid\tsanctionsts\tpaymentsystem\tpaymenttimestamp\tpaymentscheme\tdirection\tcdtdbtind\tintrbksttldt\tintrbksttlamt\tintrbksttlccy\tcounterpartyacct\tcounterpartyagt\tcounterpartynm\tcounterpartyadr\tcustomernm\tcustomeracct\tcustomeragt\tcustomeracctid\tsanctionsmatchlist\tpaymentmessage\nSIJK11210230703\t6799662774110420992ft6I4L9\tSEARCH_COMPLETED\tCHAPS\t2018-08-09 10:11:21.241\tMT202\tO\tC\t2018-08-09 00:00:00.0\t1.0\tGBP\tnull\tORUNGB3L\tnull\tnull\tnull\t\tLOYDG2L\tnull\t{}\t{\"FICdtTrf\":{\"GrpHdr\":{\"MsgId\":\"SIJK11210230703-1533809481028\",\"CreDtTm\":1533809481028,\"NbOfTxs\":\"1\",\"SttlmInf\":{\"SttlmMtd\":\"CLRG\"}},\"CdtTrfTxInf\":[{\"PmtId\":{\"EndToEndId\":\"1\",\"TxId\":\"SIJK11210230703\"},\"IntrBkSttlmAmt\":{\"value\":{\"value\":1.00},\"Ccy\":\"GBP\"},\"IntrBkSttlmDt\":\"2018-08-09\",\"DbtrAgt\":{\"FinInstnId\":{\"BICFI\":\"ORUNGB3L\"}},\"DbtrAgtAcct\":{\"Id\":{\"Othr\":{}}},\"CdtrAgt\":{\"FinInstnId\":{\"BICFI\":\"LOYDG2L\",\"ClrSysMmbId\":{}}},\"Cdtr\":{\"FinInstnId\":{\"Nm\":\"Lloyds Bank\",\"PstlAdr\":{\"AdrLine\":[\"\"]}}},\"CdtrAcct\":{\"Id\":{\"Othr\":{\"Id\":\"\"}}},\"InstrForCdtrAgt\":[],\"InstrForNxtAgt\":[{\"InstrInf\":\"TEST PAYMENT\"}],\"SplmtryData\":[]}],\"SplmtryData\":[]}}\nSIJK11210230703\t6799662774110420992ft6I4L9\tPASS\tCHAPS\t2018-08-09 10:11:21.241\tMT202\tO\tC\t2018-08-09 00:00:00.0\t1.0\tGBP\tnull\tORUNGB3L\tnull\tnull\tnull\t\tLOYDG2L\tnull\t{}\t{\"FICdtTrf\":{\"GrpHdr\":{\"MsgId\":\"SIJK11210230703-1533809481028\",\"CreDtTm\":1533809481028,\"NbOfTxs\":\"1\",\"SttlmInf\":{\"SttlmMtd\":\"CLRG\"}},\"CdtTrfTxInf\":[{\"PmtId\":{\"EndToEndId\":\"1\",\"TxId\":\"SIJK11210230703\"},\"IntrBkSttlmAmt\":{\"value\":{\"value\":1.00},\"Ccy\":\"GBP\"},\"IntrBkSttlmDt\":\"2018-08-09\",\"DbtrAgt\":{\"FinInstnId\":{\"BICFI\":\"ORUNGB3L\"}},\"DbtrAgtAcct\":{\"Id\":{\"Othr\":{}}},\"CdtrAgt\":{\"FinInstnId\":{\"BICFI\":\"LOYDG2L\",\"ClrSysMmbId\":{}}},\"Cdtr\":{\"FinInstnId\":{\"Nm\":\"Lloyds Bank\",\"PstlAdr\":{\"AdrLine\":[\"\"]}}},\"CdtrAcct\":{\"Id\":{\"Othr\":{\"Id\":\"\"}}},\"InstrForCdtrAgt\":[],\"InstrForNxtAgt\":[{\"InstrInf\":\"TEST PAYMENT\"}],\"SplmtryData\":[]}],\"SplmtryData\":[]}}\nSIJK11210230703\t6799662774110420992ft6I4L9\tRECEIVED\tCHAPS\t2018-08-09 10:11:21.241\tMT202\tO\tC\t2018-08-09 00:00:00.0\t1.0\tGBP\tnull\tORUNGB3L\tnull\tnull\tnull\t\tLOYDG2L\tnull\tnull\t{\"FICdtTrf\":{\"GrpHdr\":{\"MsgId\":\"SIJK11210230703-1533809481028\",\"CreDtTm\":1533809481028,\"NbOfTxs\":\"1\",\"SttlmInf\":{\"SttlmMtd\":\"CLRG\"}},\"CdtTrfTxInf\":[{\"PmtId\":{\"EndToEndId\":\"1\",\"TxId\":\"SIJK11210230703\"},\"IntrBkSttlmAmt\":{\"value\":{\"value\":1.00},\"Ccy\":\"GBP\"},\"IntrBkSttlmDt\":\"2018-08-09\",\"DbtrAgt\":{\"FinInstnId\":{\"BICFI\":\"ORUNGB3L\"}},\"DbtrAgtAcct\":{\"Id\":{\"Othr\":{}}},\"CdtrAgt\":{\"FinInstnId\":{\"BICFI\":\"LOYDG2L\",\"ClrSysMmbId\":{}}},\"Cdtr\":{\"FinInstnId\":{\"Nm\":\"Lloyds Bank\",\"PstlAdr\":{\"AdrLine\":[\"\"]}}},\"CdtrAcct\":{\"Id\":{\"Othr\":{\"Id\":\"\"}}},\"InstrForCdtrAgt\":[],\"InstrForNxtAgt\":[{\"InstrInf\":\"TEST PAYMENT\"}],\"SplmtryData\":[]}],\"SplmtryData\":[]}}\n"}]},"apps":[],"jobName":"paragraph_1533800452166_207878601","id":"20180619-074807_684250220","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:22+0000","dateFinished":"2018-11-08T13:03:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3955"},{"title":"Search Chaps Row Messages","text":"%angular\n<div  id=\"submit-searchChapsRowMessages-container\">\n\n    <form name=\"searchChapsRowMessagesForm\" id=\"post-searchChapsRowMessages-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- RowKey -->\n                <div class=\"col-xs-4 form-group\" >\n                    <label for=\"rowKey\">Payment Id: </label>\n                    <input type=\"text\" name=\"rowKey\" class=\"form-control\" id=\"rowKey\" ng-model=\"data.rowKey\">\n                </div>\n            \n            </div>\n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_search_row_message()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.searchChapsRowMessages-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.searchChapsRowMessages-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-searchChapsRowMessages-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init search chaps row message');\n        init_searchChapsRowMessages();\n    });\n\n    function init_searchChapsRowMessages() {\n        var scope = angular.element($(\"#submit-searchChapsRowMessages-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Search Row Message'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function(scope) {\n                console.log('Initializing input values');\n                scope.data.direction = \"0\";\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                var scope = angular.element($(\"#submit-searchChapsRowMessages-container\")).scope();\n                scope.data = {};\n                scope.generateInputValues(scope);\n            };\n        }\n    }\n\n    function getObjStr(field, value, exactMatch){\n        var result = '{\"field\":';\n        result = result.concat('\"').concat(field).concat('\", \"value\":\"').concat(value).concat('\", \"exactMatch\":').concat(exactMatch).concat('}');\n        return result;\n    }\n\n    function checkAnyFieldFilled(scope) {\n        var result = [];\n\n        try {\nconsole.log(\"Scope \", scope.data.rowKey);\n            if (scope.data.rowKey != null && scope.data.rowKey != undefined && scope.data.rowKey != '')\n                result.push(getObjStr(\"rowkey\", scope.data.rowKey.toString(), false));\n\n        } catch (err) {\n            console.error('Error parsing fields. Error message: ' + err);\n        }\n\n        console.log('Result: ' + result);\n\n        var results = JSON.parse(\"[\" + result + \"]\");\n\n        console.log('Result JSON: ' + JSON.stringify(result));\n\n        return results;\n    }\n\n    function doQuery(scope) {\n        var sqlString = '';\n\n        var fields = checkAnyFieldFilled(scope);\n\n        console.log('fields: ' + fields);\n\n        if (fields.length > 0) {\n            var and = false;\n            sqlString = \"WHERE \";\n\n            for (i = 0; i < fields.length; i++) { \n                var obj = fields[i];\n                if (and)\n                    sqlString = sqlString.concat(\" AND \");\n\n\n                sqlString = sqlString.concat('UPPER(');\n                sqlString = sqlString.concat(obj.field);\n                sqlString = sqlString.concat(')');\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\" LIKE UPPER('%\");\n                else\n                    sqlString = sqlString.concat(\" = UPPER('\");\n\n                sqlString = sqlString.concat(obj.value);\n\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\"%\");\n\n                sqlString = sqlString.concat(\"')\");\n\n                and = true;\n            }\n        }\n\n        console.log(\"Query: \" + sqlString);\n        return sqlString;\n    }\n\n\n    function submit_search_row_message() {\n        var scope = angular.element($(\"#submit-searchChapsRowMessages-container\")).scope();\n\n        console.log('Submitting search row message');\n        \n        var query = doQuery(scope);\n\n        scope.z.angularBind('queryRawMessages', query, '20180621-094321_1787962433');\n        scope.z.runParagraph('20180621-094321_1787962433');\n    }\n\n    \n</script>\n","user":"jjimenez","dateUpdated":"2018-11-08T13:03:22+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":3,"editorMode":"ace/mode/undefined","editorHide":true,"title":true,"results":{"0":{"graph":{"mode":"table","height":181,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"ANGULAR","data":"<div  id=\"submit-searchChapsRowMessages-container\">\n\n    <form name=\"searchChapsRowMessagesForm\" id=\"post-searchChapsRowMessages-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- RowKey -->\n                <div class=\"col-xs-4 form-group\" >\n                    <label for=\"rowKey\">Payment Id: </label>\n                    <input type=\"text\" name=\"rowKey\" class=\"form-control\" id=\"rowKey\" ng-model=\"data.rowKey\">\n                </div>\n            \n            </div>\n\n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_search_row_message()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.searchChapsRowMessages-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.searchChapsRowMessages-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-searchChapsRowMessages-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init search chaps row message');\n        init_searchChapsRowMessages();\n    });\n\n    function init_searchChapsRowMessages() {\n        var scope = angular.element($(\"#submit-searchChapsRowMessages-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Search Row Message'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function(scope) {\n                console.log('Initializing input values');\n                scope.data.direction = \"0\";\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                var scope = angular.element($(\"#submit-searchChapsRowMessages-container\")).scope();\n                scope.data = {};\n                scope.generateInputValues(scope);\n            };\n        }\n    }\n\n    function getObjStr(field, value, exactMatch){\n        var result = '{\"field\":';\n        result = result.concat('\"').concat(field).concat('\", \"value\":\"').concat(value).concat('\", \"exactMatch\":').concat(exactMatch).concat('}');\n        return result;\n    }\n\n    function checkAnyFieldFilled(scope) {\n        var result = [];\n\n        try {\nconsole.log(\"Scope \", scope.data.rowKey);\n            if (scope.data.rowKey != null && scope.data.rowKey != undefined && scope.data.rowKey != '')\n                result.push(getObjStr(\"rowkey\", scope.data.rowKey.toString(), false));\n\n        } catch (err) {\n            console.error('Error parsing fields. Error message: ' + err);\n        }\n\n        console.log('Result: ' + result);\n\n        var results = JSON.parse(\"[\" + result + \"]\");\n\n        console.log('Result JSON: ' + JSON.stringify(result));\n\n        return results;\n    }\n\n    function doQuery(scope) {\n        var sqlString = '';\n\n        var fields = checkAnyFieldFilled(scope);\n\n        console.log('fields: ' + fields);\n\n        if (fields.length > 0) {\n            var and = false;\n            sqlString = \"WHERE \";\n\n            for (i = 0; i < fields.length; i++) { \n                var obj = fields[i];\n                if (and)\n                    sqlString = sqlString.concat(\" AND \");\n\n\n                sqlString = sqlString.concat('UPPER(');\n                sqlString = sqlString.concat(obj.field);\n                sqlString = sqlString.concat(')');\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\" LIKE UPPER('%\");\n                else\n                    sqlString = sqlString.concat(\" = UPPER('\");\n\n                sqlString = sqlString.concat(obj.value);\n\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\"%\");\n\n                sqlString = sqlString.concat(\"')\");\n\n                and = true;\n            }\n        }\n\n        console.log(\"Query: \" + sqlString);\n        return sqlString;\n    }\n\n\n    function submit_search_row_message() {\n        var scope = angular.element($(\"#submit-searchChapsRowMessages-container\")).scope();\n\n        console.log('Submitting search row message');\n        \n        var query = doQuery(scope);\n\n        scope.z.angularBind('queryRawMessages', query, '20180621-094321_1787962433');\n        scope.z.runParagraph('20180621-094321_1787962433');\n    }\n\n    \n</script>"}]},"apps":[],"jobName":"paragraph_1533800452167_207493853","id":"20180622-070844_578136909","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:22+0000","dateFinished":"2018-11-08T13:03:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3956"},{"text":"%jdbc(phoenix)\nselect * from \"CHAPS_MESSAGES\" ${queryRawMessages}","user":"jjimenez","dateUpdated":"2018-11-08T13:03:22+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":9,"editorMode":"ace/mode/sql","editorHide":false,"title":false,"results":{"0":{"graph":{"mode":"table","height":204,"optionOpen":false},"helium":{}}},"enabled":true},"settings":{"params":{"Message Id":"123","file-name":"","direction":"","queryRawMessages":""},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"ROWKEY\tdirection\tmessage\ttimestamp\nSIJK11210230703\toutput\t{1:F01ORUNGB3LXXXX0000000000}{2:I202LOYDG2LXXXXXN3020}{3:{103:STG}{108:SIJK11210230703}}{4:\r :20:SIJK11210230703\r :21:1\r :32A:180809GBP1,\r :52A:ORUNGB3L\r :58A:LOYDG2L\r :72:TEST PAYMENT\r -}\t1533809482744\n"}]},"apps":[],"jobName":"paragraph_1533800452167_207493853","id":"20180621-094321_1787962433","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:22+0000","dateFinished":"2018-11-08T13:03:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3957"},{"title":"Search Chaps Exceptions","text":"%angular\n<div  id=\"submit-searchChapsException-container\">\n\n    <form name=\"searchChapsExceptionForm\" id=\"post-searchChapsException-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- Payment Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"paymentId\">Payment Id: </label>\n                    <input type=\"text\" name=\"paymentId\" class=\"form-control\" id=\"paymentId\" ng-model=\"data.paymentId\">\n                </div>\n\n                <!-- Payment Type -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"paymentType\">Payment Type: </label>\n                    <select class=\"form-control\" id=\"paymentType\" ng-model=\"data.paymentType\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"MT103\">MT103</option>\n                        <option value=\"MT202\">MT202</option>\n                        <option value=\"MT202COV\">MT202 COV</option>\n                        <option value=\"MT202RETN\">MT202 Return</option>\n                    </select>\n                </div>\n\n                <!-- Scheme -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"scheme\">Scheme: </label>\n                    <select class=\"form-control\" id=\"scheme\" ng-model=\"data.scheme\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"pacs.008.001.07\">pacs_008_001_07</option>\n                        <option value=\"pacs.009.001.07\">pacs_009_001_07</option>\n                    </select>\n                </div>\n\n                <!-- Direction -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"direction\">Direction: </label>\n                    <select class=\"form-control\" id=\"direction\" ng-model=\"data.direction\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"I\">Inbound</option>\n                        <option value=\"O\">Outbound</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Credit / Debit -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"creditDebit\">Credit / Debit: </label>\n                    <select class=\"form-control\" id=\"creditDebit\" ng-model=\"data.creditDebit\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"D\">Debit</option>\n                        <option value=\"C\">Credit</option>\n                    </select>\n                </div>\n\n\n                <!-- Transaction Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"transactionId\">Transaction Id: </label>\n                    <input type=\"text\" name=\"transactionId\" class=\"form-control\" id=\"transactionId\" ng-model=\"data.transactionId\">\n                </div>\n            \n                <!-- Settlement Amount -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"settlementAmount\">Settlement Amount: </label>\n                    <input type=\"text\" name=\"settlementAmount\" class=\"form-control\" id=\"settlementAmount\" ng-model=\"data.settlementAmount\">\n                </div>\n\n                <!-- Currency -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"currency\">Currency: </label>\n                    <input type=\"text\" name=\"currency\" class=\"form-control\" id=\"currency\" ng-model=\"data.currency\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Debtor Agent Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAgentName\">Debtor Agent Name: </label>\n                    <input type=\"text\" name=\"debtorAgentName\" class=\"form-control\" id=\"debtorAgentName\" ng-model=\"data.debtorAgentName\">\n                </div>\n\n                <!-- Debtor Agent Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAgentAccount\">Debtor Agent Account: </label>\n                    <input type=\"text\" name=\"debtorAgentAccount\" class=\"form-control\" id=\"debtorAgentAccount\" ng-model=\"data.debtorAgentAccount\">\n                </div>\n\n                <!-- Debtor Agent BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAgentBICFI\">Debtor Agent BICFI: </label>\n                    <input type=\"text\" name=\"debtorAgentBICFI\" class=\"form-control\" id=\"debtorAgentBICFI\" ng-model=\"data.debtorAgentBICFI\">\n                </div>\n\n                <!-- Debtor Agent Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAgentAddress\">Debtor Agent Postal Address: </label>\n                    <input type=\"text\" name=\"debtorAgentAddress\" class=\"form-control\" id=\"debtorAgentAddress\" ng-model=\"data.debtorAgentAddress\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Debtor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorName\">Debtor Name: </label>\n                    <input type=\"text\" name=\"debtorName\" class=\"form-control\" id=\"debtorName\" ng-model=\"data.debtorName\">\n                </div>\n\n                <!-- Debtor Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAccount\">Debtor Account: </label>\n                    <input type=\"text\" name=\"debtorAccount\" class=\"form-control\" id=\"debtorAccount\" ng-model=\"data.debtorAccount\">\n                </div>\n\n                <!-- Debtor BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorBICFI\">Debtor BICFI: </label>\n                    <input type=\"text\" name=\"debtorBICFI\" class=\"form-control\" id=\"debtorBICFI\" ng-model=\"data.debtorBICFI\">\n                </div>\n\n                <!-- Debtor Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAddress\">Debtor Postal Address: </label>\n                    <input type=\"text\" name=\"debtorAddress\" class=\"form-control\" id=\"debtorAddress\" ng-model=\"data.debtorAddress\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Creditor Agent Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAgentName\">Creditor Agent Name: </label>\n                    <input type=\"text\" name=\"creditorAgentName\" class=\"form-control\" id=\"creditorAgentName\" ng-model=\"data.creditorAgentName\">\n                </div>\n\n                <!-- Creditor Agent Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAgentAccount\">Creditor Agent Account: </label>\n                    <input type=\"text\" name=\"creditorAgentAccount\" class=\"form-control\" id=\"creditorAgentAccount\" ng-model=\"data.creditorAgentAccount\">\n                </div>\n\n                <!-- Creditor Agent BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAgentBICFI\">Creditor Agent BICFI: </label>\n                    <input type=\"text\" name=\"creditorAgentBICFI\" class=\"form-control\" id=\"creditorAgentBICFI\" ng-model=\"data.creditorAgentBICFI\">\n                </div>\n\n                <!-- Creditor Agent Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAgentAddress\">Creditor Agent Postal Address: </label>\n                    <input type=\"text\" name=\"creditorAgentAddress\" class=\"form-control\" id=\"creditorAgentAddress\" ng-model=\"data.creditorAgentAddress\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Creditor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorName\">Creditor Name: </label>\n                    <input type=\"text\" name=\"creditorName\" class=\"form-control\" id=\"creditorName\" ng-model=\"data.creditorName\">\n                </div>\n\n                <!-- Creditor Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAccount\">Creditor Account: </label>\n                    <input type=\"text\" name=\"creditorAccount\" class=\"form-control\" id=\"creditorAccount\" ng-model=\"data.creditorAccount\">\n                </div>\n\n                <!-- Creditor BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorBICFI\">Creditor BICFI: </label>\n                    <input type=\"text\" name=\"creditorBICFI\" class=\"form-control\" id=\"creditorBICFI\" ng-model=\"data.creditorBICFI\">\n                </div>\n\n                <!-- Creditor Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAddress\">Creditor Postal Address: </label>\n                    <input type=\"text\" name=\"creditorAddress\" class=\"form-control\" id=\"creditorAddress\" ng-model=\"data.creditorAddress\">\n                </div>\n            </div>\n             <div class=\"row\">\n                <!-- Start Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"startDate\">Start Date: </label>\n                    <input type=\"text\" name=\"startDate\" class=\"form-control\" id=\"startDate\" ng-model=\"data.startDate\" placeholder=\"yyyy-mm-dd\">\n                </div>\n\n                <!-- Start Time -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"startTime\">Start Time: </label>\n                    <input type=\"text\" name=\"startTime\" class=\"form-control\" id=\"startTime\" ng-model=\"data.startTime\" placeholder=\"hh:mm:ss\">\n                </div>\n\n                <!-- End Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"endDate\">End Date: </label>\n                    <input type=\"text\" name=\"endDate\" class=\"form-control\" id=\"endDate\" ng-model=\"data.endDate\" placeholder=\"yyyy-mm-dd\">\n                </div>\n\n                <!-- End Time -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"endTime\">End Time: </label>\n                    <input type=\"text\" name=\"endTime\" class=\"form-control\" id=\"endTime\" ng-model=\"data.endTime\" placeholder=\"hh:mm:ss\">\n                </div>\n            </div>\n\n        \n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_search_exception()\" ng-disabled=\"disableSubmitButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.searchChapsException-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.searchChapsException-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-searchChapsException-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init search chaps sanction');\n        init_searchChapsException();\n    });\n\n    function init_searchChapsException() {\n        var scope = angular.element($(\"#submit-searchChapsException-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Search Exception'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function(scope) {\n                console.log('Initializing input values');\n                scope.data.paymentType = \"0\";\n                scope.data.scheme = \"0\";\n                scope.data.direction = \"0\";\n                scope.data.creditDebit = \"0\";\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                var scope = angular.element($(\"#submit-searchChapsException-container\")).scope();\n                scope.data = {};\n                scope.generateInputValues(scope);\n            };\n\n            scope.getActualDate = function() {\n                var today = new Date();\n                var dd = today.getDate();\n                var mm = today.getMonth()+1; //January is 0!\n                var yyyy = today.getFullYear();\n\n                if(dd<10) {\n                    dd = '0'+dd\n                } \n\n                if(mm<10) {\n                    mm = '0'+mm\n                } \n\n                today = yyyy + '-' + mm + '-' + dd;\n                console.log('Actual date generated: ' + today);\n                return today;\n            };\n\n            scope.validateDate = function(dateStr) {\n                 if(!/^\\d{4}\\-\\d{2}\\-\\d{2}$/.test(dateStr))\n                    return false;\n\n                var params = dateStr.split('-');\n\n                var year = parseInt(params[0]);\n                var month = parseInt(params[1]);\n                var day = parseInt(params[2]);\n\n                if (year < 2000 || year > 2050 || month < 1 || month > 12 || day < 0 || day > 31)\n                    return false;\n\n                var monthLength = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];\n\n                if(year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))\n                    monthLength[1] = 29;\n\n                if (day > monthLength[month -1])\n                    return false;\n\n                return true;\n            };\n\n            scope.validateTime = function(timeStr) {\n                if(!/^\\d{2}:\\d{2}:\\d{2}$/.test(timeStr))\n                    return false;\n\n                var params = timeStr.split(':');\n\n                var hour = parseInt(params[0]);\n                var minute = parseInt(params[1]);\n                var second = parseInt(params[2]);\n\n                if (hour < 0 || hour > 23 || minute < 0 || minute > 59 || second < 0 || second > 59)\n                    return false;\n\n                return true;\n            };\n\n             scope.disableSubmitButton = function() {\n                var scope = angular.element($(\"#submit-searchChapsException-container\")).scope();\n                var result = false;\n\n                if (scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') {\n                    if (!scope.validateDate(scope.data.startDate)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') {\n                    if (!scope.validateDate(scope.data.endDate)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') {\n                    if (!scope.validateTime(scope.data.startTime)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '') {\n                    if (!scope.validateTime(scope.data.endTime)) {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n        }\n    }\n\n    function getObjStr(field, value, exactMatch){\n        var result = '{\"field\":';\n        result = result.concat('\"').concat(field).concat('\", \"value\":\"').concat(value).concat('\", \"exactMatch\":').concat(exactMatch).concat('}');\n        return result;\n    }\n\n    function checkAnyFieldFilled(scope) {\n        var result = [];\n\n        try {\n\n            if (scope.data.paymentType != null && scope.data.paymentType != undefined && scope.data.paymentType != \"0\")\n                result.push(getObjStr(\"paymenttype\", scope.data.paymentType.toString(), true));\n\n            if (scope.data.scheme != null && scope.data.scheme != undefined && scope.data.scheme != \"0\")\n                result.push(getObjStr(\"paymentscheme\", scope.data.scheme.toString(), true));\n\n            if (scope.data.direction != null && scope.data.direction != undefined && scope.data.direction != \"0\")\n                result.push(getObjStr(\"direction\", scope.data.direction.toString(), true));\n\n            if (scope.data.creditDebit != null && scope.data.creditDebit != undefined && scope.data.creditDebit != \"0\")\n                result.push(getObjStr(\"cdtdbtind\", scope.data.creditDebit.toString(), true));\n\n            if (scope.data.paymentId != null && scope.data.paymentId != undefined && scope.data.paymentId != '')\n                result.push(getObjStr(\"paymentId\", scope.data.paymentId.toString(), false));\n\n            if (scope.data.transactionId != null && scope.data.transactionId != undefined && scope.data.transactionId != '')\n                result.push(getObjStr(\"txid\", scope.data.transactionId.toString(), false));\n\n            if (scope.data.settlementAmount != null && scope.data.settlementAmount != undefined && scope.data.settlementAmount != '')\n                result.push(getObjStr(\"intrbksttlamt\", scope.data.settlementAmount.toString(), false));\n\n            if (scope.data.currency != null && scope.data.currency != undefined && scope.data.currency != '')\n                result.push(getObjStr(\"intrbksttlccy\", scope.data.currency.toString(), false));\n\n            if (scope.data.debtorAgentName != null && scope.data.debtorAgentName != undefined && scope.data.debtorAgentName != '')\n                result.push(getObjStr(\"dbtragt_nm\", scope.data.debtorAgentName.toString(), false));\n\n            if (scope.data.debtorAgentAccount != null && scope.data.debtorAgentAccount != undefined && scope.data.debtorAgentAccount != '')\n                result.push(getObjStr(\"dbtragt_acct\", scope.data.debtorAgentAccount.toString(), false));\n\n            if (scope.data.debtorAgentBICFI != null && scope.data.debtorAgentBICFI != undefined && scope.data.debtorAgentBICFI != '')\n                result.push(getObjStr(\"dbtragt_bicfi\", scope.data.debtorAgentBICFI.toString(), false));\n\n            if (scope.data.debtorAgentAddress != null && scope.data.debtorAgentAddress != undefined && scope.data.debtorAgentAddress != '')\n                result.push(getObjStr(\"dbtragt_pstladr\", scope.data.debtorAgentAddress.toString(), false));\n\n            if (scope.data.debtorName != null && scope.data.debtorName != undefined && scope.data.debtorName != '')\n                result.push(getObjStr(\"dbtrnm\", scope.data.debtorName.toString(), false));\n\n            if (scope.data.debtorAccount != null && scope.data.debtorAccount != undefined && scope.data.debtorAccount != '')\n                result.push(getObjStr(\"dbtracct\", scope.data.debtorAccount.toString(), false));\n\n            if (scope.data.debtorBICFI != null && scope.data.debtorBICFI != undefined && scope.data.debtorBICFI != '')\n                result.push(getObjStr(\"dbtr_bicfi\", scope.data.debtorBICFI.toString(), false));\n\n            if (scope.data.debtorAddress != null && scope.data.debtorAddress != undefined && scope.data.debtorAddress != '')\n                result.push(getObjStr(\"dbtrpstladr\", scope.data.debtorAddress.toString(), false));\n\n            if (scope.data.creditorAgentName != null && scope.data.creditorAgentName != undefined && scope.data.creditorAgentName != '')\n                result.push(getObjStr(\"cdtragt_nm\", scope.data.creditorAgentName.toString(), false));\n\n            if (scope.data.creditorAgentAccount != null && scope.data.creditorAgentAccount != undefined && scope.data.creditorAgentAccount != '')\n                result.push(getObjStr(\"cdtrAgt_acct\", scope.data.creditorAgentAccount.toString(), false));\n\n            if (scope.data.creditorAgentBICFI != null && scope.data.creditorAgentBICFI != undefined && scope.data.creditorAgentBICFI != '')\n                result.push(getObjStr(\"cdtrAgt_bicfi\", scope.data.creditorAgentBICFI.toString(), false));\n\n            if (scope.data.creditorAgentAddress != null && scope.data.creditorAgentAddress != undefined && scope.data.creditorAgentAddress != '')\n                result.push(getObjStr(\"cdtrAgt_pstladr\", scope.data.creditorAgentAddress.toString(), false));\n\n            if (scope.data.creditorName != null && scope.data.creditorName != undefined && scope.data.creditorName != '')\n                result.push(getObjStr(\"cdtrnm\", scope.data.creditorName.toString(), false));\n\n            if (scope.data.creditorAccount != null && scope.data.creditorAccount != undefined && scope.data.creditorAccount != '')\n                result.push(getObjStr(\"cdtracct\", scope.data.creditorAccount.toString(), false));\n\n            if (scope.data.creditorBICFI != null && scope.data.creditorBICFI != undefined && scope.data.creditorBICFI != '')\n                result.push(getObjStr(\"cdtr_bicfi\", scope.data.creditorBICFI.toString(), false));\n\n            if (scope.data.creditorAddress != null && scope.data.creditorAddress != undefined && scope.data.creditorAddress != '')\n                result.push(getObjStr(\"cdtrpstladr\", scope.data.creditorAddress.toString(), false));\n\n\n        } catch (err) {\n            console.error('Error parsing fields. Error message: ' + err);\n        }\n\n        console.log('Result: ' + result);\n\n        var results = JSON.parse(\"[\" + result + \"]\");\n\n        console.log('Result JSON: ' + JSON.stringify(result));\n\n        return results;\n    }\n\n    function doQuery(scope) {\n        var sqlString = '';\n\n        var fields = checkAnyFieldFilled(scope);\n\n        console.log('fields: ' + fields);\n\n        if (fields.length > 0) {\n            var and = false;\n            sqlString = \"WHERE \";\n\n            for (i = 0; i < fields.length; i++) { \n                var obj = fields[i];\n                if (and)\n                    sqlString = sqlString.concat(\" AND \");\n\n\n                sqlString = sqlString.concat('UPPER(');\n                sqlString = sqlString.concat(obj.field);\n                sqlString = sqlString.concat(')');\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\" LIKE UPPER('%\");\n                else\n                    sqlString = sqlString.concat(\" = UPPER('\");\n\n                sqlString = sqlString.concat(obj.value);\n\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\"%\");\n\n                sqlString = sqlString.concat(\"')\");\n\n                and = true;\n            }\n        }\n\n        var queryDateTimes = addDateTimes(scope, and);\n        sqlString = sqlString.concat(queryDateTimes);\n\n        console.log(\"Query: \" + sqlString);\n        return sqlString;\n    }\n\n    function addDateTimes(scope, and) {\n        console.log('Generating Query')\n        var sqlString = \"\";\n\n        if ((scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') ||\n            (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') ||\n            (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') ||\n            (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '')) {\n            console.log(\"Retrieving dates.\");\n\n            if (!and) {\n                sqlString = sqlString.concat(\" WHERE \");\n            }\n\n            var startDateFilled = false;\n            var startTimeFilled = false;\n            var endDateFilled = false;\n            var endTimeFilled = false;\n\n            var startDateTimeFilled = false;\n            var endDateTimeFilled = false;\n\n            var startTimeStr = \"00:00:00\";\n            var endTimeStr = \"23:59:59\";\n\n            var startDateTimeStr;\n            var endDateTimeStr;\n\n\n            if (scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') {\n                startDateFilled = true;\n            }\n            if (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') {\n                startTimeFilled = true;\n            }\n            if (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') {\n                endDateFilled = true;\n            }\n            if (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '') {\n                endTimeFilled = true;\n            }\n\n            if (startDateFilled || startTimeFilled || endDateFilled || endTimeFilled) {\n                if (startDateFilled && startTimeFilled) {\n                    startDateTimeStr = scope.data.startDate + \" \" + scope.data.startTime;\n                } else if(startDateFilled && !startTimeFilled) {\n                    startDateTimeStr = scope.data.startDate + \" \" + startTimeStr;\n                } else if (!startDateFilled && startTimeFilled) {\n                    startDateTimeStr =  scope.getActualDate() + \" \" + scope.data.startTime;\n                }\n\n                if (endDateFilled && endTimeFilled) {\n                    endDateTimeStr = scope.data.endDate + \" \" + scope.data.endTime;\n                } else if(endDateFilled && !endTimeFilled) {\n                    endDateTimeStr = scope.data.endDate + \" \" + endTimeStr;\n                } else if(!endDateFilled && endTimeFilled) {\n                    endDateTimeStr + scope.getActualDate() + scope.data.endTime;\n                }\n            }\n\n            if (startDateTimeStr != null && startDateTimeStr != undefined && startDateTimeStr != '') {\n                startDateTimeFilled = true;\n            }\n\n            if (endDateTimeStr != null && endDateTimeStr != undefined && endDateTimeStr != '') {\n                endDateTimeFilled = true;\n            }\n\n\n            if (startDateTimeFilled || endDateTimeFilled) {\n                if (and) {\n                    sqlString = sqlString + \" AND \";\n                }\n\n                if (startDateTimeFilled && endDateTimeFilled) {\n                    sqlString = sqlString + \"paymenttimestamp >= '\" + startDateTimeStr + \"' AND paymenttimestamp <= '\" + endDateTimeStr+\"'\";\n                }else if (startDateTimeFilled) {\n                    sqlString = sqlString + \"paymenttimestamp >= '\" + startDateTimeStr+\"'\";                     \n                } else {\n                    sqlString = sqlString + \"paymenttimestamp <= '\" + endDateTimeStr+\"'\";                    \n                }\n            }\n        }\n\n        console.log('Query: ' + sqlString);\n        return sqlString;\n    }\n\n\n    function submit_search_exception() {\n        var scope = angular.element($(\"#submit-searchChapsException-container\")).scope();\n\n        console.log('Submitting search exception');\n        \n        var query = doQuery(scope);\n\n        scope.z.angularBind('exceptionsQuery', query, '20180620-140301_810238412');\n        scope.z.runParagraph('20180620-140301_810238412');\n    }\n\n    \n</script>","user":"jjimenez","dateUpdated":"2018-11-08T13:03:22+0000","config":{"tableHide":false,"editorSetting":{"language":"scala","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/undefined","editorHide":true,"title":true,"results":{"0":{"graph":{"mode":"table","height":684,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"ANGULAR","data":"<div  id=\"submit-searchChapsException-container\">\n\n    <form name=\"searchChapsExceptionForm\" id=\"post-searchChapsException-form\">\n        <div class= \"form-group\">\n            <div class=\"row\">\n                <!-- Payment Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"paymentId\">Payment Id: </label>\n                    <input type=\"text\" name=\"paymentId\" class=\"form-control\" id=\"paymentId\" ng-model=\"data.paymentId\">\n                </div>\n\n                <!-- Payment Type -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"paymentType\">Payment Type: </label>\n                    <select class=\"form-control\" id=\"paymentType\" ng-model=\"data.paymentType\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"MT103\">MT103</option>\n                        <option value=\"MT202\">MT202</option>\n                        <option value=\"MT202COV\">MT202 COV</option>\n                        <option value=\"MT202RETN\">MT202 Return</option>\n                    </select>\n                </div>\n\n                <!-- Scheme -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"scheme\">Scheme: </label>\n                    <select class=\"form-control\" id=\"scheme\" ng-model=\"data.scheme\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"pacs.008.001.07\">pacs_008_001_07</option>\n                        <option value=\"pacs.009.001.07\">pacs_009_001_07</option>\n                    </select>\n                </div>\n\n                <!-- Direction -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"direction\">Direction: </label>\n                    <select class=\"form-control\" id=\"direction\" ng-model=\"data.direction\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"I\">Inbound</option>\n                        <option value=\"O\">Outbound</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Credit / Debit -->\n                <div class=\"col-xs-3 form-group\">\n                    <label for=\"creditDebit\">Credit / Debit: </label>\n                    <select class=\"form-control\" id=\"creditDebit\" ng-model=\"data.creditDebit\">\n                        <option value=\"0\">-- Select an option --</option>\n                        <option value=\"D\">Debit</option>\n                        <option value=\"C\">Credit</option>\n                    </select>\n                </div>\n\n\n                <!-- Transaction Id -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"transactionId\">Transaction Id: </label>\n                    <input type=\"text\" name=\"transactionId\" class=\"form-control\" id=\"transactionId\" ng-model=\"data.transactionId\">\n                </div>\n            \n                <!-- Settlement Amount -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"settlementAmount\">Settlement Amount: </label>\n                    <input type=\"text\" name=\"settlementAmount\" class=\"form-control\" id=\"settlementAmount\" ng-model=\"data.settlementAmount\">\n                </div>\n\n                <!-- Currency -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"currency\">Currency: </label>\n                    <input type=\"text\" name=\"currency\" class=\"form-control\" id=\"currency\" ng-model=\"data.currency\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Debtor Agent Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAgentName\">Debtor Agent Name: </label>\n                    <input type=\"text\" name=\"debtorAgentName\" class=\"form-control\" id=\"debtorAgentName\" ng-model=\"data.debtorAgentName\">\n                </div>\n\n                <!-- Debtor Agent Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAgentAccount\">Debtor Agent Account: </label>\n                    <input type=\"text\" name=\"debtorAgentAccount\" class=\"form-control\" id=\"debtorAgentAccount\" ng-model=\"data.debtorAgentAccount\">\n                </div>\n\n                <!-- Debtor Agent BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAgentBICFI\">Debtor Agent BICFI: </label>\n                    <input type=\"text\" name=\"debtorAgentBICFI\" class=\"form-control\" id=\"debtorAgentBICFI\" ng-model=\"data.debtorAgentBICFI\">\n                </div>\n\n                <!-- Debtor Agent Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAgentAddress\">Debtor Agent Postal Address: </label>\n                    <input type=\"text\" name=\"debtorAgentAddress\" class=\"form-control\" id=\"debtorAgentAddress\" ng-model=\"data.debtorAgentAddress\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Debtor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorName\">Debtor Name: </label>\n                    <input type=\"text\" name=\"debtorName\" class=\"form-control\" id=\"debtorName\" ng-model=\"data.debtorName\">\n                </div>\n\n                <!-- Debtor Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAccount\">Debtor Account: </label>\n                    <input type=\"text\" name=\"debtorAccount\" class=\"form-control\" id=\"debtorAccount\" ng-model=\"data.debtorAccount\">\n                </div>\n\n                <!-- Debtor BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorBICFI\">Debtor BICFI: </label>\n                    <input type=\"text\" name=\"debtorBICFI\" class=\"form-control\" id=\"debtorBICFI\" ng-model=\"data.debtorBICFI\">\n                </div>\n\n                <!-- Debtor Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"debtorAddress\">Debtor Postal Address: </label>\n                    <input type=\"text\" name=\"debtorAddress\" class=\"form-control\" id=\"debtorAddress\" ng-model=\"data.debtorAddress\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Creditor Agent Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAgentName\">Creditor Agent Name: </label>\n                    <input type=\"text\" name=\"creditorAgentName\" class=\"form-control\" id=\"creditorAgentName\" ng-model=\"data.creditorAgentName\">\n                </div>\n\n                <!-- Creditor Agent Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAgentAccount\">Creditor Agent Account: </label>\n                    <input type=\"text\" name=\"creditorAgentAccount\" class=\"form-control\" id=\"creditorAgentAccount\" ng-model=\"data.creditorAgentAccount\">\n                </div>\n\n                <!-- Creditor Agent BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAgentBICFI\">Creditor Agent BICFI: </label>\n                    <input type=\"text\" name=\"creditorAgentBICFI\" class=\"form-control\" id=\"creditorAgentBICFI\" ng-model=\"data.creditorAgentBICFI\">\n                </div>\n\n                <!-- Creditor Agent Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAgentAddress\">Creditor Agent Postal Address: </label>\n                    <input type=\"text\" name=\"creditorAgentAddress\" class=\"form-control\" id=\"creditorAgentAddress\" ng-model=\"data.creditorAgentAddress\">\n                </div>\n            </div>\n\n            <div class=\"row\">\n                <!-- Creditor Name -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorName\">Creditor Name: </label>\n                    <input type=\"text\" name=\"creditorName\" class=\"form-control\" id=\"creditorName\" ng-model=\"data.creditorName\">\n                </div>\n\n                <!-- Creditor Account -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAccount\">Creditor Account: </label>\n                    <input type=\"text\" name=\"creditorAccount\" class=\"form-control\" id=\"creditorAccount\" ng-model=\"data.creditorAccount\">\n                </div>\n\n                <!-- Creditor BICFI -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorBICFI\">Creditor BICFI: </label>\n                    <input type=\"text\" name=\"creditorBICFI\" class=\"form-control\" id=\"creditorBICFI\" ng-model=\"data.creditorBICFI\">\n                </div>\n\n                <!-- Creditor Postal Address -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"creditorAddress\">Creditor Postal Address: </label>\n                    <input type=\"text\" name=\"creditorAddress\" class=\"form-control\" id=\"creditorAddress\" ng-model=\"data.creditorAddress\">\n                </div>\n            </div>\n             <div class=\"row\">\n                <!-- Start Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"startDate\">Start Date: </label>\n                    <input type=\"text\" name=\"startDate\" class=\"form-control\" id=\"startDate\" ng-model=\"data.startDate\" placeholder=\"yyyy-mm-dd\">\n                </div>\n\n                <!-- Start Time -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"startTime\">Start Time: </label>\n                    <input type=\"text\" name=\"startTime\" class=\"form-control\" id=\"startTime\" ng-model=\"data.startTime\" placeholder=\"hh:mm:ss\">\n                </div>\n\n                <!-- End Date -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"endDate\">End Date: </label>\n                    <input type=\"text\" name=\"endDate\" class=\"form-control\" id=\"endDate\" ng-model=\"data.endDate\" placeholder=\"yyyy-mm-dd\">\n                </div>\n\n                <!-- End Time -->\n                <div class=\"col-xs-3 form-group\" >\n                    <label for=\"endTime\">End Time: </label>\n                    <input type=\"text\" name=\"endTime\" class=\"form-control\" id=\"endTime\" ng-model=\"data.endTime\" placeholder=\"hh:mm:ss\">\n                </div>\n            </div>\n\n        \n            <button type=\"submit\" class=\"btn btn-primary\" onclick=\"submit_search_exception()\" ng-disabled=\"disableSubmitButton()\">{{submit.text}}</button>\n        </div>\n        \n    </form>\n\n    <div class=\"clear-form-button\">\n      <button class=\"btn\" ng-click=\"clearForm()\">Clear Form</button>\n    </div>\n</div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<style media=\"screen\" type=\"text/css\">\n\n.searchChapsException-submit-status-container {\n    background-color: #def9db;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n}\n\n.searchChapsException-submit-status-container-failed{\n    background-color: #900C3F;\n    margin-left: 0px;\n    margin-top: 10px;\n    padding: 10px;\n    margin-bottom: 30px;\n    border-radius: 5px;\n    color: #f2f2f2;\n}\n\n.result-header{\n    margin-bottom: 15px;\n    font-size: 16px;\n    letter-spacing: 3px;\n}\n\n#submit-searchChapsException-container{\n    margin-top:20px; \n    margin-bottom:20px;\n    width: 98%;\n}\n\n\n.clear-form-button{\n    display: inline;\n    float: right;\n}\n\n.invalid-feedback{\n    width: 100%;\n    margin-top: .55rem;\n    font-size: 80%;\n    color: #dc3545;\n}\n</style>\n\n\n\n\n\n<script>\n\n    angular.element(document).ready(function () {\n        console.log('init search chaps sanction');\n        init_searchChapsException();\n    });\n\n    function init_searchChapsException() {\n        var scope = angular.element($(\"#submit-searchChapsException-container\")).scope();\n        if (typeof(scope.result)=== \"undefined\") {\n            scope.result = {\n                text: \"\",\n                payment: \"\",\n                success: false\n            };\n\n            show = false;\n            scope.submit = {\n                inprogress: false,\n                text: 'Search Exception'\n            };\n\n            scope.data = {};\n\n            scope.generateInputValues = function(scope) {\n                console.log('Initializing input values');\n                scope.data.paymentType = \"0\";\n                scope.data.scheme = \"0\";\n                scope.data.direction = \"0\";\n                scope.data.creditDebit = \"0\";\n            };\n\n            scope.generateInputValues(scope);\n\n            scope.clearForm = function(){\n                var scope = angular.element($(\"#submit-searchChapsException-container\")).scope();\n                scope.data = {};\n                scope.generateInputValues(scope);\n            };\n\n            scope.getActualDate = function() {\n                var today = new Date();\n                var dd = today.getDate();\n                var mm = today.getMonth()+1; //January is 0!\n                var yyyy = today.getFullYear();\n\n                if(dd<10) {\n                    dd = '0'+dd\n                } \n\n                if(mm<10) {\n                    mm = '0'+mm\n                } \n\n                today = yyyy + '-' + mm + '-' + dd;\n                console.log('Actual date generated: ' + today);\n                return today;\n            };\n\n            scope.validateDate = function(dateStr) {\n                 if(!/^\\d{4}\\-\\d{2}\\-\\d{2}$/.test(dateStr))\n                    return false;\n\n                var params = dateStr.split('-');\n\n                var year = parseInt(params[0]);\n                var month = parseInt(params[1]);\n                var day = parseInt(params[2]);\n\n                if (year < 2000 || year > 2050 || month < 1 || month > 12 || day < 0 || day > 31)\n                    return false;\n\n                var monthLength = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 ];\n\n                if(year % 400 == 0 || (year % 100 != 0 && year % 4 == 0))\n                    monthLength[1] = 29;\n\n                if (day > monthLength[month -1])\n                    return false;\n\n                return true;\n            };\n\n            scope.validateTime = function(timeStr) {\n                if(!/^\\d{2}:\\d{2}:\\d{2}$/.test(timeStr))\n                    return false;\n\n                var params = timeStr.split(':');\n\n                var hour = parseInt(params[0]);\n                var minute = parseInt(params[1]);\n                var second = parseInt(params[2]);\n\n                if (hour < 0 || hour > 23 || minute < 0 || minute > 59 || second < 0 || second > 59)\n                    return false;\n\n                return true;\n            };\n\n             scope.disableSubmitButton = function() {\n                var scope = angular.element($(\"#submit-searchChapsException-container\")).scope();\n                var result = false;\n\n                if (scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') {\n                    if (!scope.validateDate(scope.data.startDate)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') {\n                    if (!scope.validateDate(scope.data.endDate)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') {\n                    if (!scope.validateTime(scope.data.startTime)) {\n                        result = true;\n                    }\n                }\n\n                if (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '') {\n                    if (!scope.validateTime(scope.data.endTime)) {\n                        result = true;\n                    }\n                }\n\n                return result;\n            };\n        }\n    }\n\n    function getObjStr(field, value, exactMatch){\n        var result = '{\"field\":';\n        result = result.concat('\"').concat(field).concat('\", \"value\":\"').concat(value).concat('\", \"exactMatch\":').concat(exactMatch).concat('}');\n        return result;\n    }\n\n    function checkAnyFieldFilled(scope) {\n        var result = [];\n\n        try {\n\n            if (scope.data.paymentType != null && scope.data.paymentType != undefined && scope.data.paymentType != \"0\")\n                result.push(getObjStr(\"paymenttype\", scope.data.paymentType.toString(), true));\n\n            if (scope.data.scheme != null && scope.data.scheme != undefined && scope.data.scheme != \"0\")\n                result.push(getObjStr(\"paymentscheme\", scope.data.scheme.toString(), true));\n\n            if (scope.data.direction != null && scope.data.direction != undefined && scope.data.direction != \"0\")\n                result.push(getObjStr(\"direction\", scope.data.direction.toString(), true));\n\n            if (scope.data.creditDebit != null && scope.data.creditDebit != undefined && scope.data.creditDebit != \"0\")\n                result.push(getObjStr(\"cdtdbtind\", scope.data.creditDebit.toString(), true));\n\n            if (scope.data.paymentId != null && scope.data.paymentId != undefined && scope.data.paymentId != '')\n                result.push(getObjStr(\"paymentId\", scope.data.paymentId.toString(), false));\n\n            if (scope.data.transactionId != null && scope.data.transactionId != undefined && scope.data.transactionId != '')\n                result.push(getObjStr(\"txid\", scope.data.transactionId.toString(), false));\n\n            if (scope.data.settlementAmount != null && scope.data.settlementAmount != undefined && scope.data.settlementAmount != '')\n                result.push(getObjStr(\"intrbksttlamt\", scope.data.settlementAmount.toString(), false));\n\n            if (scope.data.currency != null && scope.data.currency != undefined && scope.data.currency != '')\n                result.push(getObjStr(\"intrbksttlccy\", scope.data.currency.toString(), false));\n\n            if (scope.data.debtorAgentName != null && scope.data.debtorAgentName != undefined && scope.data.debtorAgentName != '')\n                result.push(getObjStr(\"dbtragt_nm\", scope.data.debtorAgentName.toString(), false));\n\n            if (scope.data.debtorAgentAccount != null && scope.data.debtorAgentAccount != undefined && scope.data.debtorAgentAccount != '')\n                result.push(getObjStr(\"dbtragt_acct\", scope.data.debtorAgentAccount.toString(), false));\n\n            if (scope.data.debtorAgentBICFI != null && scope.data.debtorAgentBICFI != undefined && scope.data.debtorAgentBICFI != '')\n                result.push(getObjStr(\"dbtragt_bicfi\", scope.data.debtorAgentBICFI.toString(), false));\n\n            if (scope.data.debtorAgentAddress != null && scope.data.debtorAgentAddress != undefined && scope.data.debtorAgentAddress != '')\n                result.push(getObjStr(\"dbtragt_pstladr\", scope.data.debtorAgentAddress.toString(), false));\n\n            if (scope.data.debtorName != null && scope.data.debtorName != undefined && scope.data.debtorName != '')\n                result.push(getObjStr(\"dbtrnm\", scope.data.debtorName.toString(), false));\n\n            if (scope.data.debtorAccount != null && scope.data.debtorAccount != undefined && scope.data.debtorAccount != '')\n                result.push(getObjStr(\"dbtracct\", scope.data.debtorAccount.toString(), false));\n\n            if (scope.data.debtorBICFI != null && scope.data.debtorBICFI != undefined && scope.data.debtorBICFI != '')\n                result.push(getObjStr(\"dbtr_bicfi\", scope.data.debtorBICFI.toString(), false));\n\n            if (scope.data.debtorAddress != null && scope.data.debtorAddress != undefined && scope.data.debtorAddress != '')\n                result.push(getObjStr(\"dbtrpstladr\", scope.data.debtorAddress.toString(), false));\n\n            if (scope.data.creditorAgentName != null && scope.data.creditorAgentName != undefined && scope.data.creditorAgentName != '')\n                result.push(getObjStr(\"cdtragt_nm\", scope.data.creditorAgentName.toString(), false));\n\n            if (scope.data.creditorAgentAccount != null && scope.data.creditorAgentAccount != undefined && scope.data.creditorAgentAccount != '')\n                result.push(getObjStr(\"cdtrAgt_acct\", scope.data.creditorAgentAccount.toString(), false));\n\n            if (scope.data.creditorAgentBICFI != null && scope.data.creditorAgentBICFI != undefined && scope.data.creditorAgentBICFI != '')\n                result.push(getObjStr(\"cdtrAgt_bicfi\", scope.data.creditorAgentBICFI.toString(), false));\n\n            if (scope.data.creditorAgentAddress != null && scope.data.creditorAgentAddress != undefined && scope.data.creditorAgentAddress != '')\n                result.push(getObjStr(\"cdtrAgt_pstladr\", scope.data.creditorAgentAddress.toString(), false));\n\n            if (scope.data.creditorName != null && scope.data.creditorName != undefined && scope.data.creditorName != '')\n                result.push(getObjStr(\"cdtrnm\", scope.data.creditorName.toString(), false));\n\n            if (scope.data.creditorAccount != null && scope.data.creditorAccount != undefined && scope.data.creditorAccount != '')\n                result.push(getObjStr(\"cdtracct\", scope.data.creditorAccount.toString(), false));\n\n            if (scope.data.creditorBICFI != null && scope.data.creditorBICFI != undefined && scope.data.creditorBICFI != '')\n                result.push(getObjStr(\"cdtr_bicfi\", scope.data.creditorBICFI.toString(), false));\n\n            if (scope.data.creditorAddress != null && scope.data.creditorAddress != undefined && scope.data.creditorAddress != '')\n                result.push(getObjStr(\"cdtrpstladr\", scope.data.creditorAddress.toString(), false));\n\n\n        } catch (err) {\n            console.error('Error parsing fields. Error message: ' + err);\n        }\n\n        console.log('Result: ' + result);\n\n        var results = JSON.parse(\"[\" + result + \"]\");\n\n        console.log('Result JSON: ' + JSON.stringify(result));\n\n        return results;\n    }\n\n    function doQuery(scope) {\n        var sqlString = '';\n\n        var fields = checkAnyFieldFilled(scope);\n\n        console.log('fields: ' + fields);\n\n        if (fields.length > 0) {\n            var and = false;\n            sqlString = \"WHERE \";\n\n            for (i = 0; i < fields.length; i++) { \n                var obj = fields[i];\n                if (and)\n                    sqlString = sqlString.concat(\" AND \");\n\n\n                sqlString = sqlString.concat('UPPER(');\n                sqlString = sqlString.concat(obj.field);\n                sqlString = sqlString.concat(')');\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\" LIKE UPPER('%\");\n                else\n                    sqlString = sqlString.concat(\" = UPPER('\");\n\n                sqlString = sqlString.concat(obj.value);\n\n                if (!obj.exactMatch)\n                    sqlString = sqlString.concat(\"%\");\n\n                sqlString = sqlString.concat(\"')\");\n\n                and = true;\n            }\n        }\n\n        var queryDateTimes = addDateTimes(scope, and);\n        sqlString = sqlString.concat(queryDateTimes);\n\n        console.log(\"Query: \" + sqlString);\n        return sqlString;\n    }\n\n    function addDateTimes(scope, and) {\n        console.log('Generating Query')\n        var sqlString = \"\";\n\n        if ((scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') ||\n            (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') ||\n            (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') ||\n            (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '')) {\n            console.log(\"Retrieving dates.\");\n\n            if (!and) {\n                sqlString = sqlString.concat(\" WHERE \");\n            }\n\n            var startDateFilled = false;\n            var startTimeFilled = false;\n            var endDateFilled = false;\n            var endTimeFilled = false;\n\n            var startDateTimeFilled = false;\n            var endDateTimeFilled = false;\n\n            var startTimeStr = \"00:00:00\";\n            var endTimeStr = \"23:59:59\";\n\n            var startDateTimeStr;\n            var endDateTimeStr;\n\n\n            if (scope.data.startDate != null && scope.data.startDate != undefined && scope.data.startDate != '') {\n                startDateFilled = true;\n            }\n            if (scope.data.startTime != null && scope.data.startTime != undefined && scope.data.startTime != '') {\n                startTimeFilled = true;\n            }\n            if (scope.data.endDate != null && scope.data.endDate != undefined && scope.data.endDate != '') {\n                endDateFilled = true;\n            }\n            if (scope.data.endTime != null && scope.data.endTime != undefined && scope.data.endTime != '') {\n                endTimeFilled = true;\n            }\n\n            if (startDateFilled || startTimeFilled || endDateFilled || endTimeFilled) {\n                if (startDateFilled && startTimeFilled) {\n                    startDateTimeStr = scope.data.startDate + \" \" + scope.data.startTime;\n                } else if(startDateFilled && !startTimeFilled) {\n                    startDateTimeStr = scope.data.startDate + \" \" + startTimeStr;\n                } else if (!startDateFilled && startTimeFilled) {\n                    startDateTimeStr =  scope.getActualDate() + \" \" + scope.data.startTime;\n                }\n\n                if (endDateFilled && endTimeFilled) {\n                    endDateTimeStr = scope.data.endDate + \" \" + scope.data.endTime;\n                } else if(endDateFilled && !endTimeFilled) {\n                    endDateTimeStr = scope.data.endDate + \" \" + endTimeStr;\n                } else if(!endDateFilled && endTimeFilled) {\n                    endDateTimeStr + scope.getActualDate() + scope.data.endTime;\n                }\n            }\n\n            if (startDateTimeStr != null && startDateTimeStr != undefined && startDateTimeStr != '') {\n                startDateTimeFilled = true;\n            }\n\n            if (endDateTimeStr != null && endDateTimeStr != undefined && endDateTimeStr != '') {\n                endDateTimeFilled = true;\n            }\n\n\n            if (startDateTimeFilled || endDateTimeFilled) {\n                if (and) {\n                    sqlString = sqlString + \" AND \";\n                }\n\n                if (startDateTimeFilled && endDateTimeFilled) {\n                    sqlString = sqlString + \"paymenttimestamp >= '\" + startDateTimeStr + \"' AND paymenttimestamp <= '\" + endDateTimeStr+\"'\";\n                }else if (startDateTimeFilled) {\n                    sqlString = sqlString + \"paymenttimestamp >= '\" + startDateTimeStr+\"'\";                     \n                } else {\n                    sqlString = sqlString + \"paymenttimestamp <= '\" + endDateTimeStr+\"'\";                    \n                }\n            }\n        }\n\n        console.log('Query: ' + sqlString);\n        return sqlString;\n    }\n\n\n    function submit_search_exception() {\n        var scope = angular.element($(\"#submit-searchChapsException-container\")).scope();\n\n        console.log('Submitting search exception');\n        \n        var query = doQuery(scope);\n\n        scope.z.angularBind('exceptionsQuery', query, '20180620-140301_810238412');\n        scope.z.runParagraph('20180620-140301_810238412');\n    }\n\n    \n</script>"}]},"apps":[],"jobName":"paragraph_1533800452167_207493853","id":"20180619-100052_351763585","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:22+0000","dateFinished":"2018-11-08T13:03:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3958"},{"text":"%hive(hive)\nselect PaymentId,\n  PaymentTimestamp,\n  PaymentType,\n  Direction,\n  CdtDbtInd,\n  ExceptionCode,\n  ExceptionRsn,\n  TRN,\n  TxId,\n  EndtoEndId,\n  SttlmTmIndctn,\n  IntrBkSttlDt,\n  IntrBkSttlAmt,\n  IntrBkSttlCcy,\n  DbtrAgt_Nm,\n  DbtrAgt_PstlAdr,\n  DbtrAgt_Acct,\n  DbtrAgt_ClrSysMmbid,\n  DbtrAgt_BICFI,\n  DbtrNm,\n  DbtrPstlAdr,\n  DbtrAcct,\n  Dbtr_BICFI,\n  CdtrAgt_Nm,\n  CdtrAgt_PstlAdr,\n  CdtrAgt_Acct,\n  CdtrAgt_BICFI,\n  CdtrAgt_ClrSysMmbid,\n  CdtrNm,\n  CdtrPstlAdr,\n  CdtrAcct,\n  Cdtr_BICFI,\n  InstrInf,\n  RmtInf,\n  PaymentMessage from CHAPS.CHAPSExceptions ${exceptionsQuery}","user":"jjimenez","dateUpdated":"2018-11-08T13:03:22+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":true,"results":{},"enabled":true},"settings":{"params":{"exceptionsQuery":"","query":""},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"paymentid\tpaymenttimestamp\tpaymenttype\tdirection\tcdtdbtind\texceptioncode\texceptionrsn\ttrn\ttxid\tendtoendid\tsttlmtmindctn\tintrbksttldt\tintrbksttlamt\tintrbksttlccy\tdbtragt_nm\tdbtragt_pstladr\tdbtragt_acct\tdbtragt_clrsysmmbid\tdbtragt_bicfi\tdbtrnm\tdbtrpstladr\tdbtracct\tdbtr_bicfi\tcdtragt_nm\tcdtragt_pstladr\tcdtragt_acct\tcdtragt_bicfi\tcdtragt_clrsysmmbid\tcdtrnm\tcdtrpstladr\tcdtracct\tcdtr_bicfi\tinstrinf\trmtinf\tpaymentmessage\nSLIJ19566670403\t2018-11-08 09:19:56.823\tMT202RETN\tI\tD\tCHAPS_EXCPT_001\t No Field 57A or 57D No Field 58A No BIC or Sort Code No BIC in Field 58A \tPET620147299\tSLIJ19566670403\tSKAN38316706301\tnull\t2018-11-08\t2.0\tGBP\tnull\tnull\tnull\tBARCGB22XXX\tBARCGB22XXX\tnull\tnull\tnull\tBARCGB22XXX\tnull\tnull\tnull\tnull\tnull\tnull\tnull\t8301034833170298124WALLY\tnull\tnull\tnull\t{\"FICdtTrf\":{\"GrpHdr\":{\"MsgId\":\"SLIJ19566670403\",\"CreDtTm\":1541668796749,\"NbOfTxs\":\"1\",\"SttlmInf\":{\"SttlmMtd\":\"CLRG\"}},\"CdtTrfTxInf\":[{\"PmtId\":{\"EndToEndId\":\"SKAN38316706301\",\"TxId\":\"SLIJ19566670403\"},\"IntrBkSttlmAmt\":{\"value\":{\"value\":2.000000},\"Ccy\":\"GBP\"},\"IntrBkSttlmDt\":\"2018-11-08\",\"Dbtr\":{\"FinInstnId\":{\"BICFI\":\"BARCGB22XXX\"}},\"DbtrAgt\":{\"FinInstnId\":{\"BICFI\":\"BARCGB22XXX\"}},\"CdtrAcct\":{\"Id\":{\"Othr\":{\"Id\":\"8301034833170298124WALLY\"}}},\"InstrForCdtrAgt\":[],\"InstrForNxtAgt\":[{\"InstrInf\":\"/RETN/59\"},{\"InstrInf\":\"/BE05/\"},{\"InstrInf\":\"/MREF/SKAN38316706301\"},{\"InstrInf\":\"/TEXT/INITIATOR NOT RECOGNIZED\"}],\"SplmtryData\":[]}],\"SplmtryData\":[]}}\n"}]},"apps":[],"jobName":"paragraph_1533800452168_205570108","id":"20180620-140301_810238412","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:22+0000","dateFinished":"2018-11-08T13:03:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3959"},{"title":"Balances","text":"%hive(hive)\r\nselect accountid, lasttransactionid, transactiontimestamp, transactiontype, transactionamount, transactioncurrency, actualbalance, ledgerbalance\r\nfrom transactional_log.transaction_log where lasttransactionid like '%${originalKey}%'\r\n\r\n","user":"jjimenez","dateUpdated":"2018-11-08T13:03:22+0000","config":{"tableHide":false,"editorSetting":{"language":"sql","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{"originalKey":"SKNL47536029501","AccountId":"650152IPAGO"},"forms":{"originalKey":{"name":"originalKey","defaultValue":"","hidden":false,"$$hashKey":"object:4908"}}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"accountid\tlasttransactionid\ttransactiontimestamp\ttransactiontype\ttransactionamount\ttransactioncurrency\tactualbalance\tledgerbalance\n25WALLY\tSKNL47536029501\t2018-10-13 11:48:06.539\tCREDIT\t1.0\tGBP\t100.0\t100.0\n8301034833170298124WALLY\tSKNL47536029501\t2018-10-13 11:47:56.341\tDEBIT\t1.0\tGBP\t129.0\t129.0\n9WALLY\tSKNL47536029501\t2018-10-13 11:47:56.341\tCREDIT\t1.0\tGBP\t169.0\t169.0\n7WALLY\tSKNL47536029501\t2018-10-13 11:48:06.539\tDEBIT\t1.0\tGBP\t-100.0\t-100.0\n"}]},"apps":[],"jobName":"paragraph_1533800452168_205570108","id":"20180622-084901_465715187","dateCreated":"2018-08-09T07:40:52+0000","dateStarted":"2018-11-08T13:03:23+0000","dateFinished":"2018-11-08T13:03:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3960"},{"user":"jjimenez","dateUpdated":"2018-11-08T13:03:22+0000","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1533800452168_205570108","id":"20180702-093244_383363748","dateCreated":"2018-08-09T07:40:52+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3961"}],"name":"Production/Chaps.20181105","id":"2DPKQZPY9","angularObjects":{"2CHS8UYQQ:shared_process":[],"2CKX6DGQZ:shared_process":[],"2DCETX3KD:shared_process":[{"name":"exceptionsQuery","object":" WHERE paymenttimestamp >= '2018-11-08 00:00:00'","noteId":"2DPKQZPY9","paragraphId":"20180620-140301_810238412"},{"name":"sanctionsQuery","object":"WHERE paymentId LIKE '%SIJK11210230703%'","noteId":"2DPKQZPY9","paragraphId":"20180619-074807_684250220"},{"name":"query","object":"WHERE UPPER(paymentId) LIKE UPPER('%SIJK11210230703%')","noteId":"2DPKQZPY9","paragraphId":"20180619-073855_945887381"}],"2CK8A9MEG:shared_process":[{"name":"queryRawMessages","object":"WHERE UPPER(rowkey) LIKE UPPER('%SIJK11210230703%')","noteId":"2DPKQZPY9","paragraphId":"20180621-094321_1787962433"}],"2CKX8WPU1:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}